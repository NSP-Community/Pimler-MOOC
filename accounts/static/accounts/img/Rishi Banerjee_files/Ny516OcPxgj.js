if (self.CavalryLogger) { CavalryLogger.start_js(["+4sWy"]); }

/**
 * @providesModule Shaka
 * @preserve-whitespace
 * @nopackage
 * @generated
 */
__d("Shaka",["Promise","EventListener","VideoPlayerShakaPerformanceLogger","VideoPushParametersHelper","TimeSlice","VideoPlayerLocalBandwidthEstimator","VideoPlayerResourceTimer","ShakaSegmentReferenceHelper","SegmentRequestManager","concatArrayBuffer","BufferReplacementHelper","logLongAkamaiRequest","throttle","ViewportPriorityAdjuster","FirstLoadedVideoPriorityAdjuster","VideoPriorityCalculator","VideoStreamingManager","MultipleSegmentsProvider","LocalBitrateHelper","UnitConstants","BufferVelocity","VideoPlayerBitrateEstimator","VideoPlayerShakaGlobalConfig","getSeekRangeGapsFromShakaReferences","mergeSeekRangeGaps","NetworkStatusDetector","MosUtils","BanzaiODS","VideoDashPrefetchCache","VideoClientEdgeCooperation","VideoStreamingTaskQueueProvider","BinarySearch","ShakaTimelineSegmentIndexUtils","setTimeoutAcrossTransitions","setTimeout","setIntervalAcrossTransitions","setInterval","setImmediateAcrossTransitions","setImmediate","clearTimeout","clearInterval","clearImmediate","dispatchEvent","EventListener","Event","extractCEA608","performanceNow","canUseFetchStream","SubscriptionsHandler","VideoPushTracker"],(function $module_Shaka(global,require,requireDynamic,requireLazy,module,exports){

// run `arc rebuild shaka-player` to regenerate Shaka.js after modifying this
// file

var Promise = require('Promise');
var EventListener = require('EventListener');
var VideoPlayerShakaPerformanceLogger = require('VideoPlayerShakaPerformanceLogger');
var VideoPushParametersHelper = require('VideoPushParametersHelper');
var TimeSlice = require('TimeSlice');
var VideoPlayerLocalBandwidthEstimator = require('VideoPlayerLocalBandwidthEstimator');
var VideoPlayerResourceTimer = require('VideoPlayerResourceTimer');
var ShakaSegmentReferenceHelper = require('ShakaSegmentReferenceHelper');
var SegmentRequestManager = require('SegmentRequestManager');
var concatArrayBuffer = require('concatArrayBuffer');
var BufferReplacementHelper = require('BufferReplacementHelper');
var logLongAkamaiRequest = require('logLongAkamaiRequest');
var throttle = require('throttle');
var ViewportPriorityAdjuster = require('ViewportPriorityAdjuster');
var FirstLoadedVideoPriorityAdjuster = require('FirstLoadedVideoPriorityAdjuster');
var VideoPriorityCalculator = require('VideoPriorityCalculator');
var VideoStreamingManager = require('VideoStreamingManager');
var MultipleSegmentsProvider = require('MultipleSegmentsProvider');
var LocalBitrateHelper = require('LocalBitrateHelper');
var UnitConstants = require('UnitConstants');
var BufferVelocity = require('BufferVelocity');
var VideoPlayerBitrateEstimator = require('VideoPlayerBitrateEstimator');
var VideoPlayerShakaGlobalConfig = require('VideoPlayerShakaGlobalConfig');
var getSeekRangeGapsFromShakaReferences = require('getSeekRangeGapsFromShakaReferences');
var mergeSeekRangeGaps = require('mergeSeekRangeGaps');
var NetworkStatusDetector = require('NetworkStatusDetector');
var MosUtils = require('MosUtils');
var BanzaiODS = require('BanzaiODS');
var VideoDashPrefetchCache = require('VideoDashPrefetchCache');
var VideoClientEdgeCooperation = require('VideoClientEdgeCooperation');
var VideoStreamingTaskQueueProvider = require('VideoStreamingTaskQueueProvider');
var BinarySearch = require('BinarySearch');
var ShakaTimelineSegmentIndexUtils = require('ShakaTimelineSegmentIndexUtils');

var setTimeout = VideoPlayerShakaGlobalConfig.getBool(
    'timeouts_persist_on_page_transition',
    true
  ) ?
  require('setTimeoutAcrossTransitions') :
  require('setTimeout');
var setInterval = VideoPlayerShakaGlobalConfig.getBool(
    'timeouts_persist_on_page_transition',
    true
  ) ?
  require('setIntervalAcrossTransitions') :
  require('setInterval');
var setImmediate = VideoPlayerShakaGlobalConfig.getBool(
    'timeouts_persist_on_page_transition',
    true
  ) ?
  require('setImmediateAcrossTransitions') :
  require('setImmediate');
var clearTimeout = require('clearTimeout');
var clearInterval = require('clearInterval');
var clearImmediate = require('clearImmediate');
var dispatchDomEvent = require('dispatchEvent');
var eventListenerCapture = require('EventListener').capture;
var eventKill = require('Event').kill;
var extractCEA608 = require('extractCEA608');
var performanceNow = require('performanceNow');
var canUseFetchStream = require('canUseFetchStream');
var SubscriptionsHandler = require('SubscriptionsHandler');
var VideoPushTracker = require('VideoPushTracker');

function setEventProperty(obj, name, handler) {
  obj[name] = TimeSlice.guard(handler, 'shaka ' + name);
};

if (
  VideoPlayerShakaGlobalConfig.getBool('shaka_native_promise', false) &&
  VideoPlayerShakaGlobalConfig.getBool('use_native_promise', true)
) {
  Promise = window.Promise;
}

var g = {};

(function(window){var m,aa=this;function q(a,b){var c=a.split("."),d=aa;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||void 0===b?d[e]?d=d[e]:d=d[e]={}:d[e]=b}function r(a,b){function c(){}c.prototype=b.prototype;a.Bd=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.zd=function(a,c,f){return b.prototype[c].apply(a,Array.prototype.slice.call(arguments,2))}};/*

 Copyright 2015 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function da(){};function ea(){}function fa(a){var b=console[a];b?b.bind||(console[a]=function(){b.apply(console,arguments)}):console[a]=function(){}}fa("error");fa("warn");fa("info");fa("log");fa("debug");function ga(a){ha[a]={Ka:ia(),end:NaN}}function ja(a){if(a=ha[a])a.end=ia()}function la(){var a=ha.buffering;return a&&a.end?a.end-a.Ka:NaN}var ia=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now,ha={};/*

 Copyright 2004-present Facebook. All Rights Reserved.

*/
function ma(a,b,c,d,e,f,h,g){this.id=a;this.bandwidth=b||0;this.lang=c||"unknown";this.streamInfoID=d;this.mimeType=e||"";this.codecs=f||"";this.channels=h||null;this.samplingRate=g||null;this.active=!1}q("shaka.player.AudioTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0});var na=VideoPlayerShakaGlobalConfig.getNumber("shaka_default_ajax_request_timeout",0),oa=VideoPlayerShakaGlobalConfig.getNumber("shaka_default_ajax_request_timeout",0),pa=VideoPlayerShakaGlobalConfig.getNumber("shaka_default_ajax_request_timeout",0);function qa(){this.minBandwidth=this.maxBandwidth=this.maxWidth=this.minHeight=this.maxHeight=null}qa.prototype.clone=function(){var a=new qa;a.maxHeight=this.maxHeight;a.minHeight=this.minHeight;a.maxWidth=this.maxWidth;a.maxBandwidth=this.maxBandwidth;a.minBandwidth=this.minBandwidth;return a};function ra(){this.fontSize="100%";this.fontColor=sa;this.fontOpacity=ua;this.backgroundColor=va;this.backgroundOpacity=ua;this.fontEdge=wa}q("shaka.player.TextStyle",ra);
function xa(a){var b=[];b.push("font-size: "+a.fontSize);b.push("color: "+ya(a.fontColor,a.fontOpacity));b.push("background-color: "+ya(a.backgroundColor,a.backgroundOpacity));for(var c=[],d=0;d<a.fontEdge.length;++d){var e=a.fontEdge[d].slice(3,6);c.push(ya(a.fontEdge[d].slice(0,3),a.fontOpacity)+" "+e.join("px ")+"px")}b.push("text-shadow: "+c.join(","));return b.join("; ")}function ya(a,b){return"rgba("+a.concat(b).join(",")+")"}var sa=[255,255,255],va=[0,0,0];
ra.StandardColors={WHITE:sa,BLACK:va,RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,255,0],MAGENTA:[255,0,255],CYAN:[0,255,255]};var ua=1;ra.StandardOpacities={OPAQUE:ua,SEMI_HIGH:.75,SEMI_LOW:.25,TRANSPARENT:0};var wa=[];
ra.EdgeStyles={NONE:wa,RAISED:[[34,34,34,1,1,0],[34,34,34,2,2,0],[34,34,34,3,3,0]],DEPRESSED:[[204,204,204,1,1,0],[204,204,204,0,1,0],[34,34,34,-1,-1,0],[34,34,34,0,-1,0]],UNIFORM:[[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4],[34,34,34,0,0,4]],DROP:[[34,34,34,2,2,3],[34,34,34,2,2,4],[34,34,34,2,2,5]]};function za(a,b){this.id=a;this.lang=b||"unknown";this.enabled=this.active=!1}q("shaka.player.TextTrack.compare",function(a,b){return a.lang<b.lang?-1:a.lang>b.lang?1:0});function Aa(a,b,c,d,e,f,h,g,k,l,n,p,v){this.id=a;this.bandwidth=b||0;this.width=c||0;this.height=d||0;this.streamInfoID=e;this.fbQualityLabel=f;this.fbQualityClass=h;a=[];g&&(a=g.split(","));this.frameRate=k||"";this.mimeType=l||"";this.codecs=n||"";this.isHVQ=-1<a.indexOf("hvq");this.isInlineHVQ=-1<a.indexOf("hvq_www_inline");this.avoidOnPoorConnection=-1<a.indexOf("avoid_on_poor_connection");this.active=!1;this.playbackResolutionMos=p||null;this.playbackResolutionMosConfidenceLevel=v||null}
function Ba(a,b){var c=a.width*a.height,d=b.width*b.height;return c<d?-1:c>d?1:a.bandwidth<b.bandwidth?-1:a.bandwidth>b.bandwidth?1:0}q("shaka.player.VideoTrack.compare",Ba);function Ca(a){for(var b=Da,c=[],d=0;d<a.length;++d){for(var e=!1,f=0;f<c.length&&!(e=b?b(a[d],c[f]):a[d]===c[f]);++f);e||c.push(a[d])}return c};var Ea=0;function Fa(a){this.b=a;this.c=0==Ga;this.a=0}var Ga=1;function Ha(a){return a.a<a.b.byteLength}function Ia(a){var b=a.b.getUint8(a.a);a.a+=1;return b}function t(a){var b=a.b.getUint32(a.a,a.c);a.a+=4;return b}function Ja(a){var b,c;a.c?(b=a.b.getUint32(a.a,!0),c=a.b.getUint32(a.a+4,!0)):(c=a.b.getUint32(a.a,!1),b=a.b.getUint32(a.a+4,!1));if(2097151<c)throw new RangeError("DataViewReader: Overflow reading 64-bit value.");a.a+=8;return c*Math.pow(2,32)+b}
function Ka(a){if(a.a+16>a.b.byteLength)throw new RangeError("DataViewReader: Read past end of DataView.");var b=new Uint8Array(a.b.buffer,a.a,16);a.a+=16;return b}function La(a,b){if(a.a+b>a.b.byteLength)throw new RangeError("DataViewReader: Skip past end of DataView.");a.a+=b};function Ma(a){this.b=a;this.a=new Fa(a);Na||(Na=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var Na;
function Oa(a){var b;b=Pa(a);if(7<b.length)throw new RangeError("EbmlParser: EBML ID must be at most 7 bytes.");for(var c=0,d=0;d<b.length;d++)c=256*c+b[d];b=c;c=Pa(a);a:{for(d=0;d<Na.length;d++)if(Qa(c,Na[d])){d=!0;break a}d=!1}if(d)c=a.b.byteLength-a.a.a;else{if(8==c.length&&c[1]&224)throw new RangeError("EbmlParser: Variable sized integer value must be at most 53 bits.");for(var d=c[0]&(1<<8-c.length)-1,e=1;e<c.length;e++)d=256*d+c[e];c=d}c=a.a.a+c<=a.b.byteLength?c:a.b.byteLength-a.a.a;d=new DataView(a.b.buffer,
a.b.byteOffset+a.a.a,c);La(a.a,c);return new Ra(b,d)}function Pa(a){var b=Ia(a.a),c;for(c=1;8>=c&&!(b&1<<8-c);c++);if(8<c)throw new RangeError("EbmlParser: Variable sized integer must fit within 8 bytes.");var d=new Uint8Array(c);d[0]=b;for(b=1;b<c;b++)d[b]=Ia(a.a);return d}function Ra(a,b){this.id=a;this.a=b}
function Sa(a){if(8<a.a.byteLength)throw new RangeError("EbmlElement: Unsigned integer has too many bytes.");if(8==a.a.byteLength&&a.a.getUint8(0)&224)throw new RangeError("EbmlParser: Unsigned integer must be at most 53 bits.");for(var b=0,c=0;c<a.a.byteLength;c++)var d=a.a.getUint8(c),b=256*b+d;return b};var Ta={"output-restricted":"The required output protection is not available.","output-not-allowed":"The required output protection is not available.",expired:"The decryption key has expired.","internal-error":"The key system has encountered an unspecified error."};function u(a){this.b=Math.exp(Math.log(.5)/a);this.ob=this.Qa=this.a=0}q("shaka.util.EWMA",u);u.prototype.sample=function(a,b){var c=Math.pow(this.b,a);this.a=b*(1-c)+c*this.a;this.Qa+=a;this.ob+=1};u.prototype.sample=u.prototype.sample;u.prototype.c=function(){return this.Qa};u.prototype.getTotalWeight=u.prototype.c;u.prototype.getEstimate=function(){return this.a/(1-Math.pow(this.b,this.Qa))};u.prototype.getEstimate=u.prototype.getEstimate;u.prototype.f=function(){this.ob=this.Qa=this.a=0};
u.prototype.reset=u.prototype.f;var Ua=window.CustomEvent;"function"!==typeof Ua&&(Ua=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail);return c},Ua.prototype=window.Event.prototype);function x(a){var b=new Ua(a.type,{detail:a.detail,bubbles:!!a.bubbles}),c;for(c in a)c in b||(b[c]=a[c]);return b}function y(a){return new Ua("error",{detail:a,bubbles:!0})};function Va(a,b,c){Wa(b);Wa(c);return c==b||a>=Ya&&c==b.split("-")[0]||a>=Za&&c.split("-")[0]==b.split("-")[0]?!0:!1}var Ya=1,Za=2;function Wa(a){a=a.toLowerCase().split("-");var b=$a[a[0]];b&&(a[0]=b);return a.join("-")}
var $a={aar:"aa",abk:"ab",afr:"af",aka:"ak",alb:"sq",amh:"am",ara:"ar",arg:"an",arm:"hy",asm:"as",ava:"av",ave:"ae",aym:"ay",aze:"az",bak:"ba",bam:"bm",baq:"eu",bel:"be",ben:"bn",bih:"bh",bis:"bi",bod:"bo",bos:"bs",bre:"br",bul:"bg",bur:"my",cat:"ca",ces:"cs",cha:"ch",che:"ce",chi:"zh",chu:"cu",chv:"cv",cor:"kw",cos:"co",cre:"cr",cym:"cy",cze:"cs",dan:"da",deu:"de",div:"dv",dut:"nl",dzo:"dz",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",ewe:"ee",fao:"fo",fas:"fa",fij:"fj",fin:"fi",fra:"fr",fre:"fr",
fry:"fy",ful:"ff",geo:"ka",ger:"de",gla:"gd",gle:"ga",glg:"gl",glv:"gv",gre:"el",grn:"gn",guj:"gu",hat:"ht",hau:"ha",heb:"he",her:"hz",hin:"hi",hmo:"ho",hrv:"hr",hun:"hu",hye:"hy",ibo:"ig",ice:"is",ido:"io",iii:"ii",iku:"iu",ile:"ie",ina:"ia",ind:"id",ipk:"ik",isl:"is",ita:"it",jav:"jv",jpn:"ja",kal:"kl",kan:"kn",kas:"ks",kat:"ka",kau:"kr",kaz:"kk",khm:"km",kik:"ki",kin:"rw",kir:"ky",kom:"kv",kon:"kg",kor:"ko",kua:"kj",kur:"ku",lao:"lo",lat:"la",lav:"lv",lim:"li",lin:"ln",lit:"lt",ltz:"lb",lub:"lu",
lug:"lg",mac:"mk",mah:"mh",mal:"ml",mao:"mi",mar:"mr",may:"ms",mkd:"mk",mlg:"mg",mlt:"mt",mon:"mn",mri:"mi",msa:"ms",mya:"my",nau:"na",nav:"nv",nbl:"nr",nde:"nd",ndo:"ng",nep:"ne",nld:"nl",nno:"nn",nob:"nb",nor:"no",nya:"ny",oci:"oc",oji:"oj",ori:"or",orm:"om",oss:"os",pan:"pa",per:"fa",pli:"pi",pol:"pl",por:"pt",pus:"ps",que:"qu",roh:"rm",ron:"ro",rum:"ro",run:"rn",rus:"ru",sag:"sg",san:"sa",sin:"si",slk:"sk",slo:"sk",slv:"sl",sme:"se",smo:"sm",sna:"sn",snd:"sd",som:"so",sot:"st",spa:"es",sqi:"sq",
srd:"sc",srp:"sr",ssw:"ss",sun:"su",swa:"sw",swe:"sv",tah:"ty",tam:"ta",tat:"tt",tel:"te",tgk:"tg",tgl:"tl",tha:"th",tib:"bo",tir:"ti",ton:"to",tsn:"tn",tso:"ts",tuk:"tk",tur:"tr",twi:"tw",uig:"ug",ukr:"uk",urd:"ur",uzb:"uz",ven:"ve",vie:"vi",vol:"vo",wel:"cy",wln:"wa",wol:"wo",xho:"xh",yid:"yi",yor:"yo",zha:"za",zho:"zh",zul:"zu"};function ab(a){return Object.keys(a).map(function(b){return a[b]})}function z(a,b){return bb(a,b,"boolean")}function A(a,b,c){a=bb(a,b,"number");if(null==a)return null;if(isNaN(a)||a==Number.NEGATIVE_INFINITY||a==Number.POSITIVE_INFINITY)throw new RangeError("'"+b+"' must be finite.");if(null!=c&&a<c)throw new RangeError("'"+b+"' must be >= "+c);return a}function cb(a,b){return bb(a,b,"string")}
function bb(a,b,c){a=a[b];if(null==a)return null;if(typeof a!==c)throw new TypeError("'"+b+"' must be a "+c+".");return a}function db(a,b,c){a=a[b];if(null==a)return null;if(!(a instanceof c))throw new TypeError("'"+b+"' must be an instance of "+c.name+".");return a};function B(){this.a={}}B.prototype.push=function(a,b){this.a.hasOwnProperty(a)?this.a[a].push(b):this.a[a]=[b]};B.prototype.set=function(a,b){this.a[a]=b};B.prototype.get=function(a){return(a=this.a[a])?a.slice():null};function eb(a){var b=[],c;for(c in a.a)b.push.apply(b,a.a[c]);return b}B.prototype.remove=function(a,b){var c=this.a[a];if(c)for(var d=0;d<c.length;++d)c[d]==b&&(c.splice(d,1),--d)};function fb(a){var b=[],c;for(c in a.a)b.push(c);return b};function gb(){this.a=new B}gb.prototype.destroy=function(){hb(this);this.a=null};function D(a,b,c,d){b=new ib(b,c,d);a.a.push(c,b)}gb.prototype.ab=function(a,b){for(var c=this.a.get(b)||[],d=0;d<c.length;++d){var e=c[d];e.target==a&&(e.ab(),this.a.remove(b,e))}};function hb(a){for(var b=eb(a.a),c=0;c<b.length;++c)b[c].ab();a.a.a={}}function ib(a,b,c){this.target=a;this.type=b;this.a=c;this.target.addEventListener(b,c,!1)}
ib.prototype.ab=function(){this.target&&(this.target.removeEventListener(this.type,this.a,!1),this.a=this.target=null)};function E(a){this.rb=new B;this.Ca=a}q("shaka.util.FakeEventTarget",E);m=E.prototype;m.addEventListener=function(a,b){this.rb.push(a,b)};m.removeEventListener=function(a,b){this.rb.remove(a,b)};
m.dispatchEvent=function(a){a.hasOwnProperty("srcElement")||(delete a.srcElement,Object.defineProperty(a,"srcElement",{get:function(){return null}}));if(a.hasOwnProperty("target"))a.target=this;else{delete a.target;var b=this;Object.defineProperty(a,"target",{get:function(){return b},set:function(a){b=a}})}if(a.hasOwnProperty("currentTarget"))a.currentTarget=null;else{delete a.currentTarget;var c=null;Object.defineProperty(a,"currentTarget",{get:function(){return c},set:function(a){c=a}})}return jb(this,
a)};m.fc=!1;m.Ea=function(a,b){return this.dispatchEvent(x({type:"debug/shakaEvent",bubbles:!0,detail:{type:a,event:b}}))};function jb(a,b){b.currentTarget=a;for(var c=a.rb.get(b.type)||[],d=0;d<c.length;++d){var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(a,b)}catch(f){}}a.Ca&&b.bubbles&&jb(a.Ca,b);return b.defaultPrevented};function F(a){E.call(this,null);this.a={eb:{La:new u(VideoPlayerShakaGlobalConfig.getNumber("fast_moving_average_half_life",3)),nb:new u(VideoPlayerShakaGlobalConfig.getNumber("slow_moving_average_half_life",10))},Sa:{La:new u(VideoPlayerShakaGlobalConfig.getNumber("aggressive_fast_moving_average_half_life",1E-4)),nb:new u(VideoPlayerShakaGlobalConfig.getNumber("aggressive_slow_moving_average_half_life",9.2335087917745))}};this.h=a||5E5;this.j=VideoPlayerShakaGlobalConfig.getNumber("min_sample_count",
1E4);this.b=0;this.c=[];this.i=VideoPlayerShakaGlobalConfig.getNumber("max_recent_bandwidth_samples",0)}r(F,E);q("shaka.util.EWMABandwidthEstimator",F);
F.prototype.sample=function(a,b,c,d,e,f,h){if(VideoPlayerShakaGlobalConfig.getBool("change_abr_audio_exclusion_logic",!0)?!c:65536>b)e&&e.setEvent("unsampled").setReason("audio").log();else{if(VideoPlayerShakaGlobalConfig.getBool("use_resource_timing_entry_for_bandwidth",!0)){if(!d){e&&e.setEvent("unsampled").setReason("resource_timing_entry_missing").log();return}a=d.timeToLastByte;if(0>a){e&&e.setEvent("unsampled").setReason("resource_timing_entry_invalid").log();return}}a=Math.max(a,50);c=1E3*
UnitConstants.BITS_IN_BYTE*b/a;var g=a/1E3;this.a.Sa.La.sample(g,c,d);this.a.Sa.nb.sample(g,c,d);this.a.eb.La.sample(g,c,d);this.a.eb.nb.sample(g,c,d);h||this.dispatchEvent(x({type:"bandwidth"}));this.b=Date.now();d=parseInt(a,10);if(0<this.i)for(this.c.push([b,d]);this.c.length>this.i;)this.c.shift();e&&e.setEvent("sampled").setBytes(b).setDelayMs(d).log();f&&f.getEventLogger("bandwidth_sampled").setLength(b).setClientTimeBegin(this.b-d).setClientTimeEnd(this.b).log()}};
F.prototype.getBandwidth=function(a){a="aggressive"===a?this.a.Sa:this.a.eb;return this.canTrustEstimate()?Math.min(a.La.getEstimate(),a.nb.getEstimate()):this.h};F.prototype.getFastMovingBandwidth=function(a){a="aggressive"===a?this.a.Sa:this.a.eb;return this.canTrustEstimate()?a.La.getEstimate():this.h};F.prototype.getDataAge=function(){return(Date.now()-this.b)/1E3};F.prototype.canTrustEstimate=function(a){var b=this.a.Sa.La;return b.Qa>=(void 0===a?.5:a)||b.ob>=this.j};
F.prototype.supportsCaching=function(){return!1};F.prototype.setRepresentationID=function(){};F.prototype.flushABREvaluationSet=function(){return[]};F.prototype.getRecentSamples=function(){return this.c};/*

 Copyright 2015 Facebook Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function kb(a,b,c){F.call(this,c);this.g=a||0;this.f=void 0===b?Infinity:b}r(kb,F);q("shaka.util.EWMACacheBandwidthEstimator",kb);kb.prototype.sample=function(a,b,c,d,e,f,h){var g=8E3*b/a;e&&e.setBytes(b).setDelayMs(parseInt(a,10));a<=this.g&&g>this.f?e&&e.setEvent("unsampled").setReason("cached").log():F.prototype.sample.call(this,a,b,c,d,e,f,h)};kb.prototype.supportsCaching=function(){return Infinity!==this.f&&!!this.g};kb.prototype.setRepresentationID=function(){};
kb.prototype.flushABREvaluationSet=function(){return[]};function lb(){F.call(this)}r(lb,F);q("shaka.util.EWMASignedURLBandwidthEstimator",lb);lb.prototype.supportsCaching=function(){return!0};function G(){var a,b,c=new Promise(function(c,e){a=c;b=e});c.resolve=a;c.reject=b;c.destroy=G.prototype.destroy;return c}G.prototype.destroy=function(){this.catch(function(){});var a=Error("Destroyed!");a.type="destroy";this.reject(a)};function mb(a){a.split("").reduce(function(a,c,d){return a+(d&&0==d%4?" "+c:c)})};function nb(){this.$a=new G;this.c=!1;this.va=null;this.a=[];this.b=null}function ob(a,b){if(a.c)throw Error("Cannot append to a running task!");a.a.push(b)}nb.prototype.start=function(){if(this.c)throw Error("Task already started!");this.c=!0;this.a.unshift(function(){});pb(this,void 0)};nb.prototype.end=function(){this.a.splice(1)};
function pb(a,b){var c=a.a[0](b),d;c?(d=c[0],a.b=c[1]):(d=Promise.resolve(),a.b=null);d.then(H(a,function(a){this.va?(this.a=[],this.b=null,qb(this)):(this.a.shift(),this.a.length?pb(this,a):(this.$a.resolve(a),this.b=null))})).catch(H(a,function(a){this.a=[];this.b=null;this.va?qb(this):this.$a.reject(a)}))}
function qb(a){function b(){var a=Error("Task aborted.");a.type="aborted";this.$a.reject(a);setTimeout(function(){this.va.resolve();this.va=null}.bind(this),5)}a.f?a.f.then(function(){this.f=null;b.call(this)}.bind(a)):b.call(a)};function H(a,b){return b.bind(a)};function rb(a,b,c,d,e,f){MediaSource.isTypeSupported(c);E.call(this,e);e=b.addSourceBuffer(c);this.i=a;this.A=b;this.b=e;this.H=d;this.B=new gb;this.G=this.m=this.U=this.h=null;this.L=!1;this.K=this.I=this.J=0;this.F=null;this.R=this.C=!1;this.V=f;this.a=[];this.P=0;this.l=this.c=this.f=null;this.O=pa;this.o=this.s=0;this.v=this.M=!1;this.g=c&&c.charAt(0);D(this.B,this.b,"updateend",this.jd.bind(this));this.i.getBool("listen_for_async_append_buffer_errors",!0)&&D(this.B,this.b,"error",this.Xc.bind(this));
this.j=null}r(rb,E);rb.prototype.wa=function(){return{SourceBuffer:this.b}};function sb(a,b,c){a.fc&&a.Ea(b,{type:a.g.charAt(0),segment:c,sourceBuffer:a.b})}var tb=1/60;rb.prototype.destroy=function(){ub(this).catch(function(){});this.c&&this.c.destroy();this.a=this.f=this.c=null;this.B.destroy();this.A=this.b=this.B=null};function vb(a){var b=a.a.length;return 0<b?a.a[b-1]:null}
function wb(a,b){for(var c=a.b.buffered,d=0;d<c.length;++d){var e=c.start(d)-tb,f=c.end(d)+tb;if(b>=e&&b<=f)return c.end(d)-b}return 0}function xb(a,b,c){b=b.endTime?b.endTime-b.startTime:1;var d=new yb;d.b=3;d.j=1E3*b;d.f=1E3*a.O;d.v=a.U;d.l=c;d.aa=a.V;d.mimeType=a.g;return d}m=rb.prototype;
m.fetch=function(a,b,c,d,e,f,h,g){var k,l=f?"replacing_lower_quality_buffer":null;if(this.m){var n=this.a[this.a.length-1],p=null;n&&(p=1E3*(a.startTime-n.endTime));k=this.m.getOperationLogger("fetch").setReason(l).setResource(zb(a.url)).setType(Ab(this)).setLength(Math.round(1E3*(a.endTime-a.startTime))).setSegmentStartTime(1E3*a.startTime).setSegmentEndTime(1E3*a.endTime).setSegmentTimeGap(p).start()}this.j=k;if(this.f){if(this.i.getBool("sbm_enable_concurrent_fetch_requests",!1)){var v=[].slice.call(arguments);
return this.f.$a.then(H(this,function(){return this.fetch.apply(this,v)}),function(a){throw a;})}n=Error("Cannot fetch ("+this.g+"): previous operation not complete.");this.s>=this.J?(n.type="stream",k&&k.setError(n).log(),this.s=0):(this.s++,n.type="aborted");return Promise.reject(n)}this.f=new nb;c!=this.b.timestampOffset&&(this.b.timestampOffset=c);var n=xb(this,a,e),p=this.i.getBool("enable_streaming_code_path",!0),w;w=p?a.url.stream(n,this.H,this.m,this.j,this.G,Ab(this),l,h,g):a.url.fetch(n,
this.H,this.m,this.j,this.G,Ab(this),l,h);sb(this,"SegmentFetching",a);var C=I.prototype.Da.bind(a.url);this.F&&this.C&&(d=this.F);var Q=0,ba=null;d&&(this.F=d,this.C=!1,ob(this.f,function(){return[d.then(function(a){a.Oa>Q&&(Q=a.Oa);return Bb(this,a,null)}.bind(this)),this.Ra.bind(this)]}.bind(this)));var ca=function(a){a.Oa>Q&&(Q=a.Oa);ba=a.byteLength;ea((this.H.getBandwidth()/1E6).toFixed(2));if(this.M){var c;this.m&&(c=this.m.getOperationLogger("cea608_extraction").start());extractCEA608(a,b).then(function(a){c&&
c.setLength(a.length).log();a.length&&this.dispatchEvent(x({type:"cea608-captions",bubbles:!0,detail:{captions:a}}))}.bind(this)).catch(function(a){console.error(a)})}}.bind(this);p?(g&&(n=g.getProgressTracker(),this.h!==n&&(this.h=n)),ob(this.f,H(this,function(){var b=null,c=Math.max(0,(a.url.endByte||0)-a.url.startByte),d=this.i.getNumber("streaming_append_per_segment",3),e=0===d?0:c/d;return[w.then(function(c){b=c;this.v=!1;return Cb(this,c,a,e)}.bind(this)).then(function(a){b=null;return a}).then(ca).catch(function(a){this.i.getBool("abort_fetch_on_net_error",
!1)&&g&&(this.b.abort(),this.v=!0);return Promise.reject(a)}.bind(this)),function(){sb(this,"SegmentFailed",a);b&&(b.cancel("abort"),b=null,g&&(this.b.abort(),this.v=!0));C();return this.Ra()}.bind(this)]}))):ob(this.f,H(this,function(){return[w.then(function(b){sb(this,"SegmentFetched",a);ca(b);return Bb(this,b,a,l)}.bind(this)),function(){sb(this,"SegmentFailed",a);C();return this.Ra()}.bind(this)]}));var ta=0==this.b.buffered.length&&0==this.a.length,Xa=null;ob(this.f,function(){if(0==this.b.buffered.length&&
!this.R){var b=Error("Failed to buffer segment ("+this.g+").");b.type="stream";return[Promise.reject(b)]}this.b.buffered.length&&ta&&(b=a.startTime,Xa=this.b.buffered.start(0)-b);b=Db(this.a,a.startTime);0<=b?this.a.splice(b+1,0,a):this.a.push(a)}.bind(this));this.s=0;return Eb(this).then(function(){k&&k.log();return Promise.resolve({X:Xa,Sc:Q,D:a.endTime-a.startTime,qc:ba})}.bind(this),function(a){k&&k.setError(a).log();a=Fb(a,"task","An unknown task error occurred.");return Promise.reject(a)}.bind(this))};
function Cb(a,b,c,d){var e=new ArrayBuffer(0),f=new ArrayBuffer(0),h=function(){return b.read().then(function(a){var b=a.value;a=a.done;if(this.v||a&&0===f.byteLength)return e;if(!a&&!b)return h();b&&(b instanceof Uint8Array&&(b=b.buffer),f=concatArrayBuffer(f,b));return f.byteLength>=d||a?(this.h&&this.h.notifyBytesConsumed(f.byteLength),sb(this,"SegmentFetched",c),e=concatArrayBuffer(e,f),b=f,f=new ArrayBuffer(0),Bb(this,b,c).then(h)):h()}.bind(this))}.bind(a);return h()}
function Gb(a){if(a.f){var b=Error("Cannot clear ("+a.g+"): previous operation not complete.");a.o>=a.I?(b.type="stream",a.o=0):(a.o++,b.type="aborted");return Promise.reject(b)}a.f=new nb;ob(a.f,function(){var a;a:if(0==this.b.buffered.length)a=Promise.resolve();else{try{this.b.remove(0,this.A.duration)}catch(b){b=Fb(b,"clear_buffer","An error occured when clearing the buffer.");a=Promise.reject(b);break a}this.a=[];a=this.c=new G}return[a,this.Ra.bind(this)]}.bind(a));a.o=0;return Eb(a)}
function Hb(a,b){if(a.f){var c=Error("Cannot clearAfter ("+a.g+"): previous operation not complete.");c.type="stream";return Promise.reject(c)}a.f=new nb;ob(a.f,function(){return[Ib(this,b),this.Ra.bind(this)]}.bind(a));return Eb(a)}function Jb(a,b){a.c=new G;var c=b-5;if(0<c){try{a.b.remove(0,c)}catch(d){return d=Fb(d,"clear_buffer","An error occured when clearing the buffer."),Promise.reject(d)}c=Db(a.a,c);0<c&&(a.a=a.a.slice(c,a.a.length))}else a.c.resolve();return a.c}
function ub(a){a.f?(a=a.f,a.va?a=a.va:a.c?(a.b&&(a.f=a.b()),a.va=new G,a=a.va):(a.c=!0,a=Promise.resolve())):a=Promise.resolve();return a}function Kb(a){for(var b=a.currentTime,c=b,d=0;d<a.buffered.length;d++)if(b<=a.buffered.start(d)){c=a.buffered.start(d);break}return c}function Lb(a,b){for(var c=b.currentTime,d=0;d<b.buffered.length;d++)if(c>=b.buffered.start(d)&&c<=b.buffered.end(d)-a.K)return!1;return!0}
function Eb(a){a.f.start();return a.f.$a.then(H(a,function(){this.f=null})).catch(H(a,function(a){this.f=null;a=Fb(a,"task","An unknown task error occurred.");return Promise.reject(a)}))}
function Bb(a,b,c,d){var e;if(a.m){var f=c?zb(c.url):"init";e=a.m.getOperationLogger("append").setReason(d).setResource(f).setType(Ab(a)).setLength(b.byteLength).start();null!==c&&(e=e.setSegmentStartTime(1E3*c.startTime).setSegmentEndTime(1E3*c.endTime));a.j&&(e=e.setParentLogger(a.j))}try{a.b.appendBuffer(b)}catch(h){return a.i.getBool("nuke_source_buffer_on_quota_exceeded_err",!0)&&h instanceof DOMException&&h.code===DOMException.QUOTA_EXCEEDED_ERR&&h.message.match(/^.*SourceBuffer.*full.*free\sspace.*$/)&&
(h.type="sourcebuffer_full"),e&&e.setError(h).log(),Promise.reject(h)}a.c=new G;a.l=c;return a.c.then(function(){e&&e.log()},function(a){e&&e.setError(a).log();return Promise.reject(a)})}m.Xc=function(a){a=a.error||Error("Call to appendBuffer failed to append the segment.");a=Fb(a,"stream","Call to appendBuffer failed to append the segment.");this.c&&this.c.reject(a)};
function Ib(a,b){if(0==a.b.buffered.length)return Promise.resolve();var c=Db(a.a,b);if(-1==c||c==a.a.length-1)return Promise.resolve();try{a.b.remove(a.a[c+1].startTime,a.A.duration)}catch(d){return Promise.reject(d)}a.a=a.a.slice(0,c+1);a.c=new G;return a.c}m.Ra=function(){if(this.c){if("open"==this.A.readyState){var a=Error("Previous operation aborted.");a.type="aborted";this.c.reject(a);this.b.abort();this.L&&(this.C=!0);this.c=new G}return this.c}return Promise.resolve()};
m.jd=function(){this.c&&(this.l&&(sb(this,"SegmentAppended",this.l),this.l=null),this.c.resolve(),this.c=null)};m.vd=function(){return this.h};rb.prototype.getStreamProgressTracker=rb.prototype.vd;function Ab(a){return"v"===a.g.charAt(0)?"video":"a"===a.g.charAt(0)?"audio":null}function Fb(a,b,c){a||(a=Error(c));a.type||(a.type=b);a.message||(a.message=c);return a};function Mb(a){return String.fromCharCode.apply(null,a)}q("shaka.util.Uint8ArrayUtils.toString",Mb);function Nb(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;++c)b[c]=a.charCodeAt(c);return b}q("shaka.util.Uint8ArrayUtils.fromString",Nb);q("shaka.util.Uint8ArrayUtils.toBase64",function(a,b){var c=void 0==b?!0:b,d=window.btoa(Mb(a)).replace(/\+/g,"-").replace(/\//g,"_");return c?d:d.replace(/=*$/,"")});function Ob(a){return Nb(window.atob(a.replace(/-/g,"+").replace(/_/g,"/")))}
q("shaka.util.Uint8ArrayUtils.fromBase64",Ob);q("shaka.util.Uint8ArrayUtils.fromHex",function(a){for(var b=new Uint8Array(a.length/2),c=0;c<a.length;c+=2)b[c/2]=window.parseInt(a.substr(c,2),16);return b});function Pb(a){for(var b="",c=0;c<a.length;++c){var d=a[c].toString(16);1==d.length&&(d="0"+d);b+=d}return b}q("shaka.util.Uint8ArrayUtils.toHex",Pb);function Qa(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0};function Qb(){this.h=this.a="";this.l=!1;this.s=this.o=null;this.i=this.g=!1;this.j=this.f="";this.c=null;this.b=[]}function Rb(a,b){var c=new Qb;c.a=a.a;c.h=a.h;c.l=a.l;c.o=a.o;c.s=a.s;c.g=a.g;c.i=a.i;c.f=a.f;c.j=a.j;c.c=a.c?new Uint8Array(a.c.buffer):null;Sb(c,a.b);Sb(c,b.b);return c}function Sb(a,b){var c=a.b.concat(b.map(function(a){return{initData:new Uint8Array(a.initData.buffer),initDataType:a.initDataType}}));a.b=Ca(c)}
function Da(a,b){return a.initDataType==b.initDataType&&Qa(a.initData,b.initData)};function Tb(a,b,c,d){this.a=[];d&&this.a.push(d)}q("shaka.player.DrmSchemeInfo",Tb);Tb.DistinctiveIdentifier={OPTIONAL:0,REQUIRED:1};Tb.PersistentState={OPTIONAL:0,REQUIRED:1};Tb.createUnencrypted=function(){return new Tb(0,0,0,null)};function Ub(a){this.systemIds=[];this.cencKeyIds=[];this.a=[];a=new Fa(new DataView(a.buffer));try{for(;Ha(a);){var b=a.a,c=t(a),d=t(a);1==c?c=Ja(a):0==c&&(c=a.b.byteLength-b);if(1886614376!=d)La(a,c-(a.a-b));else{var e=Ia(a);if(1<e)La(a,c-(a.a-b));else{La(a,3);var f=Pb(Ka(a)),h=[];if(0<e)for(var g=t(a),k=0;k<g;++k){var l=Pb(Ka(a));h.push(l)}var n=t(a);La(a,n);this.cencKeyIds.push.apply(this.cencKeyIds,h);this.systemIds.push(f);this.a.push({start:b,end:a.a-1});a.a!=b+c&&La(a,c-(a.a-b))}}}}catch(p){}}
;var Vb=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function J(a){var b;a instanceof J?(Wb(this,a.ua),this.Ja=a.Ja,this.ja=a.ja,Xb(this,a.Na),this.pa=a.pa,Yb(this,a.a.clone()),this.Fa=a.Fa):a&&(b=String(a).match(Vb))?(Wb(this,b[1]||"",!0),this.Ja=Zb(b[2]||""),this.ja=Zb(b[3]||"",!0),Xb(this,b[4]),this.pa=Zb(b[5]||"",!0),Yb(this,b[6]||"",!0),this.Fa=Zb(b[7]||"")):this.a=new $b(null)}m=J.prototype;m.ua="";m.Ja="";m.ja="";m.Na=null;m.pa="";m.Fa="";
m.toString=function(){var a=[],b=this.ua;b&&a.push(ac(b,bc,!0),":");if(b=this.ja){a.push("//");var c=this.Ja;c&&a.push(ac(c,bc,!0),"@");a.push(encodeURIComponent(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1"));b=this.Na;null!=b&&a.push(":",String(b))}if(b=this.pa)this.ja&&"/"!=b.charAt(0)&&a.push("/"),a.push(ac(b,"/"==b.charAt(0)?cc:dc,!0));(b=this.a.toString())&&a.push("?",b);(b=this.Fa)&&a.push("#",ac(b,ec));return a.join("")};
m.resolve=function(a){var b=this.clone();"data"===b.ua&&(b=new J);var c=!!a.ua;c?Wb(b,a.ua):c=!!a.Ja;c?b.Ja=a.Ja:c=!!a.ja;c?b.ja=a.ja:c=null!=a.Na;var d=a.pa;if(c)Xb(b,a.Na);else if(c=!!a.pa){if("/"!=d.charAt(0))if(this.ja&&!this.pa)d="/"+d;else{var e=b.pa.lastIndexOf("/");-1!=e&&(d=b.pa.substr(0,e+1)+d)}if(".."==d||"."==d)d="";else if(-1!=d.indexOf("./")||-1!=d.indexOf("/.")){for(var e=0==d.lastIndexOf("/",0),d=d.split("/"),f=[],h=0;h<d.length;){var g=d[h++];"."==g?e&&h==d.length&&f.push(""):".."==
g?((1<f.length||1==f.length&&""!=f[0])&&f.pop(),e&&h==d.length&&f.push("")):(f.push(g),e=!0)}d=f.join("/")}}c?b.pa=d:c=""!==a.a.toString();c?Yb(b,a.a.clone()):c=!!a.Fa;c&&(b.Fa=a.Fa);return b};m.clone=function(){return new J(this)};function Wb(a,b,c){a.ua=c?Zb(b,!0):b;a.ua&&(a.ua=a.ua.replace(/:$/,""))}function Xb(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.Na=b}else a.Na=null}function Yb(a,b,c){b instanceof $b?a.a=b:(c||(b=ac(b,fc)),a.a=new $b(b))}
function Zb(a,b){return a?b?decodeURI(a):decodeURIComponent(a):""}function ac(a,b,c){return"string"==typeof a?(a=encodeURI(a).replace(b,gc),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function gc(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var bc=/[#\/\?@]/g,dc=/[\#\?:]/g,cc=/[\#\?]/g,fc=/[\#\?@]/g,ec=/#/g;function $b(a){this.b=a||null}$b.prototype.a=null;$b.prototype.c=null;
function hc(a,b,c){if(!a.a&&(a.a={},a.c=0,a.b))for(var d=a.b.split("&"),e=0;e<d.length;e++){var f=d[e].indexOf("="),h=null,g=null;0<=f?(h=d[e].substring(0,f),g=d[e].substring(f+1)):h=d[e];h=decodeURIComponent(h.replace(/\+/g," "));g=g||"";hc(a,h,decodeURIComponent(g.replace(/\+/g," ")))}a.b=null;(d=a.a.hasOwnProperty(b)&&a.a[b])||(a.a[b]=d=[]);d.push(c);a.c++}
$b.prototype.toString=function(){if(this.b)return this.b;if(!this.a)return"";var a=[],b;for(b in this.a)for(var c=encodeURIComponent(b),d=this.a[b],e=0;e<d.length;e++){var f=c;""!==d[e]&&(f+="="+encodeURIComponent(d[e]));a.push(f)}return this.b=a.join("&")};$b.prototype.clone=function(){var a=new $b;a.b=this.b;if(this.a){var b={},c;for(c in this.a)b[c]=this.a[c].concat();a.a=b;a.c=this.c}return a};function ic(a,b,c){var d=a.indexOf("<?xml");0<=d&&(a=a.substr(d));a=(new DOMParser).parseFromString(a,"text/xml");if(!a)return null;"string"===typeof b&&(b=[new J(b)]);b=b||[new J("")];c=c||[new J("")];return K({nc:b,baseUrl:c},a,jc)}q("shaka.dash.mpd.parseMpd",ic);function jc(){this.id=this.url=null;this.type="static";this.FBIsLiveTemplated=this.FBWasLive=this.manifestIsLiveStreaming=!1;this.b=this.j=this.baseUrl=this.nc=null;this.h=5;this.f=this.c=this.g=null;this.i=1;this.a=[]}
function kc(){this.f=this.c=this.b=this.baseUrl=this.duration=this.start=this.id=null;this.a=[]}function lc(){this.c=this.codecs=this.mimeType=this.height=this.width=this.contentType=this.lang=this.group=this.id=null;this.f=!1;this.i=this.h=this.g=this.baseUrl=null;this.j=[];this.a=[];this.b=null}function mc(){this.value=null}function nc(){this.lang=this.a=null}function oc(){this.contentType=this.lang=this.id=null}function pc(){this.data=null}function qc(){this.data=null}
function rc(){this.a=this.b=this.f=this.i=this.baseUrl=this.j=this.frameRate=this.s=this.o=this.l=this.fbQualityClass=this.fbQualityLabel=this.h=this.g=this.codecs=this.mimeType=this.height=this.width=this.bandwidth=this.lang=this.id=null;this.c=[]}function sc(){this.value=this.a=null}sc.prototype.clone=function(){var a=new sc;a.a=this.a;a.value=this.value;return a};sc.prototype.parse=function(a,b){this.a=L(b,"schemeIdUri",M,this.a);this.value=L(b,"value",M,this.value)};
function tc(){this.b=this.a=this.f=this.c=null}function uc(){this.parsedPssh=this.psshBox=null}function vc(){this.url=null}function wc(){this.url=null}function xc(){this.baseUrl=null;this.a=1;this.f=this.c=this.g=this.b=this.h=null}xc.prototype.clone=function(){var a=new xc;a.baseUrl=yc(this.baseUrl);a.a=this.a;a.h=this.h;a.b=N(this.b);a.g=N(this.g);a.c=N(this.c);a.f=N(this.f);return a};function zc(){this.a=this.url=null}
zc.prototype.clone=function(){var a=new zc;a.url=yc(this.url);a.a=N(this.a);return a};function Ac(){this.a=this.url=null}Ac.prototype.clone=function(){var a=new Ac;a.url=yc(this.url);a.a=N(this.a);return a};function Bc(){this.baseUrl=null;this.a=1;this.D=this.f=null;this.h=0;this.g=null;this.c=[];this.b=null}Bc.prototype.clone=function(){var a=new Bc;a.baseUrl=yc(this.baseUrl);a.a=this.a;a.f=this.f;a.D=this.D;a.h=this.h;a.g=N(this.g);a.c=yc(this.c)||[];a.b=N(this.b);return a};
function Cc(){this.a=this.b=null}Cc.prototype.clone=function(){var a=new Cc;a.b=yc(this.b);a.a=N(this.a);return a};function Dc(){this.a=1;this.D=this.f=null;this.i=0;this.b=this.g=this.c=this.h=null}Dc.prototype.clone=function(){var a=new Dc;a.a=this.a;a.f=this.f;a.D=this.D;a.i=this.i;a.h=this.h;a.c=this.c;a.g=this.g;a.b=N(this.b);return a};function Fc(){this.a=[]}Fc.prototype.clone=function(){var a=new Fc;a.a=yc(this.a)||[];return a};function Gc(){this.repeat=this.duration=this.startTime=null}
Gc.prototype.clone=function(){var a=new Gc;a.startTime=this.startTime;a.duration=this.duration;a.repeat=this.repeat;return a};function Hc(a,b){this.Ka=a;this.end=b}Hc.prototype.clone=function(){return new Hc(this.Ka,this.end)};jc.TAG_NAME="MPD";kc.TAG_NAME="Period";lc.TAG_NAME="AdaptationSet";mc.TAG_NAME="Role";nc.TAG_NAME="Accessibility";oc.TAG_NAME="ContentComponent";rc.TAG_NAME="Representation";tc.TAG_NAME="ContentProtection";uc.TAG_NAME="cenc:pssh";vc.TAG_NAME="BaseURL";sc.TAG_NAME="AudioChannelConfiguration";
wc.TAG_NAME="Location";xc.TAG_NAME="SegmentBase";zc.TAG_NAME="RepresentationIndex";pc.TAG_NAME="FBInitializationBinary";qc.TAG_NAME="FBSegmentIndexBinary";Ac.TAG_NAME="Initialization";Bc.TAG_NAME="SegmentList";Cc.TAG_NAME="SegmentURL";Dc.TAG_NAME="SegmentTemplate";Fc.TAG_NAME="SegmentTimeline";Gc.TAG_NAME="S";
jc.prototype.parse=function(a,b){this.url=a.nc;this.id=L(b,"id",M);this.type=L(b,"type",M)||"static";this.manifestIsLiveStreaming="dynamic"===this.type;this.FBWasLive=L(b,"FBWasLive",Ic)||!1;this.FBIsLiveTemplated=L(b,"FBIsLiveTemplated",Ic)||!1;VideoPlayerShakaGlobalConfig.getBool("override_fb_is_live_templated",!1)&&(this.FBIsLiveTemplated=!1);this.b=L(b,"mediaPresentationDuration",Jc);this.h=L(b,"minBufferTime",Jc,this.h);this.g=L(b,"minimumUpdatePeriod",Jc,this.g);this.c=L(b,"availabilityStartTime",
Kc,this.c);this.f=L(b,"timeShiftBufferDepth",Jc,this.f);this.f=null;this.i=L(b,"suggestedPresentationDelay",Jc,this.i);var c=a.baseUrl,d=Lc(this,b,vc);this.baseUrl=Mc(c,d);if(d=K(this,b,wc))this.j=Nc(c,d.url);this.a=Lc(this,b,kc)};function Oc(a,b,c,d){if(0!==a.a.length){var e=new lc;e.contentType="text";e.lang=c||"en";e.f=!0;c=new rc;c.bandwidth=0;c.mimeType=d||"text/vtt";c.baseUrl=[new J(b)];e.a.push(c);a.a[0].a.push(e);Pc(a.a[0])}}
kc.prototype.parse=function(a,b){this.id=L(b,"id",M);this.start=L(b,"start",Jc);this.duration=L(b,"duration",Jc);var c=Lc(this,b,vc);this.baseUrl=Mc(a.baseUrl,c);this.b=K(this,b,xc);this.c=K(this,b,Bc);this.f=K(this,b,Dc);this.a=Lc(this,b,lc);Pc(this)};function Pc(a){for(var b=[],c=0;c<a.a.length;++c){var d=a.a[c];null!=d.group&&(b[d.group]=!0)}for(c=0;c<a.a.length;++c)if(d=a.a[c],null==d.group){for(var e=1;1==b[e];)++e;b[e]=!0;d.group=e}}
lc.prototype.parse=function(a,b){var c=K(this,b,oc)||{},d=K(this,b,mc);this.id=L(b,"id",M);this.group=L(b,"group",O);this.lang=L(b,"lang",M,c.lang);this.contentType=L(b,"contentType",M,c.contentType);this.width=L(b,"width",P);this.height=L(b,"height",P);this.mimeType=L(b,"mimeType",M);this.codecs=L(b,"codecs",M);this.c=L(b,"FBProjection",M);this.f=d&&"main"==d.value;this.lang&&(this.lang=Wa(this.lang));c=Lc(this,b,vc);this.baseUrl=Mc(a.baseUrl,c);this.j=Lc(this,b,tc);!this.contentType&&this.mimeType&&
(this.contentType=this.mimeType.split("/")[0]);this.g=a.b?Qc(this,b,a.b):K(this,b,xc);this.h=a.c?Qc(this,b,a.c):K(this,b,Bc);this.i=a.f?Qc(this,b,a.f):K(this,b,Dc);this.a=Lc(this,b,rc);this.b=K(this,b,nc);!this.mimeType&&this.a.length&&(this.mimeType=this.a[0].mimeType,!this.contentType&&this.mimeType&&(this.contentType=this.mimeType.split("/")[0]))};mc.prototype.parse=function(a,b){this.value=L(b,"value",M)};nc.prototype.parse=function(a,b){this.a=L(b,"schemeIdUri",M);this.lang=L(b,"lang",M)};
oc.prototype.parse=function(a,b){this.id=L(b,"id",M);this.lang=L(b,"lang",M);this.contentType=L(b,"contentType",M);this.lang&&(this.lang=Wa(this.lang))};
rc.prototype.parse=function(a,b){this.id=L(b,"id",M);this.bandwidth=L(b,"bandwidth",P);this.width=L(b,"width",P,a.width);this.height=L(b,"height",P,a.height);this.mimeType=L(b,"mimeType",M,a.mimeType);this.codecs=L(b,"codecs",M,a.codecs);this.fbQualityLabel=L(b,"FBQualityLabel",M);this.fbQualityClass=L(b,"FBQualityClass",M);this.l=L(b,"FBAbrPolicyTags",M);VideoPlayerShakaGlobalConfig.getBool("mpd_parse_mos_attributes",!1)&&(this.o=L(b,"FBPlaybackResolutionMos",MosUtils.parsePlaybackMos),this.s=L(b,
"FBPlaybackResolutionMosConfidenceLevel",M));VideoPlayerShakaGlobalConfig.getBool("mpd_parse_frame_and_audio_sampling_rate",!1)&&(this.frameRate=L(b,"frameRate",M),this.j=L(b,"audioSamplingRate",P));this.lang=a.lang;var c=Lc(this,b,vc);this.baseUrl=Mc(a.baseUrl,c);VideoPlayerShakaGlobalConfig.getBool("add_inline_initialization_resources",!1)&&(this.g=K(this,b,pc),this.h=K(this,b,qc));this.c=Lc(this,b,tc);this.i=K(this,b,sc);this.f=a.g?Qc(this,b,a.g):K(this,b,xc);this.b=a.h?Qc(this,b,a.h):K(this,b,
Bc);this.a=a.i?Qc(this,b,a.i):K(this,b,Dc);this.c=this.c.concat(a.j)};pc.prototype.parse=qc.prototype.parse=function(a,b){if(b&&b.firstChild){var c=Rc(b);null!=c&&(this.data=Ob(c).buffer)}};tc.prototype.parse=function(a,b){this.c=b;this.f=L(b,"schemeIdUri",M);var c=L(b,"cenc:default_KID",M);c&&(this.b=c.replace(/[-]/g,""));this.a=K(this,b,uc)};
uc.prototype.parse=function(a,b){var c=Rc(b);if(c){this.psshBox=Ob(c);try{this.parsedPssh=new Ub(this.psshBox)}catch(d){if(!(d instanceof RangeError))throw d;}}};vc.prototype.parse=function(a,b){var c=b.childNodes,d="";if(1==c.length)d=Rc(b);else for(var e=0;e<c.length;e++)c[e].nodeType==Node.TEXT_NODE&&(d+=c[e].nodeValue);this.url=d};wc.prototype.parse=function(a,b){this.url=Rc(b)};
xc.prototype.parse=function(a,b){this.baseUrl=a.baseUrl||this.baseUrl;this.a=L(b,"timescale",P,this.a);this.h=L(b,"presentationTimeOffset",O,this.h);this.b=L(b,"indexRange",Sc,this.b);this.g=L(b,"FBFirstSegmentRange",Sc,this.g);this.c=K(this,b,zc)||this.c;this.f=K(this,b,Ac)||this.f};zc.prototype.parse=function(a,b){var c=L(b,"sourceURL",M);this.url=Nc(a.baseUrl,c);this.a=L(b,"range",Sc,N(a.b))};
Ac.prototype.parse=function(a,b){var c=L(b,"sourceURL",M);this.url=Nc(a.baseUrl,c);this.a=L(b,"range",Sc)};
Bc.prototype.parse=function(a,b){this.baseUrl=a.baseUrl||this.baseUrl;this.a=L(b,"timescale",P,this.a);this.f=L(b,"presentationTimeOffset",O,this.f);this.D=L(b,"duration",P,this.D);var c=L(b,"startNumber",P);null!=c&&(this.h=c);this.g=K(this,b,Ac)||this.g;this.c=(c=Lc(this,b,Cc))&&0<c.length?c:this.c;this.b=K(this,b,Fc)||this.b;VideoPlayerShakaGlobalConfig.getBool("calculate_quick_dash_presentation_time_offset_from_timeline",!1)&&(c=VideoPlayerShakaGlobalConfig.getNumber("calculate_quick_dash_presentation_time_offset_epsilon_ms",
250),this.b&&this.b.a[0]&&(this.f=1E3<this.b.a[0].startTime?this.b.a[0].startTime-c:this.f))};Cc.prototype.parse=function(a,b){var c=L(b,"media",M);this.b=Nc(a.baseUrl,c);this.a=L(b,"mediaRange",Sc)};
Dc.prototype.parse=function(a,b){this.a=L(b,"timescale",P,this.a);this.f=L(b,"presentationTimeOffset",O,this.f);this.D=L(b,"duration",P,this.D);var c=L(b,"startNumber",O);null!=c&&(this.i=c);this.h=L(b,"media",M,this.h);this.c=L(b,"index",M,this.c);this.g=L(b,"initialization",M,this.g);this.b=K(this,b,Fc)||this.b};Fc.prototype.parse=function(a,b){this.a=Lc(this,b,Gc)};Gc.prototype.parse=function(a,b){this.startTime=L(b,"t",O);this.duration=L(b,"d",O);this.repeat=L(b,"r",Tc)};
function Mc(a,b){if(!b||0===b.length)return a;for(var c=[],d=0;d<b.length;d++){var e=b[d].url;null==a||0===a.length?c.push(new J(e)):(e=Nc(a.slice(0,1),e),c.push(e[0]))}return c}function Nc(a,b){if(!b)return a;var c=new J(b);return a?a.map(function(a){return a.resolve(c)}):[c]}function Qc(a,b,c){var d=N(c);(b=Uc(b,c.constructor.TAG_NAME))&&d.parse(a,b);return d}function K(a,b,c){var d=null;if(b=Uc(b,c.TAG_NAME))d=new c,d.parse(a,b);return d}
function Uc(a,b){for(var c=null,d=0;d<a.childNodes.length;d++)if(a.childNodes[d].tagName==b){if(c)return null;c=a.childNodes[d]}return c}function Lc(a,b,c){for(var d=[],e=0;e<b.childNodes.length;e++)if(b.childNodes[e].tagName==c.TAG_NAME){var f=new c;f.parse.call(f,a,b.childNodes[e]);d.push(f)}return d}function Rc(a){a=a.firstChild;return a.nodeType!=Node.TEXT_NODE?null:a.nodeValue}function yc(a){return a?a.map(function(a){return a.clone()}):null}function N(a){return a?a.clone():null}
function L(a,b,c,d){a=a.hasAttribute(b)?c(a.getAttribute(b)):null;return null!=a?a:void 0!==d?d:null}function Kc(a){if(!a)return null;a=Date.parse(a);return isNaN(a)?null:Math.floor(a/1E3)}
function Jc(a){if(!a)return null;var b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(a);if(!b)return null;a=0;var c=O(b[1]);c&&(a+=31536E3*c);(c=O(b[2]))&&(a+=2592E3*c);(c=O(b[3]))&&(a+=86400*c);(c=O(b[4]))&&(a+=3600*c);(c=O(b[5]))&&(a+=60*c);b=window.parseFloat(b[6]);(b=isNaN(b)?null:b)&&(a+=b);return a}
function Sc(a){var b=/([0-9]+)-([0-9]+)/.exec(a);if(!b)return null;a=O(b[1]);if(null==a)return null;b=O(b[2]);return null==b?null:new Hc(a,b)}function Tc(a){a=window.parseInt(a,10);return isNaN(a)?null:a}function P(a){a=window.parseInt(a,10);return 0<a?a:null}function O(a){a=window.parseInt(a,10);return 0<=a?a:null}function Ic(a){switch(a.toLowerCase()){case "true":return!0;case "false":return!1;default:return null}}function M(a){return a};function Vc(a,b){this.url=a;this.b=b||new yb;this.j=0;this.g=-1;this.h=this.i=0;this.a=null;this.c=new G;this.f=null;this.o=this.b.i;this.m=this.b.o}q("shaka.util.AjaxRequest",Vc);function yb(){this.body=null;this.b=1;this.j=1E3;this.f=0;this.method="GET";this.g="arraybuffer";this.c={};this.h=this.s=!1;this.aa=this.a=this.v=null;this.l=!1;this.o=this.i=this.mimeType=null}var Wc=!0;function Xc(a){Yc(a);Zc(a);a.b.body=null;a.c.destroy();a.c=null;a.f=null}
function Zc(a){a.a&&(a.a.onload=null,a.a.onreadystatechange=null,a.a.onerror=null,a.a.ontimeout=null);a.a=null}function Yc(a){-1!==a.g&&(clearTimeout(a.g),a.g=-1)}var $c=/(.*)\.(xx|fna)\.fbcdn\.net/,ad=/livestream-lookaside\.facebook\.com$/;
Vc.prototype.l=function(){if(this.a)return this.c;if(0==this.url.lastIndexOf("data:",0)){var a=this.url.split(":")[1].split(";").pop().split(","),b=a.pop(),b="base64"==a.pop()?window.atob(b.replace(/-/g,"+").replace(/_/g,"/")):window.decodeURIComponent(b);"arraybuffer"==this.b.g&&(b=Nb(b).buffer);a=JSON.parse(JSON.stringify(new XMLHttpRequest));a.response=b;a.responseText=b.toString();b=this.c;b.resolve(a);Xc(this);return b}if(0==this.url.lastIndexOf("idb:",0))return this.s();this.j++;this.i=performanceNow();
this.h||(this.h=this.b.j);this.a=new XMLHttpRequest;var c=this.url,a=new J(c);Wc&&(this.f&&!this.f.supportsCaching()||this.b.h)&&hc(a.a,"_",Date.now());c=$c.test(c);if(null!=this.b.a&&c){var d=this.b.a,e=a.a;null!=d.a&&(d.h=d.a.getSegmentsToPush(),d.f=d.a.getSegmentStartTime(),d.g=d.a.getSegmentOffset(),d.c=d.a.getPushVideoRepresentationID(),d.b=d.a.getPushAudioRepresentationID(),d.j=d.a.getUseLongCacheForManifest());null!=d.h&&hc(e,"_nc_p_n",d.h);null!=d.f?hc(e,"_nc_p_ts",d.f):null!=d.g&&hc(e,"_nc_p_o",
d.g);null!=d.c&&null!=d.b&&(hc(e,"_nc_p_rid",d.c),hc(e,"_nc_p_arid",d.b));d.i&&hc(e,"_nc_p_dbg","1");d.j&&hc(e,"_nc_nc","1")}1==this.b.l&&c&&hc(a.a,"_nc_playing",1);c=a.toString();a=ad.test(a.ja);this.a.open(this.b.method,c,!0);this.a.responseType=this.b.g;this.a.timeout=this.b.f;this.a.withCredentials=this.b.s||a;setEventProperty(this.a,"onload",this.bd.bind(this));setEventProperty(this.a,"onreadystatechange",this.gd.bind(this));setEventProperty(this.a,"onerror",this.$c.bind(this));setEventProperty(this.a,
"ontimeout",this.md.bind(this));setEventProperty(this.a,"onabort",this.Wc.bind(this));for(b in this.b.c)this.a.setRequestHeader(b,this.b.c[b]);this.a.send(this.b.body);return this.c};Vc.prototype.send=Vc.prototype.l;function bd(a,b,c){b=Error(b);b.type=c;b.status=a.a.status;b.url=a.url;b.method=a.b.method;b.body=a.b.body;return b}m=Vc.prototype;
m.Wc=function(){if(VideoPlayerShakaGlobalConfig.getBool("fix_shaka_util_ajax_request_abort",!0)){var a=bd(this,"Request aborted.","aborted");this.c.reject(a);Xc(this)}};
m.bd=function(a){if(this.f){var b=VideoPlayerResourceTimer.getResourceTimingEntry(this.url,this.i,performanceNow());this.f.sample(performanceNow()-this.i,a.loaded||this.a.response&&this.a.response.byteLength||0,this.b.mimeType?"v"===this.b.mimeType.charAt(0):!1,b,this.o,this.m,VideoPlayerShakaGlobalConfig.getBool("evaluate_abr_on_fetch_end",!1))}a=[403];200<=this.a.status&&299>=this.a.status?(this.c.resolve(this.a),Xc(this)):!VideoPlayerShakaGlobalConfig.getBool("remove_ajax_resend_internal",!0)&&
this.j<this.b.b&&-1===a.indexOf(this.a.status)?cd(this):(a=bd(this,"HTTP error.","net"),this.c.reject(a),Xc(this))};m.gd=function(){if(this.a.readyState==XMLHttpRequest.HEADERS_RECEIVED&&(this.a.Oa=Date.now()-this.i,this.b.a&&this.b.aa&&this.b.aa.addPushDataFromXHR(this.a),VideoClientEdgeCooperation.updateFromXHR(this.a),this.b.h)){var a=Date.parse(this.a.getResponseHeader("Date"));a&&(Ea=a-Date.now())}};m.$c=function(){var a=bd(this,"Network failure.","net");this.c.reject(a);Xc(this)};
m.md=function(){if(!VideoPlayerShakaGlobalConfig.getBool("remove_ajax_resend_internal",!0)&&this.j<this.b.b)cd(this);else{var a=bd(this,"Request timed out.","net");this.c.reject(a);Xc(this)}};function cd(a){Zc(a);a.g=setTimeout(function(){this.g=-1;this.l()}.bind(a),a.h*(1+.5*(2*Math.random()-1)));a.h*=2};function I(a,b,c,d){this.c=b;this.startByte=c||0;this.baseUrl=this.toString();this.endByte=null!=d?d:null;this.f=null;this.j=0;this.s=!1;this.g=null;this.l=a;this.h=null;this.i=!1;this.b=this.a=null}q("shaka.util.FailoverUri",I);I.prototype.o=function(a){this.s=a};I.prototype.setShouldReadXFbVideoBroadcastEndedHeader=I.prototype.o;I.prototype.A=function(){return this.j};I.prototype.getFbVideoBroadcastEndedResponseHeader=I.prototype.A;I.prototype.B=function(){return this.startByte};
I.prototype.getStartByte=I.prototype.B;I.prototype.v=function(){return this.endByte};I.prototype.getEndByte=I.prototype.v;function dd(a,b){return a&&0!==a.length?a.map(function(a){return a.resolve(b)}):[b]}m=I.prototype;m.fetch=function(a,b,c,d,e,f,h,g){return this.f?this.f:this.f=ed(this,0,a||new yb,b,c,d,e,f,h,g)};m.stream=function(a,b,c,d,e,f,h,g,k){return fd(this,0,a||new yb,b,c,d,e,f,h,g,k)};
function ed(a,b,c,d,e,f,h,g,k,l){return fd(a,b,c,d,e,f,h,g,k,l).then(function(a){var b,c=function(){return a.read().then(function(a){var d=a.value;if(a.done)return b||new ArrayBuffer(0);d&&("string"===typeof d?b=(b||"")+d:b=concatArrayBuffer(b||new ArrayBuffer(0),d));return c()}.bind(this))}.bind(this);return c()})}
m.Da=function(){if(this.g){this.a=this.f=null;var a=this.g;Yc(a);if(a.a&&a.a.readyState!=XMLHttpRequest.DONE&&(a.a.abort(),!VideoPlayerShakaGlobalConfig.getBool("fix_shaka_util_ajax_request_abort",!0))){var b=bd(a,"Request aborted.","aborted");a.c.reject(b);Xc(a)}this.h=this.g=null}this.b&&(this.b.abortRequest(gd(this)),VideoPlayerShakaGlobalConfig.getBool("fixing_scheduler_disable_leaks",!0)&&(this.b=null))};
function fd(a,b,c,d,e,f,h,g,k,l,n){a.b=l||null;var p;e&&(c.a&&(c.a.i=!0),l=0,c.aa&&(l=c.aa.getPushCountForUrl(a.c[b].toString())),(p=e.getOperationLogger("request"))&&p.setReason(k||null).setPushed(l).setType(g||null).setInitiator("shaka").start(),f&&(p=p.setParentLogger(f)));var v=performanceNow();a.a=null;h&&(c.i=h);e&&(c.o=e);var w=hd(a,a.c[b],c);k=null;a.i=!1;var C=VideoDashPrefetchCache.getCacheValue(w);C&&(k=C,a.i=!0,p&&(p.setConnectionQualityLevel(VideoDashPrefetchCache.getConnectionQualityLevel(w)),
p.setInitiator("prefetch")));if(!C&&n)return n.getStream(gd(a)).then(function(a){return a.getReader()}.bind(a));n=null;if(a.b&&!a.b.isDisabled()&&!k)try{(k=n=a.b.getPromise(gd(a)))?p=null:a.b.disable()}catch(Q){e&&e.getEventLogger("request_info_not_found").setResource(w).log()}k||(a.g=new Vc(w,c),a.j=0,d&&(a.g.f=d),k=a.g.l());p&&p.setResource(w);f&&f.setResource(w);var ba=!1,ca=k.then(H(a,function(a){!this.b||this.b.isDisabled()||this.a?this.a||(this.a=VideoPlayerResourceTimer.getResourceTimingEntry(w,
this.i?0:v,performanceNow())):this.a=this.b.getResourceTimingEntry(w);VideoPlayerShakaGlobalConfig.getBool("sample_prefetch_bandwidth",!1)&&C&&this.a&&0<this.a.timeToLastByte&&d&&d.sample(this.a.timeToLastByte,a.response.byteLength,"v"===g.charAt(0),this.a,h,e,!0);if(this.s)try{this.j=parseInt(a.getResponseHeader("x-fb-video-broadcast-ended"),10)}catch(c){}this.b=this.h=this.g=this.f=null;this.h=a.a?new J(a.a):this.c[b];a.response.Oa=a.Oa;p&&(p=p.setLength(a.response.byteLength||a.response.length).setWasPrefetchCacheHit(this.i),
null!=this.a&&(p=p.setTimeToLastByte(Math.round(this.a.timeToLastByte)).setTimeToFirstByte(Math.round(this.a.timeToFirstByte)).setTimeToRequestStart(Math.round(this.a.timeToRequestStart)),2E3<=this.a.timeToFirstByte&&-1<w.indexOf("akamaihd")&&logLongAkamaiRequest(a.getResponseHeader("Debug-Info")+", TTFB-> "+this.a.timeToFirstByte+", TTRS-> "+this.a.timeToRequestStart)),p.log());return Promise.resolve({value:a.response,done:!1})})),ca=ca.catch(H(a,function(a){if(this.f&&b+1<this.c.length)return this.f=
ed(this,b+1,c,d);this.b=this.a=this.f=this.g=null;p&&p.setError(a).log();return Promise.reject(a)}));return Promise.resolve({cancel:function(){},read:function(){return ba?Promise.resolve({value:null,done:!0}):ca.then(function(a){ba=!0;return a})}.bind(a)})}function gd(a){return{baseUrl:a.toString(),startByte:a.startByte,endByte:a.endByte}}m.clone=function(){return new I(this.l,this.c.map(function(a){return a.clone()}),this.startByte,this.endByte)};m.getResourceTimingEntry=function(){return this.a};
function hd(a,b,c){var d=b.toString();if(a.startByte||a.endByte)b=b.ja,!b.endsWith("fbcdn.net")||b.startsWith("interncache")||b.endsWith("ak.fbcdn.net")?c&&(c.c.Range="bytes="+(a.startByte+"-"+(null!=a.endByte?a.endByte:""))):(d+="&bytestart="+a.startByte,d+=null!==a.endByte?"&byteend="+a.endByte:"");a.l&&c&&(d=a.l(d,c.c)||d);return d}function zb(a){return hd(a,a.c[0])}m.toString=function(){return this.c[0].toString()};function id(a,b,c,d){this.a=new yb;b=null!=b?b:oa;this.a.g="text";this.a.b=3;this.a.f=1E3*b;c&&(this.a.a=c);d&&(this.a.aa=d);this.a.h=!0;this.b=a}
function jd(a,b){var c=a.b,d=VideoPlayerShakaGlobalConfig.getBool("detect_live_stream_ended_from_response_headers",!1);c.o(d);return c.fetch(a.a,null,b,null,null,"manifest").then(function(a){a instanceof ArrayBuffer&&(a=String.fromCharCode.apply(null,new Uint8Array(a)));var f=d&&!!c.j,h;b&&(h=b.getOperationLogger("parse_manifest").start());a=ic(a,c.c,[c.h]);h&&h.log();a&&"dynamic"===a.type&&f&&(a.type="static",b&&BanzaiODS.bumpEntityKey("videos.www.shaka","changed_manifest_to_dynamic_off_headers"));
if(a)return Promise.resolve(a);f=Error("MPD parse failure.");f.type="dash";return Promise.reject(f)})}function kd(a){this.a=null;this.h=a;this.c=this.g=this.f=null;this.i=!1;this.j=this.b=null};function ld(a,b){this.a=a;this.b=b||null}ld.prototype.destroy=function(){this.a&&(this.a.Da(),this.a=null);this.b=null};ld.prototype.create=function(a,b){var c=null;b&&(c=new yb,c.aa=b);return!this.b&&this.a?this.a.fetch(c,null,a,null,null,"init"):Promise.resolve(this.b)};ld.prototype.c=function(){return this.a};ld.prototype.getFailoverUri=ld.prototype.c;function md(a,b){this.segmentOriginalEndTime=a;this.gapDistance=b}function nd(a,b,c,d,e){this.startTime=a;this.endTime=b;this.url=c;this.unscaledStartTime=d;this.debugInfo=(this.timescaledGapInfo=e||null)?{endTime:this.timescaledGapInfo.segmentOriginalEndTime,delta:this.timescaledGapInfo.gapDistance}:null}function rd(a,b,c){return new nd(b,c,a.url,a.unscaledStartTime,a.timescaledGapInfo)}
function Db(a,b){if(VideoPlayerShakaGlobalConfig.getBool("use_binary_search_when_finding_segment_references",!1))return BinarySearch.findIndexInArray(a,b,function(a,b){return b>=a.startTime&&(null==a.endTime||b<a.endTime)?0:a.startTime-b});for(var c=a.length-1;0<=c;--c){var d=a[c];if(b>=d.startTime&&(null==d.endTime||b<d.endTime))return c}return-1}function sd(a,b){return a.map(function(a){return rd(a,a.startTime+b,null!=a.endTime?a.endTime+b:null)})};function td(a,b,c,d){for(var e=b.a,f=[],h=0;h<d;++h){var g=h+c,k=(g-1)*e.D,l=k/e.a,n=(k+e.D)/e.a,g=ud(a,b,e.i+g-1,k);if(!g)return null;f.push(new nd(l,n,g,k))}return f}function ud(a,b,c,d){if(!b.a)return null;var e=b.a.h;if(!e)return b.baseUrl?new I(a,b.baseUrl,0,null):null;c=vd(e,b.id,c,b.bandwidth,d);if(!c)return null;b=dd(b.baseUrl,c);return new I(a,b,0,null)}
function vd(a,b,c,d,e){var f={RepresentationID:b,Number:c,Bandwidth:d,Time:e};a=a.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)d)?\$/g,function(a,b,c){if("$$"==a)return"$";var d=f[b];if(null==d)return a;"RepresentationID"==b&&c&&(c=void 0);a=d.toString();c=window.parseInt(c,10)||1;c=Math.max(0,c-a.length);return Array(c+1).join("0")+a});try{return new J(a)}catch(h){if(h instanceof URIError)return null;throw h;}}
function wd(a,b,c){var d=0;c*=b;a=a.a;var e=[],f=VideoPlayerShakaGlobalConfig.getNumber("live_rewind_templated_last_x_segments_only",0);if(f){for(var h=0;h<a.length;++h){if(!a[h].duration)return e;var g=a[h].startTime,g=null!=g?g:d,k=a[h].repeat||0;if(0>k)if(k=a[h].duration,h+1===a.length)var l=a[0].startTime+c-g,k=Math.ceil(l/k)-1;else l=a[h+1].startTime,k=Math.ceil((l-g)/k)-1;a[h].startTime=g;a[h].repeat=k;d=a[h].startTime+a[h].duration*(a[h].repeat+1)}for(h=a.length-1;-1<h;--h)for(var n=0;n<=a[h].repeat;++n)if(g=
a[h].startTime+a[h].duration*(a[h].repeat-n),d=g+a[h].duration,c=null,e.length&&d!=e[e.length-1].start&&(l=e[e.length-1].start-d,c=new md(d/b,l/b)),e.push({start:g,end:d}),c&&(e[e.length-1].timescaledGapInfo=c),e.length===f)return e=e.reverse();return e.reverse()}for(h=0;h<a.length&&a[h].duration;++h)for(g=a[h].startTime,g=null!=g?g:d,k=a[h].repeat||0,0>k&&(k=a[h].duration,h+1===a.length?(l=a[0].startTime+c-g,k=Math.ceil(l/k)-1):(l=a[h+1].startTime,k=Math.ceil((l-g)/k)-1)),0<e.length&&g!=d&&(l=g-
d,f=e[e.length-1],f.timescaledGapInfo=new md(d/b,l/b),f.end=g),n=0;n<=k;++n)d=g+a[h].duration,e.push({start:g,end:d}),g=d;return e};function xd(a,b,c,d){this.o=a;this.j=b;this.g=c;this.X=0;this.a=c.a||0;this.s=!1;this.h=null;this.v=d;this.i=c.f||0;this.c=0;a:{b=c.b;var e=0;a=(a.duration||0)*this.a;c=b.a;for(d=0;d<c.length;++d){if(!c[d].duration){b.a=c.slice(0,d);break a}var f=c[d].startTime,e=null!=f?f:e,f=c[d].repeat||0;0>f&&(f=c[d].duration,f=d+1===c.length?Math.ceil((c[0].startTime+a-e)/f)-1:Math.ceil((c[d+1].startTime-e)/f)-1);c[d].startTime=e;c[d].repeat=f;e=c[d].startTime+c[d].duration*(c[d].repeat+1)}}this.f=[];this.l=
VideoPlayerShakaGlobalConfig.getNumber("timeline_segment_index_max_index_cache_length",0);this.c=ShakaTimelineSegmentIndexUtils.length(this.g.b.a)}xd.prototype.destroy=function(){this.c=this.g=this.j=this.o=null;this.h=function(){};this.f=this.v=null};m=xd.prototype;m.length=function(){return this.c};function yd(a,b){for(var c=a.f.length-1;-1<c;c--)if(a.f[c].index===b){var d=a.f[c];a.f.splice(c,1);a.f.push(d);return d.qd}return null}
function zd(a,b,c){var d=[];if(a.l&&1===c-b){var e=yd(a,b);if(e)return[e]}var f=-a.i/a.a+a.X;ShakaTimelineSegmentIndexUtils.getSegments(b,c,a.g.b.a,function(a,e,k,l,n){if(l){var p=d[d.length-1];p&&(p.timescaledGapInfo=new md(n/this.a,l/this.a),p.debugInfo={endTime:p.timescaledGapInfo.segmentOriginalEndTime,delta:p.timescaledGapInfo.gapDistance},d[d.length-1]=rd(p,p.startTime,a/this.a+f))}k=ud(this.v,this.j,k+this.g.i,a);if(!k)throw a=Error("Failed to generate media URL."),a.type="dash",a;a=new nd(a/
this.a+f,e/this.a+f,k,a,null);e=b+d.length;d.push(a);!this.l||0!==e&&e!==this.c-1&&1!==c-b||yd(this,e)||(this.f.length+1>this.l&&this.f.shift(),this.f.push({index:e,qd:a}))}.bind(a));return d}m.getSegments=function(){return zd(this,0,this.c)||[]};m.S=function(){if(!this.c)throw new RangeError("Index out of range.");return zd(this,0,1)[0]};m.w=function(){if(!this.c)throw new RangeError("Index out of range.");return zd(this,this.c-1,this.c)[0]};
m.get=function(a){if(!this.c||0>a||a>=this.c)throw new RangeError("Index out of range.");return zd(this,a,a+1)[0]};m.findIndex=function(a){return ShakaTimelineSegmentIndexUtils.findIndex(a,this.g.b.a,this.a,-this.i/this.a+this.X)};
m.lb=function(a){if(a.length()!==this.c||0!==this.c&&a.w().endTime!==this.w().endTime){this.s=!1;var b=a.w();null!=b.endTime&&b.endTime<this.w().endTime&&b.endTime<this.S().startTime&&(this.s=!0);this.o=a.o;this.j=a.j;this.g=a.g;this.i=this.g.f||0;this.a=this.g.a||0;this.f=[];this.c=ShakaTimelineSegmentIndexUtils.length(this.g.b.a);this.h&&this.h(this.getSegments())}};m.sc=function(a){var b=a-this.X;if(0==b)return 0;this.X=a;this.f=[];return b};
m.uc=function(){return this.c?{start:this.S().startTime,end:this.w().endTime}:{start:0,end:0}};m.getSeekRangeGaps=function(){return ShakaTimelineSegmentIndexUtils.getSeekRangeGaps(this.g.b.a,this.a,-this.i/this.a+this.X)};m.hb=function(){return this.s};m.vc=function(a){a=a?this.findIndex(a):0;return zd(this,a,this.c).map(function(a,c){return Ad(a,c)}.bind(this))};m.tc=function(){return this.c?Ad(this.w(),this.c-1):null};
function Ad(a,b){return{startTime:a.startTime,endTime:null===a.endTime?Number.POSITIVE_INFINITY:a.endTime,segmentID:b,requestInfo:gd(a.url)}}m.wc=function(a){this.h=a};m.rc=function(){this.h=null};m.Ya=function(){};function Bd(){}
Bd.prototype.parse=function(a,b,c,d,e){var f=null;try{a:{var h=[],g=new Fa(a),k=t(g);if(1936286840!=t(g))f=null;else{1==k&&(k=Ja(g));var l=Ia(g);La(g,3);La(g,4);var n=t(g);if(0==n)f=null;else{var p,v;0==l?(p=t(g),v=t(g)):(p=Ja(g),v=Ja(g));La(g,2);var w=g.b.getUint16(g.a,g.c);g.a+=2;a=p;b=b+k+v;for(v=k=0;v<w;v++){var C=t(g);p=(C&2147483648)>>>31;var l=C&2147483647,Q=t(g);t(g);if(1==p){f=null;break a}var ba;ba=0==v&&e?e:new I(d,c,b,b+l-1);p=a/n;var ca=(a+Q)/n;0===v&&(k=p);h.push(new nd(p-k,ca-k,ba,
a));a+=Q;b+=l}h.a=n;f=h}}}}catch(ta){if(!(ta instanceof RangeError))throw ta;}return f};function R(a){this.b=a;this.a=this.b.a;this.h=[]}R.prototype.H=function(){return!!this.h[this.h.length-1]};R.prototype.lastPollHadChanges=R.prototype.H;R.prototype.G=function(){var a=this.h,b=a.lastIndexOf(!0);if(1>b)return 0;a=a.lastIndexOf(!0,b-1);return 0>a?0:b-a-1};R.prototype.getFetchesBetweenRecentChanges=R.prototype.G;R.prototype.v=function(){return Math.floor((this.h.length-1-this.h.lastIndexOf(!0))/2)};R.prototype.getConsecutiveUpdatesWithoutChanges=R.prototype.v;
R.prototype.F=function(){return this.h.length-1-this.h.lastIndexOf(!1)};R.prototype.getConsecutiveUpdatesWithChanges=R.prototype.F;R.prototype.destroy=function(){this.b.destroy();this.b=null};R.prototype.length=function(){return this.b.length()};R.prototype.getSegments=function(){return this.b.getSegments()};R.prototype.getSegments=R.prototype.getSegments;R.prototype.w=function(){return this.b.w()};R.prototype.last=R.prototype.w;m=R.prototype;m.get=function(a){return this.b.get(a)};m.findIndex=function(a){return this.b.findIndex(a)};
m.xb=function(a){this.b.lb(a.b);return!0};m.Ia=function(a){return this.b.sc(a)};m.wb=function(){return this.b.uc()};m.getSeekRangeGaps=function(){return this.b.getSeekRangeGaps()};R.prototype.getSeekRangeGaps=R.prototype.getSeekRangeGaps;R.prototype.hb=function(){return this.b.hb()};function Cd(a,b){a.b.wc(b)};function S(a,b,c,d){R.call(this,a);this.j=b;this.C=c;this.i=d;this.duration=this.j.b||this.j.a.reduce(function(a,b){return null==b.duration?NaN:a+b.duration},0)||0;this.c=this.s=this.g=null;Dd(this)}r(S,R);S.prototype.destroy=function(){this.C=this.j=null;R.prototype.destroy.call(this)};S.prototype.xb=function(a){if(!(a instanceof S))return!1;this.b.lb(a.b);this.duration=Math.max(this.duration,a.duration);null==this.g?(this.i=a.i,Dd(this)):Ed(this);return!0};
function Dd(a){Ed(a);if(0!=a.length()){a.length();var b=null!=a.w().endTime?a.w().endTime:a.w().startTime;if(a.j.c>a.i)a.g=b;else{var c=a.i-(a.j.c+a.C.start);0>c?a.g=b:c<Math.max(a.w().startTime,a.w().endTime||0)?(a.w(),a.g=b):a.g=c}a.s=a.w().startTime;a.c=a.b.S().startTime}}
S.prototype.Ia=function(a){a=R.prototype.Ia.call(this,a);VideoPlayerShakaGlobalConfig.getBool("no_correct_delta_warning",!1)||Math.min.apply(null,this.getSegments().filter(function(a){return null!=a.endTime}).map(function(a){return a.endTime-a.startTime}));null!=this.g&&(this.s+=a,this.c+=a,this.g+=a);return a};S.prototype.wb=function(){return Fd(this,(Date.now()+Ea)/1E3)};
function Fd(a,b){if(a.b.b&&(Ed(a),null!=a.j.f))if(null==a.g)a.length();else{for(var c=a.g+(b-a.i),d=0,e=0;e<a.b.b.length;++e){var f=null;e<a.b.b.length-1?f=a.b.b[e+1].endTime:(f=a.b.b[e],f=null!=f.endTime?f.endTime+(f.endTime-f.startTime):null);if(null!=f&&f<c-a.j.f)++d;else break}0<d&&a.b.b.splice(0,d)}if(null==a.g||null==a.s||null==a.c)return{start:0,end:0};c=Number.POSITIVE_INFINITY;a.duration&&(c=a.duration);d=b-a.i;e=a.g+d;null!=a.j.f&&(e=e-a.c-a.j.f,0<e&&(a.c+=e));a.c=Math.min(a.c,c);d=a.s+
d;if(d<a.c)return{start:a.c,end:a.c};d=0<a.length()?null!=a.w().endTime?Math.min(d,a.w().endTime):d:a.c;d=Math.max(d,a.c);d=Math.min(d,c);return{start:a.c,end:d}}function Ed(a){if(a.duration&&a.b.b){for(var b=0,c=a.b.b.length-1;0<=c;--c)if(a.b.b[c].startTime>a.duration)++b;else break;0<b&&a.b.b.splice(-b)}};function T(a,b){this.b=a;this.X=0;this.a=b;this.c=!1;this.f=function(){}}T.prototype.destroy=function(){this.b=null};T.prototype.length=function(){return this.b.length};T.prototype.getSegments=function(){return(this.b||[]).slice()};T.prototype.getSegments=T.prototype.getSegments;T.prototype.S=function(){if(0==this.b.length)throw new RangeError("SegmentIndexBase: There is no first SegmentReference.");return this.b[0]};
T.prototype.w=function(){if(0==this.b.length)throw new RangeError("SegmentIndexBase: There is no last SegmentReference.");return this.b[this.b.length-1]};T.prototype.last=T.prototype.w;m=T.prototype;m.get=function(a){if(0>a||a>=this.b.length)throw new RangeError("SegmentIndexBase: The specified index is out of range.");return this.b[a]};m.findIndex=function(a){return Db(this.b,a)};
m.lb=function(a){this.X!=a.X&&(a=new T(sd(a.b,this.X-a.X),a.a));if(0==this.length())this.b=a.b.slice(0),this.Ya();else if(0!=a.length()&&null!=this.w().endTime)if(null!=a.w().endTime&&a.w().endTime<this.w().endTime)VideoPlayerShakaGlobalConfig.getBool("fix_manifest_wrapped",!0)?a.w().endTime<this.S().startTime&&(this.c=!0):this.c=!0;else{this.c=!1;if(this.w().endTime<=a.S().startTime)var b=rd(this.w(),this.w().startTime,a.S().startTime),b=this.b.slice(0,-1).concat([b]);else{var c;for(c=0;c<this.b.length&&
!(this.b[c].endTime>=a.S().startTime);++c);this.b[c].startTime<a.S().startTime?(b=rd(this.b[c],this.b[c].startTime,a.S().startTime),b=this.b.slice(0,c).concat([b])):(this.S().startTime>a.S().startTime||a.S(),b=this.b.slice(0,c))}this.b=b.concat(a.b);this.f(a.b);this.Ya()}};m.sc=function(a){var b=a-this.X;if(0==b)return 0;this.b=sd(this.b,b);this.Ya();this.X=a;return b};m.uc=function(){return 0<this.length()?{start:this.S().startTime,end:this.w().endTime}:{start:0,end:0}};
m.getSeekRangeGaps=function(){return getSeekRangeGapsFromShakaReferences(this.b,this.a)};T.prototype.getSeekRangeGaps=T.prototype.getSeekRangeGaps;m=T.prototype;m.hb=function(){return this.c};m.vc=function(a){var b=[];if(null===a||void 0===a)b=this.b;else{for(var c=0;c<this.b.length;c++){var d=this.b[this.b.length-c-1];d.startTime>=a&&b.push(d)}b.reverse()}return b.map(function(a,b){return Gd(a,b)}.bind(this))};m.tc=function(){return 0===this.b.length?null:Gd(this.w(),this.b.length-1)};
function Gd(a,b){return{startTime:a.startTime,endTime:null===a.endTime?Number.POSITIVE_INFINITY:a.endTime,segmentID:b,requestInfo:gd(a.url)}}m.wc=function(a){this.f=a};m.rc=function(){this.f=function(){}};m.Ya=function(){};function Hd(a,b,c,d,e){var f=1,h=0,g;if(a.c>d)g=null;else{var k=a.i||0,l=a.f||0;g=c.a;g=g.D/g.a;var n=d-(a.c+b.start);0>n?g=null:(l=n-2*g-l,0>l&&(l=0),l=Math.ceil(l/g)*g,n-=g,0>n?g=null:(k=Math.floor(n/g)*g-k,0>k&&(k=0),k=Math.floor(k/g)*g,g={ic:l/g+1,current:(k>=l?k:l)/g+1}))}g&&(f=g.ic,h=g.current-g.ic+1);f=td(e,c,f,h);if(null==f)throw a=Error("Failed to generate SegmentReferences."),a.type="stream",a;S.call(this,new T(f,c.a.a||1),a,b,d);this.A=c;this.o=this.f=0<this.length()?a.c+b.start+this.w().endTime:
null;this.l=g?g.current+1:null;this.B=e}r(Hd,S);Hd.prototype.destroy=function(){this.B=this.A=null;S.prototype.destroy.call(this)};Hd.prototype.xb=function(a){if(null!=this.f||!(a instanceof Hd)||null==a.f)return!1;this.f=a.f;this.o=a.o;this.l=a.l;this.i=a.i;this.duration=a.duration;this.b.lb(a.b);Id(this,(Date.now()+Ea)/1E3);Dd(this);return!0};Hd.prototype.Ia=function(a){a=S.prototype.Ia.call(this,a);null!=this.f&&(this.f+=a,this.o+=a);return a};
Hd.prototype.wb=function(){var a=(Date.now()+Ea)/1E3;Id(this,a);return Fd(this,a)};function Id(a,b){if(null!=a.f&&null!=a.o&&null!=a.l){var c=a.A.a,c=c.D/c.a,d=Math.floor((a.o+(b-a.i)-a.f)/c);if(0!=d){var e=td(a.B,a.A,a.l,d);Array.prototype.push.apply(a.b.b,sd(e,a.b.X));a.b.Ya();a.f+=d*c;a.l+=d}}};function Jd(a,b,c,d,e){this.g=a;this.f=b;this.c=c;this.i=d;this.a=null;this.h=e}Jd.prototype.destroy=function(){this.h=this.c=this.f=this.g=null;this.a&&(this.a.destroy(),this.a=null)};
Jd.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if("dynamic"==this.g.type)try{this.a=new Hd(this.g,this.f,this.c,this.i,this.h)}catch(a){return Promise.reject(a)}else{var b;b=this.c.a;if(b=td(this.h,this.c,1,Math.ceil(this.f.duration/(b.D/b.a)))){if(0<b.length){var c=b[b.length-1];b[b.length-1]=rd(c,c.startTime,this.f.duration)}b=new R(new T(b,this.c.a.a||1))}else b=null;this.a=b;if(!this.a)return b=Error("Failed to generate SegmentReferences"),b.type="stream",Promise.reject(b)}return Promise.resolve(this.a)};
Jd.prototype.b=function(){return this.a};function Kd(a,b,c,d,e){this.f=a;this.c=b;this.h=c;this.a=null;this.i=d;this.g=e}Kd.prototype.destroy=function(){this.g=this.h=this.c=this.f=null;this.a&&(this.a.destroy(),this.a=null)};
Kd.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=this.h.b,b=[];a.b&&(b=wd(a.b,a.a||1,this.c.duration||0));var c=0;a.D&&a.h?c=(a.h-1)*a.D:0<b.length&&(c=b[0].start-(a.f||0));var d=c,e=a.c.length;0<b.length&&b.length!=a.c.length&&(e=Math.min(b.length,a.c.length));for(var f=[],h=0;h<e;++h){var g=a.c[h],k=c,l=k/a.a,n=c=null,p;a.D?(c=k+a.D,n=c/a.a):0<b.length?(p=b[h].timescaledGapInfo,c=b[h].end-(a.f||0),n=c/a.a):(n=l+this.c.duration,c=n*a.a);var v=0,w=null;g.a&&(v=g.a.Ka,
w=g.a.end);n=Math.min(this.c.duration+d/a.a,n);f.push(new nd(l,n,new I(this.g,g.b,v,w),k,p||null))}a=new T(f,a.a||1);"dynamic"==this.f.type?this.a=new S(a,this.f,this.c,this.i):this.a=new R(a);return Promise.resolve(this.a)};Kd.prototype.b=function(){return this.a};function Ld(a,b,c,d,e){this.g=a;this.f=b;this.c=c;this.i=d;this.a=null;this.h=e}Ld.prototype.destroy=function(){this.h=this.c=this.f=this.g=null;this.a&&(this.a.destroy(),this.a=null)};
Ld.prototype.create=function(){if(this.a)return Promise.resolve(this.a);if(VideoPlayerShakaGlobalConfig.getBool("use_timeline_segment_index",!1))var a=new xd(this.f,this.c,this.c.a,this.h);else{for(var a=this.c.a,b=wd(a.b,a.a||1,this.f.duration||0),c=[],d=0;d<b.length;++d){var e=b[d].start,f=b[d].timescaledGapInfo,h=e/a.a,g=b[d].end/a.a,k=ud(this.h,this.c,d+a.i,e);if(!k)return a=Error("Failed to generate media URL."),a.type="dash",Promise.reject(a);var l=(a.f||0)/a.a;c.push(new nd(h-l,g-l,k,e,f||
null))}a=new T(c,a.a||1)}this.g.manifestIsLiveStreaming?this.a=new S(a,this.g,this.f,this.i):this.a=new R(a);return Promise.resolve(this.a)};Ld.prototype.b=function(){return this.a};function Md(){this.T=Nd++;this.id=this.W=this.N=null;this.a=0;this.height=this.width=this.bandwidth=null;this.codecs=this.mimeType="";this.f=this.fbQualityClass=this.fbQualityLabel=null;this.frameRate="";this.switchReason=this.h=this.g=this.c=null;this.b=[];this.ma=!1;this.ca=!0}var Nd=0;Md.prototype.destroy=function(){this.N&&(this.N.destroy(),this.N=null);this.W&&(this.W.destroy(),this.W=null)};function Od(a){return a.mimeType.split("/")[0]}
function Pd(a){var b=a.mimeType||"";a.codecs&&(b+='; codecs="'+a.codecs+'"');return b}function Qd(){this.T=Rd++;this.id=null;this.contentType=this.lang="";this.f=this.b=!1;this.c=null;this.u=[];this.a=[]}var Rd=0;Qd.prototype.destroy=function(){for(var a=0;a<this.u.length;++a)this.u[a].destroy();this.a=this.u=null};function Sd(a){for(var b=[],c=0;c<a.a.length;++c){var d=new Td;d.id=a.T;d.a=a.a[c];d.contentType=a.contentType;d.b=a.u.length?Pd(a.u[0]):"";b.push(d)}return b}
function Ud(){this.id=null;this.start=0;this.duration=null;this.a=[]}Ud.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Vd(){this.s=this.o=this.b=!1;this.i=this.h=this.c=null;this.f=0;this.a=[];this.g=!1;this.l="none";this.j=null}Vd.prototype.destroy=function(){for(var a=0;a<this.a.length;++a)this.a[a].destroy();this.a=null};function Td(){this.id=0;this.a=null;this.b=this.contentType=""};function U(a,b,c,d,e,f,h,g,k,l,n,p,v){E.call(this,a);this.b=b;this.a=c;this.c=new rb(c,d,e,f,this,g);this.Va=g;this.s={};this.ka=f;this.sa=0;this.ga=this.g=this.f=null;this.oa=!1;this.v=this.Z=null;this.L=!1;this.da=0;this.ea=!1;this.C=null;this.U=this.$=this.h=!1;this.G=new G;this.F=this.O=this.B=!1;this.J=0;this.ba=15;this.Aa=this.qa=this.P=!1;this.V=h;this.ra=!1;this.m=null;this.Ba=!1;this.na=this.K=this.M=null;this.j=n||null;this.H=p||null;this.l=v||null;this.R=null;this.Y=!1;this.xa={};this.za=
k;this.i=null;this.ha=!1;this.ya=0;this.ta=e?e.split(";")[0]:"";this.I=!1;this.la=l;this.A=this.o=null}r(U,E);U.prototype.wa=function(){return{SourceBufferManager:this.c}};U.prototype.getDebug=U.prototype.wa;function Wd(a,b){return new VideoPlayerBitrateEstimator(new u(a.a.getNumber("live_bitrate_estimates_half_life",2)),b,a.a.getNumber("live_bitrate_estimates_minimum_sample_count",1),a.a.getNumber("live_bitrate_estimates_large_sample_weight_factor",10))}
U.prototype.ia=function(a){null!=a.initialStreamBufferSize&&(this.J=Number(a.initialStreamBufferSize));var b=this.a.getNumber("initial_stream_buffer_size_for_video_stream",0);0<b&&-1!==this.ta.indexOf("v")&&(this.J=b);null!=a.dynamicStreamBufferSize&&(this.da=Number(a.dynamicStreamBufferSize));null!=a.smartBufferAdjustmentParams&&(this.xa=a.smartBufferAdjustmentParams);null!=a.smartBufferAdjustmentEnabled&&(this.Y=Boolean(a.smartBufferAdjustmentEnabled));null!=a.streamBufferSize&&(this.ba=Number(a.streamBufferSize));
null!=a.fixBufferingGoalDetermination&&(this.P=Boolean(a.fixBufferingGoalDetermination));null!=a.addCdnDebugQueryParameters&&(this.qa=Boolean(a.addCdnDebugQueryParameters));null!=a.useInitialBufferSizeWhenPaused&&(this.Aa=Boolean(a.useInitialBufferSizeWhenPaused));null!=a.segmentRequestTimeout&&(this.c.O=Number(a.segmentRequestTimeout));null!=a.resolveVideoTimeUpdateOnFragmentedTimeRanges&&(this.ra=Boolean(a.resolveVideoTimeUpdateOnFragmentedTimeRanges));null!=a.performanceLogger&&(this.m=this.s.performanceLogger=
a.performanceLogger);null!=a.abrLogger&&(this.s.abrLogger=a.abrLogger);null!=a.reappendInitSegmentAfterAbort&&(this.s.reappendInitSegmentAfterAbort=Boolean(a.reappendInitSegmentAfterAbort));null!=a.liveDataFetchMaxRetries&&(this.s.liveDataFetchMaxRetries=Number(a.liveDataFetchMaxRetries));null!=a.liveSourceBufferClearMaxRetries&&(this.s.liveSourceBufferClearMaxRetries=Number(a.liveSourceBufferClearMaxRetries));null!=a.skipEmptySegments&&(this.s.skipEmptySegments=Boolean(a.skipEmptySegments));null!=
a.playheadFragmentedGapDiffAllowance&&(this.s.playheadFragmentedGapDiffAllowance=Number(a.playheadFragmentedGapDiffAllowance));null!=a.useMicroTaskTimeouts&&(this.Ba=Boolean(a.useMicroTaskTimeouts));a=this.c;b=this.s;null!=b.reappendInitSegmentAfterAbort&&(a.L=Boolean(b.reappendInitSegmentAfterAbort));null!=b.performanceLogger&&(a.m=b.performanceLogger);null!=b.abrLogger&&(a.G=b.abrLogger);null!=b.liveDataFetchMaxRetries&&(a.J=b.liveDataFetchMaxRetries);null!=b.liveSourceBufferClearMaxRetries&&(a.I=
b.liveSourceBufferClearMaxRetries);null!=b.playheadFragmentedGapDiffAllowance&&(a.K=b.playheadFragmentedGapDiffAllowance);null!=b.skipEmptySegments&&(a.R=b.skipEmptySegments)};U.prototype.destroy=function(){Xd(this);this.G.destroy();this.ka=this.f=this.G=null;this.c.destroy();this.b=this.c=null;this.a.getBool("fixing_scheduler_disable_leaks",!0)&&(this.j=null);this.Ca=null};m=U.prototype;m.Ma=function(){return this.f};m.vb=function(){return this.g};
m.Ac=function(a){this.B||a.then(function(){this.B=!0;this.v||V(this,0)}.bind(this)).catch(function(){});return this.G};m.pb=function(){this.F=!0;Yd(this)};m.Ua=function(){return this.F};
m.Za=function(a,b,c,d,e){if(a!=this.f){var f=1;this.a.getBool("use_live_bitrate_estimates",!1)&&null!==this.o&&0<this.f.bandwidth&&(f=this.o.getEstimate()/this.f.bandwidth);var h=a.W;h&&(this.ga=h.create(this.m,this.Va));this.U=!0;a.N.create().then(H(this,function(g){if(this.b){this.U=!1;var h=this.f;this.f=a;this.a.getBool("use_live_bitrate_estimates",!1)&&(this.o=Wd(this,(a.bandwidth||0)*f));var l=this.g;this.g=g;l&&l.b.rc();Cd(this.g,function(a){this.l&&this.l.setSegments(this.g.getSegments());
this.j&&(a=a&&this.a.getBool("optimize_stream_get_segments_calls",!1)?a:this.g.getSegments(),Zd(this,this.f.id||"",this.g,a))}.bind(this));this.l&&this.l.setSegments(this.g.getSegments());this.j&&Zd(this,a.id||"",g,g.getSegments());this.oa=!0;this.Z=d?d:null;this.L||(this.a.getBool("make_early_track_selection",!1)&&this.h&&!this.I&&!this.v?V(this,0):h?b?$d(this,!0,c):e&&$d(this,!1):V(this,0))}})).catch(H(this,function(a){this.U=!1;"aborted"!=a.type&&(this.B?(a=y(a),this.dispatchEvent(a)):this.G.reject(a))}))}};
m.pc=function(a){return $d(this,!!a)};m.xc=function(){this.ea=!0};m.zc=function(a){this.ya=a};function Zd(a,b,c,d){a.a.getBool("use_update_segments_by_shaka_reference",!0)?a.j.updateSegmentsByShakaReferences(b,d):(d=c.b.tc())&&!a.j.hasSegment(d)&&(d=0<a.j.getSegments(b).length?a.b.currentTime-10:null,a.j.updateSegments(b,c.b.vc(d)))}
function $d(a,b,c){a.f&&!a.L&&(a.L=!0,Xd(a),a.O=!1,null!==a.A&&a.A.reset(),ub(a.c).then(H(a,function(){var a=this.b.currentTime;this.a.getBool("set_current_time_in_resync",!1)&&0==a?(this.m&&BanzaiODS.bumpEntityKey("videos.www.shaka","set_current_time_in_resync"),a=this.g.b.S().startTime):this.a.getBool("better_set_current_time_in_resync",!1)&&a<this.g.b.S().startTime&&(BanzaiODS.bumpEntityKey("videos.www.shaka","set_current_time_in_resync"),a=this.g.b.S().startTime+this.a.getNumber("resync_set_current_time_fudge_factor",
0));if(!b&&0<wb(this.c,a)&&0<=Db(this.c.a,a))return Promise.resolve();if(c)return Hb(this.c,this.b.currentTime+c);this.ha=!0;return Gb(this.c)})).then(H(a,function(){this.L=!1;V(this,0)})).catch(H(a,function(a){this.L=!1;"aborted"!=a.type&&(this.B?(a=y(a),this.dispatchEvent(a)):this.G.reject(a))})))}m.yc=function(a){return 0<wb(this.c,a)&&0<=Db(this.c.a,a)};m.kb=function(){};m.qb=function(){return!0};
function ae(a){a.$=a.$||!a.b.paused;a.b.paused||a.Y||(a.R=Date.now(),a.Y=!0);var b=a.xa,c=null;if(b.inExperiment)if(b.useSmartBuffering){if(a.Y&&a.R){var c=(Date.now()-a.R)/1E3,d=null;1>c?c=null:(d=3>c?b.bufferSize_00_to_03:10>c?b.bufferSize_03_to_10:30>c?b.bufferSize_10_to_30:60>c?b.bufferSize_30_to_60:b.bufferSize_above_60,c=Math.min(d,a.b.duration))}}else a.R&&(c=b.nonSmartBufferSize);c||(c=a.Aa&&a.b.paused?a.J:a.ba,a.da&&!a.b.paused&&(c=Math.max(Math.min(a.g.w().endTime-a.b.currentTime,a.da),
a.ba)));c=(a.P?a.h&&a.$:a.h)?Math.max(a.J,c):a.J;0<a.a.getNumber("audio_video_buffer_diff_threshold",14400)&&(b=a.b.buffered.length?a.b.buffered.end(a.b.buffered.length-1):0,b=Math.max(0,b-a.b.currentTime),c=Math.min(c,b+a.a.getNumber("audio_video_buffer_diff_threshold",14400)));return c}
function be(a){var b=a.a.getNumber("start_stream_buffer_size",1),c=a.a.getNumber("low_start_stream_buffer_size",1);if(b!==c){var d=a.a.getNumber("low_bandwidth_start_stream_buffer_size_threshold",0),e=a.a.getNumber("scheduled_videos_start_stream_buffer_size_threshold",0);if(0<d&&a.ka.getBandwidth()<d&&VideoStreamingTaskQueueProvider.getQueueSize("video")>=e)return c}return b}function he(a,b){return wb(a.c,a.h?b:b+(a.C||0))}
function ie(a){if(a.h&&!a.B||a.a.getBool("make_early_track_selection",!1)&&a.U||a.a.getBool("prevent_fetch_while_fetching_in_stream",!1)&&a.I)return a.v=null,Promise.resolve();var b;if(b=a.B&&!a.F)b=1<a.c.b.buffered.length?!0:!1;if(b&&(a.ea||null!==a.K&&a.b.currentTime>=a.K||Lb(a.c,a.b)))return a.ra&&(a.K&&(a.K=null),a.b.currentTime=Kb(a.b)),a.ea=!1,$d(a,!0),Promise.resolve();a.a.getNumber("decouple_stream_on_update_loop_from_request_loop_int",0)||(a.v=null);b=a.f;var c=a.g,d=a.b.currentTime;a.a.getBool("pending_seek_while_playing",
!1)&&a.M&&(d=a.M);a.a.getBool("use_pending_seek_position_for_reference",!1)&&0===a.b.readyState&&!d&&a.na&&(d=a.na);if(a.P&&!a.h&&he(a,d)>=be(a))return a.a.getBool("fix_chrome_mse_regression",!1)&&1===a.b.readyState&&0<a.b.buffered.length&&(a.b.currentTime=a.b.currentTime),je(a),V(a,0),Promise.resolve();var e=null,f=[];if(he(a,d)>=ae(a))if(a.O=!0,a.P||je(a),f=ke(a)?le(a,d):[],0<f.length)e=f[0];else return V(a,1E3/(5*(Math.abs(a.b.playbackRate)||1))),Promise.resolve();else{e=1;a.l&&(e=a.l.getNumberOfSegments());
var h=a.a.getBool("pending_seek_while_playing",!1)&&a.M?null:vb(a.c);me(a,null);h=ne(a,d,c,e,h);e=h[0];a.l&&(a.l.setFutureSegments(h),a.l.setBufferingGoal(ae(a)-he(a,d)));!e&&ke(a)&&(f=le(a,d),0<f.length&&(e=f[0]))}if(!e)return je(a),a.B&&!a.F&&(a.F=!0,Yd(a)),V(a,200),Promise.resolve();oe(a,pe(a,d,f),b.id||"");qe(a,pe(a,d,f));a.a.getBool("refresh_segment_reference_failover_uri",!0)&&(e.url=e.url.clone());a.I=!0;"video"===b.mimeType.split("/")[0]&&a.ka.setRepresentationID(b.id);c=a.c.fetch(e,c.a,b.a+
a.ya,a.ga,a.qa&&!a.b.paused,0<f.length,a.j,a.H);c=c.then(H(a,function(a){this.a.getBool("updates_priority_on_fetch_complete",!1)&&qe(this,pe(this,d,[]));this.la.informNetworkResumed();return a}));a.V&&"video"===b.mimeType.split("/")[0]&&a.V.add(e.startTime||0,e.endTime||0,{id:b.id,reason:a.Z,performanceLogger:a.m?a.m.getOperationLogger("stream_switch"):null});a.ga=null;a.oa&&(a.oa=!1,f=a.Z,a.Z=null,re(a,b,f,a.fa()));a.F=!1;return c.then(H(a,function(a){return this.a.getBool("clear_old_buffer",!1)?
Jb(this.c,this.b.currentTime).then(function(){return a}):a})).then(H(a,function(a){var b=a.X,c=a.Sc;this.h||(this.sa=c);this.a.getBool("use_live_bitrate_estimates",!1)&&null!=a&&0<a.qc&&0<a.D&&(null===this.o&&(this.o=Wd(this,this.f.bandwidth||0)),this.o.sample(8*a.qc,a.D));a=this.a.getNumber("buffer_velocity_time_in_past_to_consider",0);0<a&&null!==this.f&&"video"===Od(this.f)&&(null===this.A&&(this.A=new BufferVelocity(a)),this.A.recordBufferAhead(wb(this.c,this.b.currentTime)));this.I=!1;"video"===
(this.f?this.f.mimeType.split("/")[0]:null)&&this.dispatchEvent(x({type:"fetch_end",bubbles:!0}));null==this.C&&(this.C=b);this.ha&&0<wb(this.c,d)&&(this.ha=!1,this.a.getBool("disable_nudge",!1)||(b=x({type:"should_nudge"}),this.dispatchEvent(b)));V(this,0)})).catch(H(a,function(a){this.I=!1;return Promise.reject(a)}))}function pe(a,b,c){var d=a.h?b:b+(a.C||0);return{additionalSegmentsRequired:c,playhead:b,bufferStart:d,bufferEnd:he(a,b)+d,bufferingGoal:ae(a),isPlaying:!a.b.paused}}
function oe(a,b,c){a.j&&a.j.updatePlayerState(c,b)}function qe(a,b){a.H&&a.H.updatePlayerState(b)}function se(a,b,c){var d=null!==a.i&&-1<a.i&&a.i<c.length()-1?c.get(a.i):null,e=null;if(null===a.i||!d||d.startTime>b)return e=c.findIndex(b),a.i=e;for(d=a.i;d<=a.i+1;d++)if(e=c.get(d),e.startTime<=b&&e.endTime>b)return a.i=d;e=c.findIndex(b);return(a.i=e)||-1}function ke(a){return a.a.getBool("replace_lower_quality_buffer",!1)&&null===a.H&&a.$&&null!==a.V&&"video"===Od(a.f)&&null!==a.g}
function le(a,b){if(!a.za||!a.f.id||!a.g)return[];var c=se(a,b,a.g);return-1===c?[]:BufferReplacementHelper.getSegmentsToReplaceLowerQuality(a.g.getSegments(),b,c,a.f.id,a.za,a.V,{thresholdBefore:a.a.getNumber("buffer_replacement_behind_threshold",5),thresholdAfter:a.a.getNumber("buffer_replacement_ahead_threshold",15),wrapReplacementPastEnd:a.a.getBool("wrap_replacement_past_end",!1)})}
m.mc=function(){var a;this.a.getNumber("decouple_stream_on_update_loop_from_request_loop_int",0)&&V(this,this.a.getNumber("decouple_stream_on_update_loop_from_request_loop_int",0));this.a.getBool("catch_stream_update_sync_code_error",!1)?a=new Promise(function(a,c){try{ie(this).then(a).catch(c)}catch(d){d.type="uncaught",c(d)}}.bind(this)):a=ie(this);a.catch(H(this,function(a){if("aborted"!=a.type){if("sourcebuffer_full"===a.type)return Gb(this.c).then(H(this,function(){V(this,0)}));var c=-1===[0,
404,410,502,503,504].indexOf(a.status);if("net"===a.type&&!c&&this.f)if(this.a.getBool("allow_infinite_retry_on_net_err",!0))switch(a.status){case 404:V(this,2E3);break;case 410:this.a.getBool("end_all_streams_on_410",!1)?te(this):this.pb();break;default:V(this,1E3)}else V(this,1E3),c=!0;0===a.status?this.la.informNetworkInterrupted():this.la.informNetworkResumed();if(!this.a.getBool("allow_infinite_retry_on_net_err",!0)||c)c=y(a),this.dispatchEvent(c),this.m&&setTimeout(function(){var c=this.m.getEventLogger("stream_error_fallback").setError(a).setType(this.ta.split("/")[0]);
this.b?c.setResult("failed"):c.setResult("success");c.log()}.bind(this),0)}}))};function me(a,b){a.M=b;null!==a.M&&(a.K=a.b.currentTime+a.a.getNumber("pending_seek_while_playing_delay",2E3)/1E3)}function ne(a,b,c,d,e){var f=-1;null!=e?f=null!=e.endTime?c.findIndex(e.endTime):-1:(f=se(a,b,c),0>f&&(f=c.length()?c.length()-1:-1));a=[];if(0<=f)for(b=f;b<f+d&&b<c.length();b++)a.push(c.get(b));return a}
function je(a){if(!a.h&&null!=a.C){a.h=!0;var b=a.c,c=a.C,d=c-b.P;0!=d&&(b.a=sd(b.a,d),b.P=c);a.G.resolve(a.C)}}m.wd=function(){return this.h};U.prototype.hasStarted=U.prototype.wd;U.prototype.Xa=function(){return this.O};U.prototype.hasHitBufferingGoal=U.prototype.Xa;U.prototype.fa=function(){return null===this.o?null:this.o.getEstimate()};U.prototype.getBitrateEstimate=U.prototype.fa;U.prototype.gb=function(){return null===this.A?null:this.A.getVelocity()};U.prototype.getBufferVelocity=U.prototype.gb;
function re(a,b,c,d){var e=b.mimeType.split("/")[0];b=x({type:"adaptation",id:b.id,bubbles:!0,contentType:e,size:"video"!=e?null:{width:b.width,height:b.height},bandwidth:d||b.bandwidth,reason:c});a.dispatchEvent(b)}function te(a){var b=x({type:"should_end_all_streams"});a.dispatchEvent(b)}function Yd(a){var b=x({type:"ended"});a.dispatchEvent(b)}U.prototype.Ga=function(){return this.H};U.prototype.getVideoStreamingManager=U.prototype.Ga;
function V(a,b){Xd(a);!b&&a.Ba?Promise.resolve().then(a.mc.bind(a)):a.v=setTimeout(a.mc.bind(a),b)}function Xd(a){null!=a.v&&(clearTimeout(a.v),a.v=null)}U.prototype.ib=function(){return this.sa};U.prototype.Wa=function(){return this.c.h};U.prototype.getStreamProgressTracker=U.prototype.Wa;function ue(a){this.c=a;this.a=null}ue.prototype.destroy=function(){this.a&&(this.a.destroy(),this.a=null)};ue.prototype.create=function(){if(this.a)return Promise.resolve(this.a);var a=new nd(0,null,this.c,0);this.a=new R(new T([a],1));return Promise.resolve(this.a)};ue.prototype.b=function(){return this.a};function ve(a,b){E.call(this,a);this.b=b;this.i=!0;this.j=this.g=null;this.f=new G;this.a=null}r(ve,E);ve.prototype.ia=function(){};ve.prototype.destroy=function(){this.a&&this.b.removeChild(this.a);this.f.destroy();this.Ca=this.b=this.g=this.j=this.a=this.f=null};m=ve.prototype;m.Ma=function(){return this.g};m.vb=function(){return this.j};m.Ac=function(){return this.f};m.Ua=function(){return!0};m.pb=function(){};
m.Za=function(a){a.N.create().then(H(this,function(b){if(this.b){if(0==b.length())return Promise.reject(Error("No subtitles URL available."));var c=this.g;this.g=a;this.j=b;b=b.b.S().url.c[0].toString();var d=this.qb();this.a&&(this.kb(!1),this.b.removeChild(this.a));this.a=document.createElement("track");this.b.appendChild(this.a);this.a.src=b;this.kb(d);b=x({type:"adaptation",bubbles:!0,contentType:"text",size:null,bandwidth:a.bandwidth});this.dispatchEvent(b);c||this.f.resolve(0)}}))};m.pc=function(){};
m.xc=function(){};m.yc=function(){return!0};m.kb=function(a){this.i=a;this.a&&(this.a.track.mode=a?"showing":"disabled")};m.qb=function(){this.a&&(this.i="showing"==this.a.track.mode);return this.i};m.ib=function(){return 0};m.zc=function(){};function we(){}
we.prototype.parse=function(a,b,c,d){var e=null;try{var f;var h=new Ma(b);if(440786851!=Oa(h).id)f=null;else{var g=Oa(h);if(408125543!=g.id)f=null;else{var k=g.a.byteOffset,l;var n=new Ma(g.a);for(b=null;Ha(n.a);){var p=Oa(n);if(357149030==p.id){b=p;break}}if(b){for(var v=new Ma(b.a),p=1E6,n=null;Ha(v.a);){var w=Oa(v);if(2807729==w.id)p=Sa(w);else if(17545==w.id)if(b=w,4==b.a.byteLength)n=b.a.getFloat32(0);else if(8==b.a.byteLength)n=b.a.getFloat64(0);else throw new RangeError("EbmlElement: floating point numbers must be 4 or 8 bytes.");}null==
n?l=null:(v=p/1E9,l={zb:v,duration:n*v})}else l=null;f=l?{sd:k,zb:l.zb,duration:l.duration}:null}}if(f){var C=Oa(new Ma(a));if(475249515!=C.id)e=null;else{var Q=f.sd,ba=f.zb,ca=f.duration;a=[];var ta=new Ma(C.a);for(f=C=-1;Ha(ta.a);){var Xa=Oa(ta);if(187==Xa.id){var ka;var od=new Ma(Xa.a),pd=Oa(od);if(179!=pd.id)ka=null;else{var Ue=Sa(pd),qd=Oa(od);if(183!=qd.id)ka=null;else{for(var ce=new Ma(qd.a),k=0;Ha(ce.a);){var de=Oa(ce);if(241==de.id){k=Sa(de);break}}ka={Bb:Ue,rd:k}}}if(ka){var ee=ba*ka.Bb,
fe=Q+ka.rd;if(0<=C){var Ec=new I(d,c,f,fe-1);a.push(new nd(C,ee,Ec,ka.Bb))}C=ee;f=fe}}}0<=C&&(Ec=new I(d,c,f,null),a.push(new nd(C,ca,Ec,ka.Bb)));e=a}}else e=null}catch(ge){if(!(ge instanceof RangeError))throw ge;}return e};function xe(a,b,c,d,e,f,h,g,k,l,n){this.h=a;this.o=b;this.c=c;this.l=l||null;this.j=n||null;this.a=d;this.g=e;this.f=f;this.v=h;this.Ha=null;this.i=g;this.m=k||null;this.s=null}xe.prototype.destroy=function(){this.i=this.o=this.h=null;this.a.Da();this.a=null;this.f&&(this.f.Da(),this.f=null);this.g&&(this.g.Da(),this.g=null);this.Ha=null};xe.prototype.Mc=function(){return this.Ha};xe.prototype.create=function(){return ye(this)};xe.prototype.fb=function(){return ye(this)};
function ye(a){if(a.Ha)return a.Ha;var b=null;a.m&&(b=a.m.getOperationLogger("create_container_segment_index_source").start());if(null!==a.l&&(null!==a.j||"webm"!==a.c))return ze(a,a.l,a.j,b);var c=[a.a.fetch(null,null,a.m,b)];"webm"==a.c&&c.push(a.g.fetch(null,null,a.m,b));a.Ha=Promise.all(c).then(H(a,function(a){return ze(this,a[0],a[1]||null,b)}));return a.Ha}
function ze(a,b,c,d){var e=null;"mp4"==a.c?(e=new Bd,e=e.parse(new DataView(b),a.a.startByte,a.a.c,a.i,a.f)):"webm"==a.c&&(e=new we,e=e.parse(new DataView(b),new DataView(c),a.a.c,a.i));if(!e)return a=Error("Failed to parse SegmentReferences from "+a.a.toString()+" (or one of its fallbacks)."),a.type="stream",Promise.reject(a);b=new T(e,e.a);var f;"dynamic"==a.h.type?f=new S(b,a.h,a.o,a.v):f=new R(b);d&&d.log();a.s=f;return Promise.resolve(f)}xe.prototype.b=function(){return this.s};function Ae(a,b){this.a=a;this.m=b||null}
function Be(a,b,c){for(var d=(Date.now()+Ea)/1E3,e=0;e<b.a.length;++e)for(var f=b.a[e],h=0;h<f.a.length;++h){var g=f.a[h];if("text"!=g.contentType)for(var k=0;k<g.a.length;++k){var l=g.a[k],n=0,n=n+(l.f?1:0),n=n+(l.b?1:0),n=n+(l.a?1:0);0==n?(g.a.splice(k,1),--k):1!=n&&(l.f?(l.b=null,l.a=null):l.b&&(l.a=null))}}Ce(b);for(e=0;e<b.a.length;++e)for(f=b.a[e],h=0;h<f.a.length;++h){k=g=f.a[h];l=null;for(n=0;n<k.a.length;++n){var p=k.a[n].mimeType||"";l?p!=l&&(k.a.splice(n,1),--n):l=p}0==g.a.length&&(f.a.splice(h,
1),--h)}b.manifestIsLiveStreaming&&null==b.c&&(b.c=d);e=new Vd;"dynamic"==b.type&&(e.b=!0,e.c=b.g,e.h=new I(c,b.j||b.url),e.i=b.c);e.f=b.h||5;for(f=0;f<b.a.length;++f){h=b.a[f];if(null==h.start)break;h=De(a,b,h,d,c);e.a.push(h)}e.o=b.FBIsLiveTemplated;a.m&&a.m.setIsTemplatedManifest(b.FBIsLiveTemplated);e.s=b.FBWasLive;a=null;c="none";for(f=0;f<b.a.length;f++)for(h=b.a[f],d=0;d<h.a.length;d++)for(g=h.a[d],k=0;k<g.a.length;k++)l=g.a[k].i,null!=l&&null!=l.value&&(a=c=l.value,"urn:mpeg:dash:23003:3:audio_channel_configuration:2011"===
l.a&&("1"===a?c="mono":"2"===a&&(c="stereo")));e.l=c;a=parseInt(a,10);e.j=0<a?a:null;return e}
function Ce(a){if(a.a.length){null==a.a[0].start&&(a.a[0].start=0);var b=function(a){return 0==a||!!a};a.manifestIsLiveStreaming&&(a.b=null);b(a.b)&&1==a.a.length&&!b(a.a[0].duration)&&(a.a[0].duration=a.b);for(var c=0,d=!0,e=0;e<a.a.length;++e){var f=a.a[e-1],h=a.a[e],g=a.a[e+1]||{start:a.b};!b(h.start)&&f&&b(f.start)&&b(f.duration)&&(h.start=f.start+f.duration);!b(h.duration)&&b(g.start)&&(h.duration=g.start-h.start);null!=h.start&&null!=h.duration?c+=h.duration:d=!1}b(a.b)||(e=a.a[a.a.length-1],
d?a.b=c:b(e.start)&&b(e.duration)?a.b=e.start+e.duration:a.manifestIsLiveStreaming||(a.b=c))}}
function De(a,b,c,d,e){var f=new Ud;f.id=c.id;f.start=c.start;f.duration=c.duration;var h=new B;c.a.forEach(function(a){h.push(a.contentType||"",a)});for(var g=fb(h),k=0;k<g.length;++k){var l=new B;h.get(g[k]).forEach(function(a){l.push(a.group,a)});for(var n=fb(l),p=0;p<n.length;++p){var v=new B;l.get(n[p]).forEach(function(a){v.push(a.lang,a)});for(var w=fb(v),C=0;C<w.length;++C){var Q=v.get(w[C]),Q=Ee(a,b,c,Q,d,e);f.a.push(Q)}}}return f}
function Ee(a,b,c,d,e,f){da(d.every(function(a){return a.group==d[0].group&&(a.lang||"")==(d[0].lang||"")&&(a.contentType||"")==(d[0].contentType||"")}));var h=new Qd,g=d.filter(function(a){return null!=a.id});g.length==d.length&&(h.id=g.map(function(a){return a.id}).sort().reduce(function(a,b){return a+","+b}));h.b=!(!d[0].b||"urn:scte:dash:cc:cea-608:2015"!==d[0].b.a);h.lang=d[0].lang||"";h.contentType=d[0].contentType||"";h.f=d.some(function(a){return a.f});for(var g={},k=0;k<d.length;++k){var l=
d[k];l.c&&(h.c=l.c);for(var n=0;n<l.a.length;++n){var p=l.a[n],v=Fe(a,p),w=h.a.slice(0);Ge(v,w);0==w.length&&0<h.a.length||!(p=He(a,b,c,p,e,f))||(h.u.push(p),h.a=w,g[p.T]=l)}}if(h.a.some(function(a){return""==a.a}))return h.u.forEach(function(a){a.ma=!0}),h;a=Ie(d);for(k=0;k<h.u.length;++k)p=h.u[k],l=g[p.T],l==a&&(p.ma=!0);return h}
function Ie(a){for(var b=null,c=null,d=0;d<a.length;++d)for(var e=a[d],f=0;f<e.a.length;++f){var h=e.a[f],h=(h.width||1)*(h.height||1)*(h.bandwidth||1);if(null==b||h<b)b=h,c=e}return c}function Ge(a,b){if(0==b.length)Array.prototype.push.apply(b,a);else for(var c=0;c<b.length;++c){for(var d=!1,e=0;e<a.length;++e){var f=b[c],h=a[e];if(f.a==h.a&&f.h==h.h&&f.l==h.l&&f.g==h.g&&f.i==h.i&&f.f==h.f&&f.j==h.j&&Qa(f.c,h.c)){d=!0;Sb(b[c],a[e].b);break}}d||(b.splice(c,1),--c)}}
function Fe(a,b){var c=[];if(0==b.c.length)c.push(new Qb);else if(a.a)for(var d=0;d<b.c.length;++d)c.push.apply(c,Je(a,b.c[d]));return c}
function Je(a,b){var c=[];if(2!=a.a.length)return[];var d=a.a(b.f||"",b.c);if(!(d&&d instanceof Array))return[];for(var e=0;e<d.length;++e){var f;var h=d[e];f=new Qb;if(h){var g=cb(h,"keySystem");if(null!=g)f.a=g;else throw Error("'keySystem' cannot be null.");var k=cb(h,"licenseServerUrl");if(null!=k)f.h=k;else if(g)throw Error("For encrypted streaming content, 'licenseServerUrl' cannot be null or empty.");g=z(h,"withCredentials");null!=g&&(f.l=g);g=db(h,"licensePostProcessor",Function);null!=g&&
(f.o=g);g=db(h,"licensePreProcessor",Function);null!=g&&(f.s=g);g=z(h,"distinctiveIdentifierRequired");null!=g&&(f.g=g);g=z(h,"persistentStateRequired");null!=g&&(f.i=g);g=cb(h,"audioRobustness");null!=g&&(f.f=g);g=cb(h,"videoRobustness");null!=g&&(f.j=g);g=db(h,"serverCertificate",Uint8Array);null!=g&&(f.c=g);if(g=db(h,"initData",Object)){h=db(g,"initData",Uint8Array);if(null==h)throw Error("'initData.initData' cannot be null.");g=cb(g,"initDataType");if(null==g)throw Error("'initData.initDataType' cannot be null.");
f.b.push({initData:new Uint8Array(h.buffer),initDataType:g})}}0==f.b.length&&b.a&&b.a.psshBox&&Sb(f,[{initData:b.a.psshBox,initDataType:"cenc"}]);c.push(f)}return c}
function He(a,b,c,d,e,f){if(!d.baseUrl||0===d.baseUrl.length)return null;var h=null,g=1,k=0;if(d.f){h=d.mimeType.split("/")[1];if("mp4"!=h&&"webm"!=h)h=null;else{var l=d.f;if("webm"!=h||l.f)if(l.b||l.c&&l.c.a){g=l.c;g||(g=new zc,g.url=d.baseUrl,g.a=l.b?l.b.clone():null);k=Ke(g,f);g=l.f?Ke(l.f,f):null;l.g?(l=l.g,l=new I(f,d.baseUrl,l.Ka,l.end)):l=null;var n=l,p=VideoPlayerShakaGlobalConfig.getBool("add_inline_initialization_resources",!1)&&d.h&&d.h.data?d.h.data:null,l=VideoPlayerShakaGlobalConfig.getBool("add_inline_initialization_resources",
!1)&&d.g&&d.g.data?d.g.data:null;b=new xe(b,c,h,k,g,n,e,f,a.m,p,l);c=new ld(g,l);e=new Md;e.N=b;e.W=c;h=e}else h=null;else h=null}g=d.f.a;k=d.f.h}else if(d.b)a=d.b,!a.D&&!a.b&&1<a.c.length?h=null:a.D||c.duration||a.b||1!=a.c.length?a.b&&0===a.b.a.length?h=null:(a=a.g?Ke(a.g,f):null,b=new Kd(b,c,d,e,f),c=new ld(a),e=new Md,e.N=b,e.W=c,h=e):h=null,g=d.b.a,k=d.b.f;else if(d.a){a:if(h=d.a,g=0+(h.c?1:0),g+=h.b?1:0,g+=h.D?1:0,0==g?g=!1:(1!=g&&(h.c?(h.b=null,h.D=null):h.b&&(h.D=null)),g=!0),g){g=null;if(h.g&&
(g=(h=d.a.g)?Le(d,h,Ac):null,!g)){h=null;break a}h=g?Ke(g,f):null;g=d.a;g.c?(g=d.mimeType.split("/")[1],"mp4"!=g&&"webm"!=g?b=null:"webm"!=g||h?ud(f,d,1,0)?(k=(k=d.a.c)?Le(d,k,zc):null)?(k=Ke(k,f),b=new xe(b,c,g,k,h,null,e,f,a.m)):b=null:b=null:b=null):b=g.h?g.b?new Ld(b,c,d,e,f):g.D?b.manifestIsLiveStreaming||null!=c.duration?new Jd(b,c,d,e,f):null:null:null;b?(c=new ld(h),e=new Md,e.N=b,e.W=c,h=e):h=null}else h=null;g=d.a.a;k=d.a.f}else"text"==d.mimeType.split("/")[0]&&(h=new Md,h.N=new ue(new I(f,
d.baseUrl)));if(!h)return null;h.id=d.id;k&&(h.a=-1*k/g);h.bandwidth=d.bandwidth;h.width=d.width;h.height=d.height;h.mimeType=d.mimeType||"";h.codecs=d.codecs||"";h.g=d.o||null;h.h=d.s||null;h.fbQualityLabel=d.fbQualityLabel||null;h.fbQualityClass=d.fbQualityClass||null;h.f=d.l||null;h.frameRate=d.frameRate||"";h.c=d.j||null;for(b=0;b<d.c.length;++b)c=d.c[b],c.b&&h.b.push(c.b);return h}function Le(a,b,c){b=vd(b,a.id,null,a.bandwidth,null);if(!b)return null;c=new c;c.url=dd(a.baseUrl,b);return c}
function Ke(a,b){var c=a.url,d=0,e=null;a.a&&(d=a.a.Ka,e=a.a.end);return new I(b,c,d,e)};function Me(a,b,c,d,e,f){this.b=new I(null,[new J(a)]);this.a=new yb;this.a.body=b;this.a.method=c;this.a.b=3;this.a.s=d;this.a.f=1E3*(null!=f?f:na);a=e||{};for(var h in a)this.a.c[h]=a[h]}function Ne(a){return a.b.fetch(a.a).then(function(a){return Promise.resolve(new Uint8Array(a))})};function Oe(a,b,c){E.call(this,a);this.c=b;this.j=c;this.a=this.h=null;this.i=new gb;this.b=[];this.f=[];this.o=0;this.g=new G;this.l=null;this.A=na}r(Oe,E);Oe.prototype.destroy=function(){this.Ca=null;for(var a=0;a<this.f.length;++a)this.f[a].close().catch(function(){});this.f=[];this.b=this.a=this.h=null;this.g.destroy();this.g=null;this.i.destroy();this.i=null;this.l&&(clearTimeout(this.l),this.l=null);this.c=this.j=null};
Oe.prototype.initialize=function(){for(var a=new B,b=Pe(this.j),c=0;c<b.length;++c){var d=b[c];d.a.a||d.b&&!Qe(d.b)||a.push(d.contentType,d)}for(var c={},d=!1,e=0;e<b.length;++e){var f=b[e];if(f.a.a&&!a.a.hasOwnProperty(f.contentType)){var h=f.a.a,g=c[h];g||(g=f.a,g={audioCapabilities:void 0,videoCapabilities:void 0,initDataTypes:void 0,distinctiveIdentifier:g.g?"required":"optional",persistentState:g.i?"required":"optional",sessionTypes:["temporary"]},c[h]=g);if(f.b&&(h=f.contentType+"Capabilities",
h in g)){d=!0;g[h]||(g[h]=[]);var k;"audio"==f.contentType?k=f.a.f:"video"==f.contentType&&(k=f.a.j);g[h].push({contentType:f.b,robustness:k})}}}if(!d)if(b.length)this.a=b[0].a;else throw a=Error("No DrmInfo exists!"),a.type="drm",a;if(0==Object.keys(c).length)return Re(this.j,a),this.g.resolve(),Promise.resolve();k=new G;c=Se(c,k);c=c.then(this.v.bind(this,b,a));k.reject(null);return c};
function Se(a,b){for(var c in a)b=b.catch(function(a,b){return navigator.requestMediaKeySystemAccess(a,[b])}.bind(null,c,a[c]));return b}
Oe.prototype.v=function(a,b,c){if(!this.c)return Te();for(var d=c.keySystem,e=c.getConfiguration(),f=["audio","video"],h=0;h<f.length;++h){var g=f[h];if(!b.a.hasOwnProperty(g)){var k=e[g+"Capabilities"];if(k){for(var k=k[0],l=[],n={},p=0;p<a.length;++p){var v=a[p],w=k?v.b==k.contentType:v.contentType==g;v.a.a!=d||!w||v.id in n||(l.push(v),n[v.id]=!0,this.a=this.a?Rb(this.a,v.a):v.a)}b.set(g,l)}}}Re(this.j,b);return c.createMediaKeys().then(function(a){this.h=a}.bind(this))};
function Ve(a){return a.c?a.h?a.c.setMediaKeys(a.h).then(H(a,function(){return this.c?this.a.c?this.h.setServerCertificate(this.a.c):Promise.resolve():Te()})).then(H(a,function(){if(!this.c)return Te();for(var a=0;a<this.a.b.length;++a){var c=this.a.b[a];this.s({type:"encrypted",initDataType:c.initDataType,initData:c.initData})}0==this.a.b.length&&D(this.i,this.c,"encrypted",this.s.bind(this))})):Promise.resolve():Te()}
function Te(){var a=Error("EmeManager destroyed");a.type="destroy";return Promise.reject(a)}
Oe.prototype.s=function(a){for(var b=new Uint8Array(a.initData),c=0;c<this.b.length;++c)if(Qa(b,this.b[c].data))return;try{var d=We(this)}catch(e){b=y(e);this.dispatchEvent(b);this.g.reject(e);return}a=d.generateRequest(a.initDataType,a.initData);this.b.push({data:b,ub:d});a.catch(H(this,function(a){if(this.c){for(var b=0;b<this.b.length;++b)if(this.b[b].ub==d){this.b.splice(b,1);break}b=y(a);this.dispatchEvent(b);this.g.reject(a)}}));this.f.push(d)};
function We(a){var b=null,b=a.h.createSession();D(a.i,b,"message",a.C.bind(a));D(a.i,b,"keystatuseschange",a.B.bind(a));return b}Oe.prototype.C=function(a){Xe(this,a.target,this.a,a.message)};
Oe.prototype.B=function(a){a=a.target;var b={};a.keyStatuses.forEach(function(a,c){if("string"===typeof a){var f=a;a=c;c=f}if("com.microsoft.playready"==this.a.a&&16==a.byteLength){var f=new DataView(a),h=f.getUint32(0,!0),g=f.getUint16(4,!0),k=f.getUint16(6,!0);f.setUint32(0,h,!1);f.setUint16(4,g,!1);f.setUint16(6,k,!1)}f=Pb(new Uint8Array(a));b[f]=c}.bind(this));if(a.expiration<Date.now()){for(var c=0;c<this.b.length;++c)if(this.b[c].ub==a){this.b.splice(c,1);break}a.close();this.f.splice(this.f.indexOf(a),
1)}Ye(this.j,b)};function Xe(a,b,c,d){d=Ze(c,d);Ne(new Me(d.url,d.body,d.method,c.l,d.headers,a.A)).then(H(a,function(a){c.o&&(a=c.o(a));return b.update(a)})).then(H(a,function(){var a=x({type:"sessionReady",detail:b});this.dispatchEvent(a);this.o++;this.o>=this.f.length&&this.g.resolve()})).catch(H(a,function(a){a.ub=b;a=y(a);this.dispatchEvent(a)}))}
function Ze(a,b){var c={url:a.h,body:b.slice(0),method:"POST",headers:{}};if("com.microsoft.playready"===a.a){for(var d=String.fromCharCode.apply(null,new Uint16Array(c.body)),d=(new DOMParser).parseFromString(d,"application/xml"),e=d.getElementsByTagName("name"),f=d.getElementsByTagName("value"),h=0;h<e.length;h++)c.headers[e[h].childNodes[0].nodeValue]=f[h].childNodes[0].nodeValue;c.body=window.atob(d.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue)}if(!a.s)return c;a.s(c);c.url=cb(c,
"url");if(null==c.url)throw Error("'url' cannot be null.");if(!(c.body instanceof ArrayBuffer||"string"===typeof c.body||null==c.body))throw new TypeError("'body' must be an ArrayBuffer, a string, or null.");c.method=cb(c,"method");if("GET"!=c.method&&"POST"!=c.method)throw Error("'method' must be either 'GET' or 'POST'.");c.headers=db(c,"headers",Object);if(null==c.headers)throw Error("'headers' cannot be null.");return c};function W(a,b,c,d,e,f){E.call(this,null);this.b=a;this.f=b;this.a=null;this.g=new gb;this.l=this.i=null;this.F=0;this.I=this.O=this.Y=this.Z=null;this.K=this.h=!1;this.U=this.V=!0;this.J=!1;this.c={enableAdaptation:!0,streamBufferSize:15,liveStreamEndTimeout:15,licenseRequestTimeout:na,mpdRequestTimeout:oa,segmentRequestTimeout:pa,preferredLanguage:"en",restrictions:new qa};this.m=c;this.G=d;this.$=e;this.da=f;this.o=null;this.j=1;this.P=null;this.s=this.A=this.v=!1;this.M=this.B=null}r(W,E);
q("shaka.player.Player",W);W.version="v1.6.4-fb";W.isBrowserSupported=function(){return!!window.MediaSource&&!!window.Uint8Array};
W.prototype.wa=function(){var a={},b=this.a;if(b){var c=b.Mb();a.BandwidthEstimator=c.BandwidthEstimator;var d=c.VideoSourceStream;d&&(a.VideoSourceStream=d,(d=a.VideoBufferManager=d.wa().SourceBufferManager)&&(a.VideoSourceBuffer=d.wa().SourceBuffer));(d=a.AudioSourceStream=c.AudioSourceStream)&&(d=a.AudioBufferManager=d.wa().SourceBufferManager)&&(a.AudioSourceBuffer=d.wa().SourceBuffer);a.TextSourceStream=c.TextSourceStream;a.getManifest=b.Hb.bind(b)}else a.getManifest=function(){};a.Ad=!0;return a};
W.prototype.getDebug=W.prototype.wa;W.prototype.la=function(a){this.V=a};W.prototype.setResumeAfterBuffering=W.prototype.la;function Qe(a){return"text/vtt"==a?!!window.VTTCue:MediaSource.isTypeSupported(a)}W.isTypeSupported=Qe;W.setTextStyle=function(a){var b=document.getElementById("ShakaPlayerTextStyle");b||(b=document.createElement("style"),b.id="ShakaPlayerTextStyle",document.head.appendChild(b));for(b=b.sheet;b.cssRules.length;)b.deleteRule(0);b.insertRule("::cue { "+xa(a)+" }",0)};
W.prototype.destroy=function(){return this.R().then(H(this,function(){this.g.destroy();this.b=this.g=null;this.M&&this.M.remove()})).catch(function(){})};W.prototype.destroy=W.prototype.destroy;W.prototype.R=function(){this.J=!0;return $e(this)};W.prototype.unload=W.prototype.R;
function $e(a){var b;a.m&&(b=a.m.getOperationLogger("unload").start());if(!a.a)return b&&b.log(),Promise.resolve();a.h&&af(a,"unloading");a.b.pause();hb(a.g);bf(a);cf(a);a.i&&(a.i.destroy(),a.i=null);a.a&&(a.a.destroy(),a.a=null);a.b.src="";var c=Promise.resolve().then(function(){b&&b.log()});a.h=!1;a.K=!1;a.A=!1;a.s=!1;return c}function df(a,b){for(var c=0;c<a.length;c++)b.push(a[c].contentType,a[c])}W.prototype.ya=function(a){return ef(this,a)};W.prototype.load=W.prototype.ya;
function ef(a,b){var c;a.m&&(c=a.m.getOperationLogger("load").setState("loading").start(),b.m=b.g.performanceLogger=a.m);a.G&&(b.Eb=b.g.abrLogger=a.G);a.$&&(b.H=a.$);a.da&&b.U.push(a.da);ff(b,a.b);var d=null;a.J=!1;a.a&&(d=$e(a).then(H(a,function(){return b.mb()})));a.b.autoplay&&(ga("load"),D(a.g,a.b,"timeupdate",a.ad.bind(a)));b.Zb(a.c);b.ha=a.P;a.P=null;d||(d=b.mb());a.f.getBool("fix_shaka_player_load_race_condition",!1)&&(a.a=b);d.catch(H(a,function(a){b.destroy();return Promise.reject(a)}));
return d.then(H(a,function(){if(gf(this,b))return hf();this.a=b;D(this.g,this.a,"seekrangechanged",this.ia.bind(this));D(this.g,this.a,"allStreamsStarted",this.xd.bind(this));var a=new B;df(Pe(this.a),a);Re(this.a,a);a=this.ba();c&&0<a.length&&(a=a.reduce(function(a,b){if(null===a||b.bandwidth<a.bandwidth)a=b;return a},null),c.setLowestQualityRepresentationID(a.streamInfoID));if(!this.c.enableContentProtection)return Promise.resolve();var d;this.m&&(d=this.m.getOperationLogger("eme_init"));this.i=
new Oe(this,this.b,this.a);return this.i.initialize().then(function(){d&&d.log()})})).then(H(a,function(){if(gf(this,b))return hf();jf(this);D(this.g,this.b,"playing",this.fd.bind(this));D(this.g,this.b,"pause",this.ga.bind(this));D(this.g,this.b,"waiting",this.od.bind(this));D(this.g,this.b,"play",this.ha.bind(this));return kf(this.a,this,this.b)})).then(H(a,function(){if(gf(this,b))return hf();if(this.c.enableContentProtection){var a;this.m&&(a=this.m.getOperationLogger("eme_attach"));return Ve(this.i).then(function(){a&&
a.log()})}return Promise.resolve()})).then(H(a,function(){if(gf(this,b))return hf();lf(this);c&&c.updateState("ready").log()})).catch(H(a,function(a){c&&c.setError(JSON.stringify(a)).log();if(gf(this,b))return hf();if("destroy"!=a.type){var d=y(a);this.dispatchEvent(d)}return this.R().then(function(){return Promise.reject(a)})}))}function gf(a,b){return!a.b||a.J||a.f.getBool("fix_shaka_player_load_race_condition",!1)&&b!==a.a}m=W.prototype;
m.xd=function(){this.K=!0;this.h?this.C():this.b.playbackRate=this.j};function hf(){var a=Error("Player destroyed");a.type="destroy";return Promise.reject(a)}function jf(a){var b=a.b.parentNode;b&&a.f.getBool("prevent_playing_on_insufficient_buffer",!1)&&(a.M=eventListenerCapture(b,"playing",function(a){a.target===this.b&&this.C(a)}.bind(a)))}m.ad=function(){ja("load");this.g.ab(this.b,"timeupdate")};
m.od=function(a){mf(this);this.f.getBool("unify_stream_start_with_buffer_detector",!1)&&!this.h&&this.C(a)};m.fd=function(){ga("playing");this.m&&this.m.getEventLogger("playing").setState("playing").log();!this.l&&0>this.j&&(this.b.playbackRate=0,this.L(this.b.currentTime,Date.now(),this.j));this.h&&!this.U&&af(this,"playing")};m.td=function(a){this.s=a};W.prototype.setPendingPlayRequest=W.prototype.td;W.prototype.ha=function(){this.s=!0};
W.prototype.ga=function(){this.m&&this.m.getEventLogger("pause").setState("paused").log();ja("playing");cf(this)};W.prototype.ia=function(a){this.F=a.start;this.Z=a.last;this.Y=a.end;this.O=a.seekRangeGaps;this.f.getBool("no_skip_gaps_on_seek_range_changed",!1)||mf(this)};W.prototype.ba=function(){return this.a?this.a.Z():[]};W.prototype.getVideoTracks=W.prototype.ba;W.prototype.ra=function(){return this.a?this.a.ra():[]};W.prototype.getAudioTracks=W.prototype.ra;
W.prototype.ta=function(){return this.a?this.a.$b():[]};W.prototype.getTextTracks=W.prototype.ta;W.prototype.selectVideoTrack=function(a,b){return this.a?this.a.selectVideoTrack(a,void 0==b?!0:b):!1};W.prototype.selectVideoTrack=W.prototype.selectVideoTrack;W.prototype.za=function(a,b,c){return this.a?nf(this.a,"audio",a,void 0==b?!0:b,c):!1};W.prototype.selectAudioTrack=W.prototype.za;W.prototype.Aa=function(a){return this.a?nf(this.a,"text",a,!1):!1};W.prototype.selectTextTrack=W.prototype.Aa;
W.prototype.qa=function(a){this.a&&of(this.a,a)};W.prototype.enableTextTrack=W.prototype.qa;W.prototype.ka=function(a){cf(this);this.v&&this.h||!(0<=a)?this.b.paused||(this.b.playbackRate=0,this.L(this.b.currentTime,Date.now(),a)):this.b.playbackRate=a;this.j=a};W.prototype.setPlaybackRate=W.prototype.ka;W.prototype.ea=function(){return this.j};W.prototype.getPlaybackRate=W.prototype.ea;W.prototype.Ga=function(a){this.P=a};W.prototype.setPlaybackStartTime=W.prototype.Ga;
W.prototype.H=function(){return this.a?!!this.a.M():!1};W.prototype.isLive=W.prototype.H;
W.prototype.oa=function(a){if(a){var b=z(a,"enableAdaptation");null!=b&&(this.c.enableAdaptation=b);b=z(a,"endBufferingOnPlaying");null!=b&&(this.U=b);b=z(a,"usePlaybackRateForBuffering");null!=b&&(this.v=b);b=A(a,"streamBufferSize",0);null!=b&&(this.c.streamBufferSize=b);b=A(a,"dynamicStreamBufferSize",0);null!=b&&(this.c.dynamicStreamBufferSize=b);null!=a.smartBufferAdjustmentParams&&(this.c.smartBufferAdjustmentParams=a.smartBufferAdjustmentParams);b=z(a,"addCdnDebugQueryParameters");null!=b&&
(this.c.addCdnDebugQueryParameters=b);b=A(a,"initialStreamBufferSize",0);null!=b&&(this.c.initialStreamBufferSize=b);b=z(a,"includeStreamBufferSizeInStartOffset");null!=b&&(this.c.includeStreamBufferSizeInStartOffset=b);b=A(a,"jumpToLiveThreshold");null!=b&&(this.c.jumpToLiveThreshold=b);b=A(a,"liveStreamEndTimeout",0);null!=b&&(this.c.liveStreamEndTimeout=b);b=A(a,"licenseRequestTimeout",0);null!=b&&(this.c.licenseRequestTimeout=b);b=A(a,"mpdRequestTimeout",0);null!=b&&(this.c.mpdRequestTimeout=
b);b=A(a,"minMpdRefreshInterval",0);null!=b&&(this.c.minMpdRefreshInterval=b);b=z(a,"enableLiveInterruptionDetection");null!=b&&(this.c.enableLiveInterruptionDetection=b);b=z(a,"enableManifestDebug");null!=b&&(this.c.enableManifestDebug=b,E.prototype.fc=b,b||(E.prototype.Ea=function(){}));b=z(a,"resolveVideoTimeUpdateOnFragmentedTimeRanges");null!=b&&(this.c.resolveVideoTimeUpdateOnFragmentedTimeRanges=b);b=A(a,"liveInterruptionConsecutiveUpdatesWithoutChange");null!=b&&(this.c.liveInterruptionConsecutiveUpdatesWithoutChange=
b);b=A(a,"liveInterruptionConsecutiveUpdatesWithChange");null!=b&&(this.c.liveInterruptionConsecutiveUpdatesWithChange=b);b=z(a,"reappendInitSegmentAfterAbort");null!=b&&(this.c.reappendInitSegmentAfterAbort=b);b=z(a,"liveSendPushHeaders");null!=b&&(this.c.liveSendPushHeaders=b);b=A(a,"liveMaxManifestFetchesWithPush");null!=b&&(this.c.liveMaxManifestFetchesWithPush=b);b=A(a,"liveMaxSegmentsToPush");null!=b&&(this.c.liveMaxSegmentsToPush=b);b=A(a,"segmentRequestTimeout",0);null!=b&&(this.c.segmentRequestTimeout=
b);b=cb(a,"preferredLanguage");null!=b&&(this.c.preferredLanguage=b);b=db(a,"restrictions",qa);null!=b&&(this.c.restrictions=b.clone());b=a.liveInitialPushRepresentation;null!=b&&(this.c.liveInitialPushRepresentation=b);b=a.liveAudioPushRepresentation;null!=b&&(this.c.liveAudioPushRepresentation=b);b=a.useInlineInitSegment;null!=b&&(this.c.useInlineInitSegment=b);b=z(a,"disableCacheBustingEvenThoughItMayAffectBandwidthEstimation");null!=b&&(Wc=!b);b=z(a,"currentTimeDuringReadyStateZeroThrows");null!=
b&&(this.c.currentTimeDuringReadyStateZeroThrows=b);b=A(a,"liveDataFetchMaxRetries");null!=b&&(this.c.liveDataFetchMaxRetries=b);b=A(a,"liveSourceBufferClearMaxRetries");null!=b&&(this.c.liveSourceBufferClearMaxRetries=b);b=z(a,"useLongCacheForManifest");null!=b&&(this.c.useLongCacheForManifest=b);b=z(a,"jumpToEarliestPositionInCurrentBlock");null!=b&&(this.c.jumpToEarliestPositionInCurrentBlock=b);b=z(a,"ignoreMinBufferTime");null!=b&&(this.c.ignoreMinBufferTime=b);b=A(a,"playheadFragmentedGapDiffAllowance");
null!=b&&(this.c.playheadFragmentedGapDiffAllowance=b);b=z(a,"fixBufferingGoalDetermination");null!=b&&(this.c.fixBufferingGoalDetermination=b);b=z(a,"skipEmptySegments");null!=b&&(this.c.skipEmptySegments=b);(b=z(a,"useMicroTaskTimeouts"))&&(this.c.useMicroTaskTimeouts=b);(b=z(a,"enableRequestPipelining"))&&(this.c.enableRequestPipelining=b);(b=z(a,"enableStreaming"))&&(this.c.enableStreaming=b);(a=z(a,"enableContentProtection"))&&(this.c.enableContentProtection=a);this.a&&this.a.Zb(this.c)}};
W.prototype.configure=W.prototype.oa;W.prototype.Ba=function(a){this.a&&this.a.dc(a)};W.prototype.setEnableLiveheadCatchup=W.prototype.Ba;W.prototype.xa=function(){return this.a?this.a.ka:!1};W.prototype.isLiveheadCatchupEnabled=W.prototype.xa;
function mf(a){if(a.f.getBool("skip_manifest_gap_based_on_stream_limits",!1)&&(!a.H()||!a.f.getBool("no_skip_manifest_gaps_if_live",!1))){var b;a.f.getBool("skip_manifest_gaps_use_cached_stream_limits",!1)?a.a&&null!==a.O?b={start:a.F,end:a.Y,w:a.Z,Pa:a.O}:b=a.a?a.a.cb():null:b=a.a?a.a.cb():null;if(b)for(var c=a.f.getNumber("skip_manifest_gap_boundary_precision_ms",1E3)/1E3,d=b.Pa,e=a.b.playbackRate,f=a.b.currentTime,h=0;h<d.length;++h){var g=d[h].startTime-c,k=d[h].endTime+c;f<=k&&f>=g&&(a.f.getBool("fix_seek_range_gap_boundary",
!1)||(g=d[h].startTime,k=d[h].endTime),0<=e?b.end>k&&(a.b.currentTime=k):b.start<g&&(a.b.currentTime=g))}}}W.prototype.fa=function(){var a=this.a&&this.a.cb();return(a=a&&{start:a.start,end:a.end,last:a.w,seekRangeGaps:a.Pa})||null};W.prototype.getVideoSourceStreamLimits=W.prototype.fa;W.prototype.sa=function(){return this.c};W.prototype.getConfiguration=W.prototype.sa;function cf(a){a.l&&(clearTimeout(a.l),a.l=null)}function lf(a){bf(a);a.I=setTimeout(a.C.bind(a),100)}
function bf(a){a.I&&(clearTimeout(a.I),a.I=null)}W.prototype.L=function(a,b,c){this.l=null;var d=(Date.now()-b)/1E3*c;this.b.currentTime<this.F+(this.H()?1:.05)?this.b.pause():(d=Math.max(this.F,a+d),this.b.currentTime=d,this.l=setTimeout(this.L.bind(this,a,b,c),250))};function pf(a){return a.f.getBool("unify_stream_start_with_buffer_detector",!1)&&!a.K}
function af(a,b){if(!pf(a)){ja("buffering");null!==a.B&&(a.B=null);a.o&&(a.o.setConcluder(b).log(),a.o=null);if(a.G){var c=Date.now();a.G.setEvent("buffering").setClientTimeBegin(Math.round(c-la())).setClientTimeEnd(Math.round(c)).log()}a.v&&(a.b.playbackRate=a.j);a.h=!1;a.dispatchEvent(x({type:"bufferingEnd"}));a.A&&(a.A=!1,dispatchDomEvent(a.b,"playing"));a.s=!1}}
function qf(a){var b=a.b.buffered;if(1===b.length)b=b.end(0);else if(0===b.length)b=0;else{for(var c=0,d=0;d<b.length;++d)b.end(d)>=a.b.currentTime&&(c=b.start(d)<=a.b.currentTime?c+(b.end(d)-a.b.currentTime):c+(b.end(d)-b.start(d)));return c}return Math.max(b-a.b.currentTime,0)}
W.prototype.C=function(a){if(!this.f.getBool("prevent_playing_on_insufficient_buffer",!1)||!this.J){lf(this);var b=a?a.type:"",c="waiting"===b;if(!this.b.ended&&!this.b.seeking||c){var d=this.b.buffered,e=d.length?d.end(d.length-1):0,f;this.f.getBool("fix_unstall_buffer_calculation",!1)?f=qf(this):f=Math.max(e-this.b.currentTime,0);var h=this.b.currentTime,d=this.H()?this.f.getNumber("live_buffering_underflow_threshold",.5):this.f.getNumber("buffering_underflow_threshold",0),g=this.b.duration,g=isNaN(g)?
0:Math.max(g-.05,0),e=e>=g||h>=g,b=b||"watchdog_timer";if(this.h){rf(this,a);a=sf(this.a);var k=0<a?f/a:0;f>a||tf(this.a)||this.f.getBool("fix_buffering_at_the_end_of_playback",!0)&&e?(af(this,b),this.V&&!this.v&&this.b.play()):this.B!==k&&(this.B=k,this.dispatchEvent(x({type:"bufferingProgress",progress:k})))}else this.b.paused&&!c||!(!e&&f<d||pf(this))||(this.h=!0,this.v?this.b.playbackRate=0:this.b.pause(),this.m&&!this.o&&(f=this.b.buffered,f=f.length?f.end(f.length-1):0,this.f.getBool("fix_unstall_buffer_calculation",
!1)?k=qf(this):k=Math.max(f-this.b.currentTime,0),f=1E3*(sf(this.a)-k),this.o=this.m.getOperationLogger("buffering").setLength(Math.round(f)).setType(this.s?"start/unpause":"in_play").setInitiator(b).start()),ga("buffering"),this.dispatchEvent(x({type:"bufferingStart"})),this.f.getBool("no_skip_gaps_on_buffering",!1)||mf(this),rf(this,a)),tf(this.a)&&af(this,b)}else this.f.getBool("fix_ff_in_play_stall_upon_seek",!1)&&rf(this,a)}};function rf(a,b){b&&"playing"===b.type&&(a.A=!0,eventKill(b))}
W.prototype.na=function(a){if(this.a){var b=this.a;b.c.video&&b.c.video.zc(a)}};W.prototype.setVideoStreamOffset=W.prototype.na;function uf(a){for(var b=0;b<a.length;++b)for(var c=a[b],d=0;d<c.a.length;++d){for(var e=c.a[d],f=e,h=!1,g=0;g<f.u.length;++g){var k=f.u[g];Qe(Pd(k))?'video/webm; codecs="av1"'===Pd(k)&&(h=!0):(f.u.splice(g,1),--g)}if(h)for(g=0;g<f.u.length;++g)k=f.u[g],'video/webm; codecs="av1"'!==Pd(k)&&(f.u.splice(g,1),--g);0==e.u.length&&(c.a.splice(d,1),--d)}for(b=0;b<a.length;++b)for(c=a[b],d=0;d<c.a.length;++d)c.a[d].u.sort(vf)}
function vf(a,b){var c=a.bandwidth||Number.MAX_VALUE,d=b.bandwidth||Number.MAX_VALUE;return c<d?-1:c>d?1:0};function wf(a){this.a=a}wf.prototype.destroy=function(){this.a.destroy();this.a=null};wf.prototype.update=function(a){var b=xf(a),c=xf(this.a);return Promise.all([b,c]).then(H(this,function(b){var c=b[0];b=b[1];uf(this.a.a);a.b&&!this.a.b&&(a.g=!0);a.c=this.a.c;a.h=this.a.h?this.a.h.clone():null;a.f=this.a.f;var f=[];yf(a,this.a,c,b,f);uf(a.a);return Promise.resolve(f)}))};
function xf(a){function b(a,b){return a.concat(b)}var c=a.a.map(function(a){return a.a}).reduce(b,[]).map(function(a){return a.u}).reduce(b,[]);a=c.map(function(a){return a.N.create()});return Promise.all(a).then(function(a){for(var b={},f=0;f<c.length;++f)b[c[f].T]=a[f];return Promise.resolve(b)})}
function yf(a,b,c,d,e){var f=new B;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var h=new B;b.a.forEach(function(a,b){h.push(a.id||""+b,a)});a=fb(f);for(b=0;b<a.length;++b){var g=a[b],k=f.get(g);1<k.length||(g=h.get(g))&&0!=g.length&&1==g.length&&(zf(k[0],g[0],c,d,e),k[0].duration=g[0].duration)}}
function zf(a,b,c,d,e){var f=new B;a.a.forEach(function(a,b){f.push(a.id||""+b,a)});var h=new B;b.a.forEach(function(a,b){h.push(a.id||""+b,a)});a=fb(f);for(b=0;b<a.length;++b){var g=a[b],k=f.get(g);1<k.length||(g=h.get(g))&&0!=g.length&&1==g.length&&Af(k[0],g[0],c,d,e)}}
function Af(a,b,c,d,e){var f=new B;a.u.forEach(function(a,b){f.push(a.id||""+b,a)});var h=new B;b.u.forEach(function(a,b){h.push(a.id||""+b,a)});b={};for(var g=fb(f),k=0;k<g.length;++k){var l=g[k];b[l]=l;var n=f.get(l);1<n.length||((l=h.get(l))&&0!=l.length?1==l.length&&(Bf(n[0],l[0],c,d),n[0].W=l[0].W,l[0].W=null,n[0].a=l[0].a,VideoPlayerShakaGlobalConfig.getBool("refresh_bandwidth_from_live_manifest",!1)&&(n[0].bandwidth=l[0].bandwidth)):(e.push(n[0]),a.u.splice(a.u.indexOf(n[0]),1)))}g=fb(h);for(k=
0;k<g.length;++k)l=g[k],b[l]||(b[l]=l,l=h.get(l),a.u.push(l[0]))}function Bf(a,b,c,d){a=c[a.T];d=d[b.T];b=a.length();a.xb(d)&&(d=a.length(),a.h.push(b!==d),50<a.h.length&&a.h.shift())};function X(){this.a=this.b=null;this.f=new gb;this.c=Number.POSITIVE_INFINITY;this.i=!0;this.g=!1}q("shaka.media.SimpleAbrManager",X);X.prototype.destroy=function(){this.f.destroy();this.a=this.b=this.f=null};X.prototype.initialize=function(a,b){this.b||this.a||(this.b=a,this.a=b)};
X.prototype.start=function(){this.b&&this.a&&!this.g&&(this.c=Date.now()+4E3,D(this.f,this.b.getEstimator(),"bandwidth",this.l.bind(this)),D(this.f,this.a,"adaptation",this.j.bind(this)),D(this.f,this.a,"trackschanged",this.h.bind(this)),this.g=!0)};X.prototype.enable=function(a){this.i=a};X.prototype.getInitialVideoTrackId=function(){if(!this.b||!this.a)return null;var a=Cf(this);return a?a.id:null};X.prototype.getInitialSwitchReason=function(){return null};X.prototype.getInitialAudioTrackId=function(){return null};
X.prototype.selectVideoTrack=function(a,b,c){this.g&&this.a.selectVideoTrack(a.id,b,c)};X.prototype.l=function(){Date.now()<this.c||this.h()};X.prototype.h=function(){if(this.i){var a=Cf(this);if(a){if(a.active){this.c=Date.now()+3E3;return}this.selectVideoTrack(a,!1)}this.c=Number.POSITIVE_INFINITY}};X.prototype.j=function(){this.c==Number.POSITIVE_INFINITY&&(this.c=Date.now()+3E4)};
function Cf(a){var b=a.a.Z();if(0==b.length)return null;b.sort(Ba);var c;a:{c=a.a.ra();for(var d=0;d<c.length;++d)if(c[d].active){c=c[d];break a}c=null}c=c?c.bandwidth:0;a=a.b.getBandwidth();for(var d=b[0],e=0;e<b.length;++e){var f=b[e],h=e+1<b.length?b[e+1]:{bandwidth:Number.POSITIVE_INFINITY};if(f.bandwidth&&(h=(h.bandwidth+c)/.85,a>=(f.bandwidth+c)/.95&&a<=h&&(d=f,d.active)))break}return d};function Y(a,b,c,d){E.call(this,null);this.b=a;this.a=b;this.sa=c;this.sb=new VideoPlayerLocalBandwidthEstimator(this,c,b);this.h=new gb;this.i=new MediaSource;this.ba=this.video=null;this.Fb=0;this.bc=this.Ob=!1;this.Ab=oa;this.Eb=this.V=this.m=null;this.yb=3;this.na=this.Pb=this.Aa=this.za=!1;this.L=null;this.Wa=0;this.aa=new VideoPushTracker;this.ea=null;this.Wb=1;this.Ub=Infinity;this.Ib=this.Gb=!1;this.la=this.Va=null;this.Kb=this.Jb=this.Ba=this.Qb=this.ia=!1;this.f=new B;this.A=d;this.A.initialize(this.sb,
this);this.K=!1;this.P="en";this.ta=!1;this.I=new G;this.tb=new G;this.l=new qa;this.C=null;this.Yb=1;this.c={};this.oa=new G;this.fa=0;this.Xa=15E3;this.j=null;this.Sb=!1;this.Rb=0;this.xa=!1;this.B={};this.ha=this.ga=this.s=null;this.g={};this.$=!1;this.Tb=0;this.J=this.a.getNumber("buffering_overflow_threshold",0);this.cc=null;this.o={};this.v={};this.O=null;this.U=[];this.R=this.H=null;this.G=new NetworkStatusDetector;this.Vb=!1;this.ka=!0;this.da=!1;this.ec=new SubscriptionsHandler;this.Nb=!1;
this.a.getBool("allow_infinite_retry_on_net_err",!0)&&this.ec.addSubscriptions(this.G.addListener("networkInterrupted",this.Jc,this),this.G.addListener("networkResumed",this.Kc,this),this.G.addListener("systemWake",this.Lc,this))}r(Y,E);q("shaka.player.StreamVideoSource",Y);Y.prototype.Mb=function(){return{VideoSourceStream:this.c.video,AudioSourceStream:this.c.audio,TextSourceStream:this.c.text,BandwidthEstimator:this.sa}};Y.prototype.getStreamDebug=Y.prototype.Mb;
Y.prototype.Gc=function(){return this.b?this.b.l:"none"};Y.prototype.getMpdAudioConfig=Y.prototype.Gc;
Y.prototype.Zb=function(a){null!=a.streamBufferSize&&(this.g.streamBufferSize=a.streamBufferSize);null!=a.initialStreamBufferSize&&(this.g.initialStreamBufferSize=a.initialStreamBufferSize);null!=a.dynamicStreamBufferSize&&(this.g.dynamicStreamBufferSize=a.dynamicStreamBufferSize);null!=a.smartBufferAdjustmentParams&&(this.g.smartBufferAdjustmentParams=a.smartBufferAdjustmentParams);null!=a.addCdnDebugQueryParameters&&(this.g.addCdnDebugQueryParameters=a.addCdnDebugQueryParameters);null!=a.segmentRequestTimeout&&
(this.g.segmentRequestTimeout=a.segmentRequestTimeout);null!=a.resolveVideoTimeUpdateOnFragmentedTimeRanges&&(this.g.resolveVideoTimeUpdateOnFragmentedTimeRanges=a.resolveVideoTimeUpdateOnFragmentedTimeRanges);null!=a.reappendInitSegmentAfterAbort&&(this.g.reappendInitSegmentAfterAbort=a.reappendInitSegmentAfterAbort);null!=a.liveDataFetchMaxRetries&&(this.g.liveDataFetchMaxRetries=a.liveDataFetchMaxRetries);null!=a.liveSourceBufferClearMaxRetries&&(this.g.liveSourceBufferClearMaxRetries=a.liveSourceBufferClearMaxRetries);
null!=a.playheadFragmentedGapDiffAllowance&&(this.g.playheadFragmentedGapDiffAllowance=a.playheadFragmentedGapDiffAllowance);null!=a.fixBufferingGoalDetermination&&(this.g.fixBufferingGoalDetermination=a.fixBufferingGoalDetermination);null!=a.skipEmptySegments&&(this.g.skipEmptySegments=a.skipEmptySegments);null!=a.useMicroTaskTimeouts&&(this.g.useMicroTaskTimeouts=a.useMicroTaskTimeouts);Df(this);null!=a.includeStreamBufferSizeInStartOffset&&(this.Ob=Boolean(a.includeStreamBufferSizeInStartOffset));
null!=a.liveAudioPushRepresentation&&(this.la=String(a.liveAudioPushRepresentation));null!=a.liveInitialPushRepresentation&&(this.Va=String(a.liveInitialPushRepresentation));null!=a.enableAdaptation&&this.A.enable(Boolean(a.enableAdaptation));null!=a.mpdRequestTimeout&&(this.Ab=Number(a.mpdRequestTimeout));null!=a.minMpdRefreshInterval&&(this.yb=Number(a.minMpdRefreshInterval)/1E3);null!=a.enableManifestDebug&&(this.Ib=!!a.enableManifestDebug);null!=a.liveStreamEndTimeout&&(this.Xa=Number(a.liveStreamEndTimeout));
null!=a.preferredLanguage&&(this.P=Wa(String(a.preferredLanguage)));null!=a.liveSendPushHeaders&&(this.na=Boolean(a.liveSendPushHeaders));null!=a.liveMaxManifestFetchesWithPush&&(this.Wa=Number(a.liveMaxManifestFetchesWithPush));null!=a.currentTimeDuringReadyStateZeroThrows&&(this.Gb=Boolean(a.currentTimeDuringReadyStateZeroThrows));null!=a.liveMaxSegmentsToPush&&(this.Ub=Number(a.liveMaxSegmentsToPush));null!=a.jumpToLiveThreshold&&(this.Rb=Number(a.jumpToLiveThreshold));null!=a.restrictions&&(this.l=
a.restrictions,this.K&&Ef(this));null!=a.useLongCacheForManifest&&(this.ia=Boolean(a.useLongCacheForManifest));null!=a.jumpToEarliestPositionInCurrentBlock&&(this.Qb=Boolean(a.jumpToEarliestPositionInCurrentBlock));null!=a.ignoreMinBufferTime&&(this.Ba=Boolean(a.ignoreMinBufferTime));null!==a.enableRequestPipelining&&(this.Jb=Boolean(a.enableRequestPipelining));null!==a.enableStreaming&&(this.Kb=Boolean(a.enableStreaming))};
Y.prototype.destroy=function(){this.I.destroy();this.oa.destroy();this.oa=this.I=null;this.ga&&(clearTimeout(this.ga),this.ga=null);this.s&&(clearTimeout(this.s),this.s=null);this.B=null;this.h.destroy();this.h=null;ab(this.c).forEach(function(a){a.destroy()});this.f=this.c=null;this.b&&(this.b.destroy(),this.b=null);this.A.destroy();this.Ca=this.l=this.video=this.i=this.sa=this.A=null;this.a.getBool("fixing_scheduler_disable_leaks",!0)&&(Object.keys(this.o).forEach(function(a){(a=this.o[a])&&a.disable()}.bind(this)),
this.o={});Object.keys(this.v).forEach(function(a){(a=this.v[a])&&a.destroy()}.bind(this));this.v={};this.H&&(this.H.disable(),this.H=null);this.O&&(this.O.cleanup(),this.O=null);for(var a=0;a<this.U.length;a++)this.U[a].cleanup();this.U=[];this.ec.release()};function ff(a,b){if(a.m){var c=a.m.getOperationLogger("media_source_open").start();a.tb.then(function(){c.log()})}D(a.h,a.i,"sourceopen",a.dd.bind(a));b.src=window.URL.createObjectURL(a.i)}m=Y.prototype;m.jc=function(){};
function kf(a,b,c){var d;a.m&&(d=a.m.getOperationLogger("source_attach").start());if(!a.K)return a=Error("Cannot call attach() right now."),a.type="app",d&&d.setError(a).log(),Promise.reject(a);a.Ca=b;a.video=c;a.ba=null;a.a.getBool("enable_viewport_priority_adjustment",!1)&&(a.O=new ViewportPriorityAdjuster(a.video),a.O.setOnPriorityChanged(function(a){Object.keys(this.o).forEach(function(b){this.o[b].updatePriorityWithNewAdjustment(a)}.bind(this))}.bind(a)));a.a.getBool("enable_first_video_priority_adjustment",
!1)&&a.U.push(new FirstLoadedVideoPriorityAdjuster(a.video));D(a.h,a.video,"loadedmetadata",a.cd.bind(a));D(a.h,a.sa,"bandwidth",a.yd.bind(a));if(a.b.b||a.a.getBool("back_off_buffering_overflow",!1))D(a.h,b,"bufferingStart",a.Zc.bind(a)),D(a.h,b,"bufferingEnd",a.Yc.bind(a));b=a.a.getBool("enable_content_protection",!1)?(b=a.video.mediaKeys)&&a.video.setMediaKeys?a.video.setMediaKeys(b):Promise.resolve():Promise.resolve();Ff(a).then(H(a,function(){d&&this.M()&&d.setLiveheadPosition(Gf(Hf(this)));this.I&&
this.I.resolve();this.jc()})).catch(H(a,function(a){this.I&&this.I.reject(a)}));return Promise.all([a.I,b]).then(function(){d&&d.log()})}
m.mb=function(){if(this.K){var a=Error("Cannot call load() right now.");a.type="app";return Promise.reject(a)}if(!this.b||0==this.b.a.length)return a=Error("The manifest does not specify any content."),a.type="stream",Promise.reject(a);uf(this.b.a);if(0==this.b.a.length||0==this.b.a[0].a.length||!this.b.a[0].a.some(function(a){return"video"===a.contentType}))return a=Error("The manifest specifies content that cannot be displayed on this browser/platform."),a.type="stream",Promise.reject(a);this.K=
!0;this.Ba||(this.g.initialStreamBufferSize=Math.max(this.g.initialStreamBufferSize||0,this.b.f));Df(this);Ef(this);return Promise.resolve()};function If(a){var b=x({type:"manifestwrapped",bubbles:!0});a.dispatchEvent(b)}function Jf(a,b){var c=x({type:"liveheadIdleAt",seconds:b,bubbles:!0});a.dispatchEvent(c)}function Gf(a){return Math.min.apply(Math,a.map(function(a){return a.length()?a.w().endTime:null}).filter(function(a){return!!a}))}
m.Cb=function(a,b){var c;this.a.getBool("decouple_mpd_update_loop_from_request_loop",!1)&&Kf(this,0);this.V&&(this.V.log(),this.V=null);this.m&&(c=this.m.getOperationLogger("update_manifest").start());if(!b||this.K){var d=Date.now();this.a.getBool("decouple_mpd_update_loop_from_request_loop",!1)||(this.s=null);var e=null,f,h;if(this.na&&(!this.Wa||this.Wa>this.Wb)){f=Math.floor(Lf(this))+1;f=Math.min(f,this.Ub);var g=this.c.video;if(g=g?g.vb():null)g=g.w(),null!=g.unscaledStartTime&&(h=g.unscaledStartTime);
if(this.video.paused||this.$)f=0}f&&this.Wb++;g=this.b.h;g=this.a.getBool("enable_clean_failover_uri_on_mpd_requests",!0)?g.clone():g;c&&!a&&c.setResource(g.toString());(a?this.kc():this.lc(g,f,h)).then(H(this,function(b){a||this.G.informNetworkResumed();e=new wf(b);var c;this.m&&(c=this.m.getOperationLogger("update_manifest_info").start());b=e.update(this.b);c&&c.log();return b})).then(H(this,function(a){e.destroy();e=null;var g=Hf(this);this.Ea("SegmentIndexesUpdated",g);if(this.a.getBool("emit_live_playhead_idle_from_client",
!0)){var f=this.a.getNumber("live_playhead_idle_all_stream_threshold",4),h=this.a.getNumber("live_playhead_idle_single_stream_threshold",5);if(Hf(this).every(function(a){return a.v()>=f})||Hf(this).some(function(a){return a.v()>=h})){var v=Gf(g);Jf(this,v)}}g.some(function(a){return a.hb()})&&If(this);v=Mf(this,g);c&&this.M()&&c.setLiveheadPosition(Gf(g));c&&c.setManifestType(this.b.b?"dynamic":"static").setUpdatePeriod(null===this.b.c?null:Math.ceil(1E3*this.b.c));this.ka&&Nf(this,v);this.a.getBool("skip_remaining_buffered_on_stream_end",
!1)&&v&&this.b.b&&this.b.g&&this.video.paused&&(this.video.currentTime=this.fa-.1);if(tf(this))return c&&c.log(),this.Ta();for(g=0;g<a.length;++g)Of(this,a[g]);this.Ba||(this.g.initialStreamBufferSize=Math.max(this.g.initialStreamBufferSize||0,this.b.f));this.g.useInitialBufferSizeWhenPaused=this.b.b;Df(this);Ef(this);0==Object.keys(this.c).length?Ff(this):(a=Date.now(),b||Kf(this,(a-d)/1E3));c&&c.log();this.jb()&&extractCEA608.prepare();this.a.getBool("update_cea608_availability_on_mpd_parsing",
!1)&&(a=this.jb(),this.Nb!==a&&(g=x({type:"cea608AvailabilityChanged",bubbles:!0}),this.dispatchEvent(g),this.Nb=a))})).catch(H(this,function(a){c&&c.setError(a).log();e&&(e.destroy(),e=null);if(!b){var d=[0,410];!this.a.getBool("no_retry_on_502_503",!1)&&this.b.o&&(d=d.concat([502,503]));d=this.a.getBool("fix_live_stream_gone_on_manifest_update",!0)?-1===d.indexOf(a.status):0!==a.status;if(this.a.getBool("allow_infinite_retry_on_net_err",!0)&&"net"===a.type&&!d)switch(a.status){case 410:this.Vb=
!0;this.j&&(clearTimeout(this.j),this.j=null);this.Ta();break;default:Pf(this)}0===a.status?this.G.informNetworkInterrupted():this.G.informNetworkResumed();if("delay"==a.type)return Pf(this);this.a.getBool("allow_infinite_retry_on_net_err",!0)&&!d||"aborted"==a.type||(a=y(a),this.dispatchEvent(a),this.b&&Pf(this))}}))}};m.lc=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};m.kc=function(){return Promise.reject("Cannot update manifest with this VideoSource implementation.")};
function Nf(a,b){b&&a.b&&a.b.b&&(a.a.getBool("seek_over_unavailable_segments_on_manifest_update",!1)&&a.da?b.end>a.video.currentTime+10&&(a.da=!1,a.video.currentTime=b.end):a.video.paused&&(a.a.getBool("pending_seek_while_playing",!1)?(a.L=b.end-a.a.getNumber("pending_seek_while_playing_offset_from_livehead",4E3)/1E3,a.L<a.video.currentTime&&(a.L=a.video.currentTime)):b.end>a.video.currentTime+10&&(a.a.getBool("use_on_demand_livehead_catchup",!1)?a.L=b.end:(a.da=!1,a.video.currentTime=b.end))))}
function Kf(a,b){if(null==a.b.c)BanzaiODS.bumpEntityKey("videos.www.live","update_period_is_null");else if(!a.Aa){if(a.a.getBool("decouple_mpd_update_loop_from_request_loop",!1)&&(a.s&&(clearTimeout(a.s),a.s=null),tf(a)))return;var c=Math.max(a.b.c,a.yb),c=Math.max(c-b,0),d=a.Cb.bind(a,!1);!c&&a.g.useMicroTaskTimeouts?Promise.resolve().then(d):(a.V&&a.V.setResult("failed").log(),a.m&&(a.V=a.m.getOperationLogger("schedule_manifest_update").start().setUpdatePeriod(Math.ceil(1E3*c))),a.s=setTimeout(d,
1E3*c))}}function Of(a,b){var c=Od(b),d=a.c[c];if(d&&d.Ma()==b){var e=a.f.get(Od(b)).map(function(a){return a.u}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return a.ma&&a.ca});if(0==e.length){c=Error("All usable streams have been removed from the manifest.");c.type="app";c=y(c);a.dispatchEvent(c);return}a.B[c].Bc==b&&delete a.B[c];d.Za(e[0],!0);b.destroy()}b.destroy()}m.ud=function(a){this.cc=a};Y.prototype.setTaggedTimeRanges=Y.prototype.ud;
Y.prototype.Tc=function(){return 0===Object.keys(this.c).length?!1:["audio","video"].every(H(this,function(a){return!this.c[a]||this.c[a].O}))};Y.prototype.hasHitBufferingGoal=Y.prototype.Tc;
Y.prototype.Z=function(a){if(!this.f||!this.f.a.hasOwnProperty("video"))return[];a=a&&a.useLocalBitrate||!1;var b=this.c.video,c=b?b.Ma():null,d=c?c.T:0,e=1,f=null;this.a.getBool("use_live_bitrate_estimates",!1)&&this.M()&&null!=b&&(f=b.fa(),null!=c&&0<c.bandwidth&&(e=f/c.bandwidth));for(var c=[],h=this.f.get("video"),g=0;g<h.length;++g)for(var k=h[g],l=0;l<k.u.length;++l){var n=k.u[l];if(n.ma&&n.ca){var p=null;if(a&&null!==n.N){var v=n.N.b(),w=b;if(this.M()||null===v||null===w)p=null;else{var p=
se(w,this.video.currentTime,v),C=v.getSegments();this.a.getBool("start_local_bitrate_at_buffer_end",!1)&&(w=LocalBitrateHelper.getBufferEndSegmentIndex(C,p,this.video.currentTime+he(w,this.video.currentTime)),null!==w&&(p=w));p=LocalBitrateHelper.getLocalBitrate(v.getSegments(),p,this.a.getNumber("local_bitrate_segments_ahead",10))}this.a.getBool("use_max_local_bitrate",!1)&&(p=Math.max(p,n.bandwidth))}v=n.T;p=p||n.bandwidth;this.a.getBool("use_live_bitrate_estimates",!1)&&null!=f&&(v===d?p=Math.max(p,
f):1<e&&(p=p*e),p=Math.round(p));n=new Aa(v,p,n.width,n.height,n.id,n.fbQualityLabel,n.fbQualityClass,n.f,n.frameRate,n.mimeType,n.codecs,n.g,n.h);v==d&&(n.active=!0);c.push(n)}}return c};Y.prototype.getVideoTracks=Y.prototype.Z;Y.prototype.Hc=function(){if(this.ea)return this.ea;if(!this.b)return null;for(var a=0;a<this.b.a.length;++a)for(var b=this.b.a[a],c=0;c<b.a.length;++c)if(this.ea=b.a[c].c)return this.ea;return null};Y.prototype.getVideoProjection=Y.prototype.Hc;Y.prototype.Fc=function(){return this.sb};
Y.prototype.getLocalEstimator=Y.prototype.Fc;function Qf(a){a=a.Z();for(var b=0;b<a.length;b++)if(a[b].active)return a[b]}Y.prototype.ra=function(){if(!this.f||!this.f.a.hasOwnProperty("audio"))return[];for(var a=this.c.audio,a=(a=a?a.Ma():null)?a.T:0,b=[],c=this.f.get("audio"),d=0;d<c.length;++d)for(var e=c[d],f=e.lang,h=0;h<e.u.length;++h){var g=e.u[h];if(g.ma&&g.ca){var k=g.T,g=new ma(k,g.bandwidth,f,g.id,g.mimeType,g.codecs,this.b.j,g.c);k==a&&(g.active=!0);b.push(g)}}return b};
Y.prototype.getAudioTracks=Y.prototype.ra;Y.prototype.$b=function(){if(!this.f||!this.f.a.hasOwnProperty("text"))return[];for(var a=this.c.text,b=a?a.Ma():null,b=b?b.T:0,c=[],d=this.f.get("text"),e=0;e<d.length;++e)for(var f=d[e],h=f.lang,g=0;g<f.u.length;++g){var k=f.u[g].T,l=new za(k,h);k==b&&(l.active=!0,l.enabled=a.qb());c.push(l)}return c};Y.prototype.getTextTracks=Y.prototype.$b;
function sf(a){var b=Number(a.g.initialStreamBufferSize);a.g.fixBufferingGoalDetermination&&(b=1);if(a.a.getBool("back_off_buffering_overflow",!1))b=a.J;else{var c=a.a.getNumber("buffering_overflow_threshold",0);0<c&&(b=c)}return a.Pb?Number(a.g.streamBufferSize):b}function Pe(a){if(a.K){a=a.b.a[0];for(var b=[],c=0;c<a.a.length;++c)b.push.apply(b,Sd(a.a[c]));a=b}else a=[];return a}
function Re(a,b){if(a.K){for(var c={},d=a.b.a[0],e=0;e<d.a.length;++e){var f=d.a[e];c[f.T]=f}a.f.a={};d=fb(b);for(e=0;e<d.length;++e){var f=d[e],h=b.get(f);if("video"==f){var g=h[0].id;a.f.push(f,c[g])}else if("audio"==f)for(var g=h[0].b.split(";")[0],k=0;k<h.length;++k){var l=h[k];l.b.split(";")[0]==g&&a.f.push(f,c[l.id])}else for(k=0;k<h.length;++k)g=h[k].id,a.f.push(f,c[g])}a.ta=!0;if(c=a.f.get("audio"))Rf(a,c),a.f.set("audio",c),c=c[0].lang||a.P,Va(2,a.P,c)&&(a.ta=!1);if(c=a.f.get("text"))Rf(a,
c),a.f.set("text",c),c=c[0].lang||a.P,Va(2,a.P,c)||(a.ta=!1)}}Y.prototype.Nc=function(){this.za=!0};Y.prototype.setClearBufferAfterSeeking=Y.prototype.Nc;Y.prototype.selectVideoTrack=function(a,b,c,d,e){return nf(this,"video",a,b,c,d,e)};Y.prototype.Vc=function(){var a=this.c.video?this.c.video.H:null;a&&a.stopUntilSegmentsUpdate()};Y.prototype.stopUntilVideoStreamSwitch=Y.prototype.Vc;function of(a,b){var c=a.c.text;c&&c.kb(b)}
function Ef(a){if(a.l){for(var b=!1,c=0;c<a.b.a.length;++c)for(var d=a.b.a[c],e=0;e<d.a.length;++e){var f=d.a[e];if("video"==f.contentType)for(var h=0;h<f.u.length;++h){var g=f.u[h],k=g.ca;g.ca=!0;a.l.maxWidth&&g.width>a.l.maxWidth&&(g.ca=!1);a.l.maxHeight&&g.height>a.l.maxHeight&&(g.ca=!1);a.l.minHeight&&g.height<a.l.minHeight&&(g.ca=!1);a.l.maxBandwidth&&g.bandwidth>a.l.maxBandwidth&&(g.ca=!1);a.l.minBandwidth&&g.bandwidth<a.l.minBandwidth&&(g.ca=!1);k!=g.ca&&(b=!0)}}0!=eb(a.f).length&&b&&(Sf(a),
0<a.Z().length||(b=Error("The application has restricted all video tracks!"),b.type="app",b=y(b),a.dispatchEvent(b)))}}Y.prototype.M=function(){return this.b?this.b.b:null};Y.prototype.isLive=Y.prototype.M;Y.prototype.Oc=function(a){this.Pb=a};Y.prototype.setIsLiveInterrupted=Y.prototype.Oc;Y.prototype.Rc=function(){for(var a in this.c)this.c[a].xc()};Y.prototype.forceResyncVideoBuffer=Y.prototype.Rc;
function Ye(a,b){for(var c,d=!1,e=new B,f=eb(a.f),h=0;h<f.length;++h)for(var g=f[h],k=0;k<g.u.length;++k){var l=g.u[k];l.b.forEach(function(a){e.push(a,l)})}for(c in b)if(f=Ta[b[c]]||null,g=e.get(c))for(h=0;h<g.length;++h)l=g[h],k=l.ma,l.ma=!f,k!=l.ma&&(d=!0);else mb(c);d&&(Sf(a),d=a.ra(),c=a.Z(),d=a.f.a.hasOwnProperty("audio")&&0==d.length,c=a.f.a.hasOwnProperty("video")&&0==c.length,d||c)&&(c=Error("The key system has restricted all "+(d&&c?"audio and video tracks.":d?"audio tracks.":"video tracks.")),
c.type="drm",c=y(c),a.dispatchEvent(c))}function Sf(a){var b=x({type:"trackschanged",bubbles:!0});a.dispatchEvent(b)}function nf(a,b,c,d,e,f,h){h=!!h;if(!a.f.a.hasOwnProperty(b)||!a.c[b])return!1;for(var g=a.f.get(b),k=0;k<g.length;++k)for(var l=g[k],n=0;n<l.u.length;++n){var p=l.u[n];if(p.T==c){if(!p.ma||!p.ca)return!1;if("text"!=b&&!a.xa)return c=a.B[b],a.B[b]={Bc:p,gc:null!=c&&c.gc||d,hc:null!=c&&c.hc||e,switchReason:f,Da:h},!0;a.c[b].Za(p,d,e,f,h);return!0}}return!1}
function Rf(a,b){for(var c=0;2>=c;++c)for(var d=0;d<b.length;++d){var e=b[d];if(Va(c,a.P,e.lang)){b.splice(d,1);b.splice(0,0,e);return}}for(d=0;d<b.length;++d)if(e=b[d],e.f){b.splice(d,1);b.splice(0,0,e);break}}m=Y.prototype;m.dd=function(){this.h.ab(this.i,"sourceopen");this.tb.resolve()};
function Ff(a){var b;a.m&&(b=a.m.getOperationLogger("start_streams").start());for(var c=[],d=["audio","video","text"],e=0;e<d.length;++e){var f=d[e];a.f.a.hasOwnProperty(f)&&c.push(a.f.get(f)[0])}for(var h=Tf(a,c),e=0;e<d.length;++e)if(f=d[e],a.f.a.hasOwnProperty(f)&&!h[f])return a=Error("Unable to select an initial "+f+" stream: all "+f+" streams have been restricted (by the application or by the key system)."),a.type="stream",b&&b.setError(a).log(),Promise.reject(a);c=ab(h).map(function(a){return a.N.create()});
c.push(a.tb);return Promise.all(c).then(H(a,function(a){a.pop();if(!a.every(function(a){return a.length()}))return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);a=Mf(this,a);if(!a)return a=Error("Some streams are not available."),a.type="stream",Promise.reject(a);if(!Uf(this,h))return a=Error("Failed to create Stream objects."),a.type="stream",Promise.reject(a);this.A.start();Vf(this,h,a);return Promise.resolve()})).then(function(){b&&b.log()}).catch(H(a,function(a){if("aborted"==
a.type)b&&b.setError(a).log();else{Object.keys(this.c);if(this.b.b)return Date.now()+Ea<this.b.i?(a=Math.max(this.b.i-Date.now()/1E3,this.yb),this.s=setTimeout(this.Cb.bind(this,!0),1E3*a)):Kf(this,0),b&&b.log(),Promise.resolve();b&&b.setError(a).log();return Promise.reject(a)}}))}
function Tf(a,b){for(var c={},d=0;d<b.length;++d){var e=b[d],f=null;if("video"==e.contentType){var h=a.A.getInitialVideoTrackId();if(null==h)continue;f=e.u.filter(function(a){return a.T==h});if(0==f.length)continue;f=f[0]}else if("audio"==e.contentType)if(h=a.A.getInitialAudioTrackId(),f=e.u.filter(function(a){return a.T==h}),0==f.length){f=e.u.filter(function(a){return a.ma&&a.ca});if(0==f.length)continue;f=e.u[Math.floor(f.length/2)]}else f=f[0];else 0<e.u.length&&(f=e.u[0]);c[e.contentType]=f}return c}
function Uf(a,b){var c={},d;for(d in b){var e=b[d],e="text"==d?new ve(a,a.video):Wf(a,e);if(!e)return ab(c).forEach(function(a){a.destroy()}),!1;c[d]=e}a.ac(a.bc);a.c=c;return!0}
function Wf(a,b){var c=Pd(b),d=Xf(c.split(";")[0]),e=null,f=a.a.getBool("use_local_estimator_for_abr_sampling",!0)?a.sb:a.sa,h=null,g=null;a.Kb&&canUseFetchStream()?(g=new MultipleSegmentsProvider(a.a.getNumber("streaming_segment_size",4)),h=Yf(a,g,d,f)):a.Jb&&(e=Zf(a,d,f));var k=null,l=a.f.get(d);"video"===d&&0<l.length&&(k=function(a,b){for(var c=null,d=null,e=0;e<l[0].u.length;e++)l[0].u[e].id===a?c=l[0].u[e]:l[0].u[e].id===b&&(d=l[0].u[e]);return null===c||null===d?0:c.bandwidth>d.bandwidth?1:
-1});c=new U(a,a.video,a.a,a.i,c,f,a.cc,a.aa,k,a.G,e,h,g);c.ia(a.g);return c}function Yf(a,b,c,d){var e=a.v[c],f="audio"!==c||a.a.getBool("enable_audio_streaming",!1);if(!e&&f){var e=new VideoStreamingManager(a.a,b,c,a.m,a.U),h="video"===c;h&&e.addListener("bandwidthUpdate",function(a){d.sample(a.timeTaken,a.bytesRead,h,{timeToLastByte:a.timeTaken},this.Eb,this.m,!this.a.getBool("evaluate_abr_on_stream_bandwidth_sample",!0))}.bind(a))}e&&(a.v[c]=e);return e||null}
function Zf(a,b,c){if("video"===b||"audio"===b&&a.a.getBool("enable_request_pipelining_for_vod_audios",!1)){var d=a.o[b];d||(d=new SegmentRequestManager(a.a,b,a.M()?VideoPriorityCalculator.calculateLive:VideoPriorityCalculator.calculate,a.m,c,a.Eb,a.aa),a.O&&d.updatePriorityWithNewAdjustment(a.O.getPriorityAdjustment()),a.o[b]=d);return d}return null}function $f(a,b){a.video.currentTime=b;a.C=b}
function Vf(a,b,c){a.Yb=a.video.playbackRate;a.video.playbackRate=0;ag(a,c);var d;a.ha&&a.ha<=c.end&&a.ha>=c.start?d=a.ha:a.b.b?(d=bg(a,c),a.Sb=!0):d=c.start;D(a.h,a.video,"seeking",a.hd.bind(a));a.H?(a.H.setOnPlaying(a.bb.bind(a,!0)),a.H.setOnPaused(a.bb.bind(a,!1)),a.H.enable()):(D(a.h,a.video,"playing",a.bb.bind(a,!0)),a.a.getBool("update_priority_on_play_event",!0)&&D(a.h,a.video,"play",a.bb.bind(a,!0)),D(a.h,a.video,"pause",a.bb.bind(a,!1)));D(a.h,a.video,"seeking",a.Cc.bind(a));D(a.h,a.video,
"timeupdate",throttle(a.Cc.bind(a),a.a.getNumber("scheduler_priority_update_interval",1E3)));if(a.video.currentTime!=d)if(a.Gb)0!==a.video.readyState?$f(a,d):cg(a,d);else try{$f(a,d)}catch(e){cg(a,d)}dg(a,c.start,c.end,c.w,c.Pa);var f=[],h;for(h in a.c){c=a.c[h];H(a,function(a){f.push(a.Ac(this.oa).then(H(this,function(b){var c=a.ib();c>this.Fb&&(this.Fb=c);return b})))})(c);D(a.h,c,"ended",a.kd.bind(a));D(a.h,c,"should_end_all_streams",a.ld.bind(a));D(a.h,c,"should_nudge",a.ed.bind(a));d=b[h];var g=
a.A.getInitialSwitchReason()||void 0;c.Za(d,!1,void 0,g)}Promise.all(f).then(H(a,function(a){this.a.getBool("prevent_stream_start_if_streams_change",!1)&&!eg(this)||fg(this,a)})).catch(H(a,function(a){"destroy"!=a.type&&(a=y(a),this.dispatchEvent(a))}));of(a,a.ta)}
m.bb=function(a){Object.keys(this.o).forEach(function(b){this.o[b].updatePriorityWithNewPlayingState(a)}.bind(this));Object.keys(this.v).forEach(function(b){this.v[b].getPriorityUpdater().updatePriorityWithNewPlayingState(a)}.bind(this));if(this.m){var b=Mf(this,Hf(this));b&&this.video.currentTime<b.start&&BanzaiODS.bumpEntityKey("videos.www.shaka","current_time_at_playing_less_than_stream_limits_start")}a&&null!==this.L&&(b=this.L,this.L=null,this.a.getBool("pending_seek_while_playing",!1)?gg(this,
b):this.video.currentTime=b)};m.Cc=function(){this.video&&(Object.keys(this.o).forEach(function(a){this.o[a].updatePriorityWithNewPlayhead(this.video.currentTime)}.bind(this)),Object.keys(this.v).forEach(function(a){this.v[a].getPriorityUpdater().updatePriorityWithNewPlayhead(this.video.currentTime)}.bind(this)))};function gg(a,b){for(var c in a.c)me(a.c[c],b)}function cg(a,b){a.ba=b;for(var c in a.c){var d=a.c[c];a.ba&&(d.na=a.ba)}}
function eg(a){return!Object.keys(a.c).some(H(a,function(a){return this.c[a]&&!this.c[a].h}))}
function fg(a,b){da(b&&b.length==Object.keys(a.c).length);for(var c=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,e=0;e<b.length;++e)var f=b[e],c=Math.min(c,f),d=Math.max(d,f);c=Hf(a);for(e=0;e<c.length;++e)c[e].Ia(d);a.a.getBool("process_deferred_switches_early",!1)&&hg(a);ig(a,c,d);var h=ab(a.c).map(function(a){return a.Ma().id});a.a.getBool("sequentially_load_streams",!1)?jg(a,h,d):(e=eb(a.f).map(function(a){return a.u}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return!~h.indexOf(a.id)}).map(function(a){var b=
[a.N.fb?a.N.fb():a.N.create()];a.W&&b.push(a.W.create(this.m,this.aa));return Promise.all(b)}),Promise.all(e).then(H(a,function(a){for(var b=0;b<a.length;++b)a[b][0].Ia(d);this.xa=!0;hg(this)})).catch(H(a,function(a){"aborted"!=a.type&&(a=y(a),this.dispatchEvent(a))})))}
function jg(a,b,c){var d=Promise.resolve();eb(a.f).map(function(a){return a.u}).reduce(function(a,b){return a.concat(b)},[]).filter(function(a){return!~b.indexOf(a.id)}).forEach(function(a){d=d.then(H(this,function(b){b&&b[0].Ia(c);b=[a.N.fb?a.N.fb():a.N.create()];a.W&&b.push(a.W.create(this.m,this.aa));return Promise.all(b)})).catch(function(a){throw a;})});d.then(H(a,function(){this.xa=!0;hg(this)})).catch(H(a,function(a){"aborted"!=a.type&&(a=y(a),this.dispatchEvent(a))}))}
function hg(a){for(var b in a.B){var c=a.B[b];a.c[b].Za(c.Bc,c.gc,c.hc,c.switchReason,c.Da)}a.B={}}
function ig(a,b,c){if(b=Mf(a,b))ag(a,b),dg(a,b.start,b.end,b.w,b.Pa);0!=c?(c=a.video.currentTime+c,a.video.currentTime=c,a.C=c):a.Sb&&b&&(c=bg(a,b),Math.abs(c-a.video.currentTime)>=a.Rb&&(a.video.currentTime=c));a.a.getBool("unify_stream_start_with_buffer_detector",!1)?(c=x({type:"allStreamsStarted",bubbles:!0}),a.dispatchEvent(c)):a.video.playbackRate=a.Yb;a.b.b&&null!=a.b.c&&Kf(a,0);kg(a);a.oa.resolve()}
function bg(a,b){var c=b.end;void 0!==b.oc&&(c=b.oc);if(a.Qb){var d=a.video.currentTime;d>=b.start&&d<=b.end&&d<c&&(c=d)}return c}function ag(a,b){if(a.b.b)isNaN(a.i.duration)&&(a.i.duration=b.end+2592E3);else if(isNaN(a.i.duration)||b.end>a.i.duration)if(a.i.duration=b.end,!a.a.getBool("disable_append_window_end",!1))for(var c=a.a.getNumber("append_window_end_fudge_factor",0),d=0;d<a.i.sourceBuffers.length;++d)a.i.sourceBuffers[d].appendWindowEnd=b.end+c}
m.nd=function(){this.ga=null;kg(this);var a=Mf(this,Hf(this));if(a){var b=this.b.b;this.a.getBool("treat_live_static_manifest_as_dynamic",!1)&&(b=b||this.b.g);b&&this.fa!=a.w&&(this.fa=a.w,null!=this.j&&(clearTimeout(this.j),this.j=null));dg(this,a.start,a.end,a.w,a.Pa);this.video.paused||lg(this,this.video.currentTime,a.start,a.end)}};function dg(a,b,c,d,e){b=x({type:"seekrangechanged",bubbles:!0,start:b,end:c,last:d,seekRangeGaps:e});a.dispatchEvent(b)}
m.hd=function(){var a=this.video.currentTime,b=Mf(this,Hf(this));this.m&&b&&a<b.start&&BanzaiODS.bumpEntityKey("videos.www.shaka","current_time_at_seek_less_than_stream_limits_start");if(null!=this.C){if(a>=this.C-.01&&a<=this.C+.01){this.C=null;this.m&&b&&a<b.start&&BanzaiODS.bumpEntityKey("videos.www.shaka","ignored_seek_when_current_time_at_seek_less_than_stream_limits_start");return}this.C=null}if(b){var c=b.start,d=b.end;this.a.getBool("skip_remaining_buffered_on_stream_end",!1)&&this.b.b&&this.b.g&&
this.video.paused&&(d=this.fa);(c=lg(this,a,c,d))||(a<=d+.01||this.b.b&&!mg(this,d)?c=!1:(this.video.currentTime=d,c=!0));if(c)this.m&&a<b.start&&BanzaiODS.bumpEntityKey("videos.www.shaka","clamp_playhead_when_current_time_at_seek_less_than_stream_limits_start");else{for(var e in this.c)this.c[e].pc(this.za);this.za=!1}}};function lg(a,b,c,d){if(b>=c-.01)return!1;b=0;a.b.b&&(b=.5,mg(a,c+b)||(b=a.b.f));a.video.currentTime=Math.min(c+b,d);return!0}
function mg(a,b){for(var c in a.c)if(!a.c[c].yc(b))return!1;return!0}m.kd=function(){if(!this.b.b||this.Aa){for(var a in this.c)if(!this.c[a].Ua())return;this.Ta()}};m.ld=function(){clearTimeout(this.s);this.Aa=!0;for(var a in this.c)this.c[a].Ua()||this.c[a].pb()};m.ed=function(){this.a.getBool("ignore_seek_when_nudging",!0)&&(this.C=this.video.currentTime);this.video.currentTime+=.001};m.jb=function(){var a=this.b,b=null,c=null;a&&a.a&&a.a[0]&&(b=a.a[0]);b&&b.a&&b.a[0]&&(c=b.a[0]);return!!c&&c.b};
Y.prototype.hasInlinedCea608Subtitles=Y.prototype.jb;Y.prototype.ac=function(a){this.bc=a;var b=this.c;"video"in b&&(b.video.c.M=a&&this.jb())};Y.prototype.setEnableCea608Parsing=Y.prototype.ac;function tf(a){var b=a.a.getNumber("live_buffering_underflow_threshold",.5),c=a.a.getBool("fix_live_stream_gone_on_manifest_update",!0)&&a.Vb,d=!1;if(a.b.g){var d=a.a.getNumber("live_stream_end_slack",0),e;for(e in a.c)a.c[e].Ua()||(d=0);d=a.video.currentTime+b+d>a.fa}return c||d}m=Y.prototype;
m.Zc=function(){this.$=!0;if(this.b&&this.b.b){if(tf(this))return this.Ta();this.a.getBool("allow_infinite_retry_on_net_err",!0)&&this.G.isNetworkInterrupted()||!ab(this.c).every(function(a){return a.Ua()})||ng(this,this.Xa)}this.a.getBool("back_off_buffering_overflow",!1)&&(null===this.J||Date.now()-this.Tb>this.a.getNumber("back_off_buffering_overflow_time_window",2E3)?this.J=this.a.getNumber("buffering_overflow_threshold",0):this.J*=this.a.getNumber("back_off_buffering_overflow_time_factor",2),
this.J=Math.min(this.J,this.a.getNumber("back_off_buffering_overflow_max",5)))};function ng(a,b){a.j=setTimeout(a.Ta.bind(a),b)}m.Yc=function(){this.$=!1;this.a.getBool("back_off_buffering_overflow",!1)&&(this.Tb=Date.now());null!=this.j&&(clearTimeout(this.j),this.j=null)};m.cd=function(){null!==this.ba&&($f(this,this.ba),cg(this,null))};m.yd=function(){};
m.Ta=function(){this.$=!1;this.j=null;var a;if(a=this.a.getBool("test_source_buffers_not_updating_end_of_stream",!1))a:{for(a=0;a<this.i.sourceBuffers.length;++a)if(this.i.sourceBuffers[a].updating){a=!0;break a}a=!1}if(a)return ng(this,1E3);this.i.endOfStream()};function Hf(a){return ab(a.c).map(function(a){return a.vb()}).filter(function(a){return null!=a})}function Lf(a){return Math.max(a.b?a.b.f:1,a.Ob?a.g.streamBufferSize||0:0)}
function Mf(a,b){for(var c=0,d=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,f=[],h=!VideoPlayerShakaGlobalConfig.getBool("no_seek_range_gaps_during_compute_stream_limits",!1),g=0;g<b.length;++g){var k=b[g].wb();h&&(f=f.concat(b[g].getSeekRangeGaps()));c=Math.max(c,k.start);null!=k.end&&(d=Math.min(d,k.end));b[g].length()&&(e=Math.min(e,b[g].w().endTime))}h&&(f=mergeSeekRangeGaps(f));if(d==Number.POSITIVE_INFINITY)if(d=a.b.a[0],d.duration)d=(d.start||0)+d.duration;else return null;if(a.b.b){var h=
Lf(a),d=Math.max(d-h,c),l;a.na&&a.a.getBool("live_jump_to_pushed_segment",!1)&&b.length&&(g=Math.floor(Lf(a)/1)+1,h=b[0],g=h.length()-g,(h=h.get(g))&&(l=h.startTime))}if(c>d)return null;d=Math.floor(1E5*d)/1E5;return{start:c,end:d,w:e,Pa:f,oc:l}}m.cb=function(){return Mf(this,Hf(this))};Y.prototype.computeStreamLimits=Y.prototype.cb;function kg(a){a.b.b&&(a.ga=setTimeout(a.nd.bind(a),1E3))}function Df(a){for(var b in a.c)a.c[b].ia(a.g)}Y.prototype.ib=function(){return this.Fb};
Y.prototype.getLongestInitResponseTime=Y.prototype.ib;function Xf(a){return"v"===a.charAt(0)?"video":"a"===a.charAt(0)?"audio":null}Y.prototype.Jc=function(){var a=x({type:"networkinterrupted",bubbles:!0});this.dispatchEvent(a);this.R=this.R||Date.now();this.$&&this.j&&clearTimeout(this.j)};
Y.prototype.Kc=function(){var a=x({type:"networkresumed",bubbles:!0});this.dispatchEvent(a);a=this.a.getNumber("max_network_interrupted_time_before_seek",1E4);null!==this.R&&Date.now()-this.R>=a&&(this.R=null,this.da=!0);this.a.getBool("fix_network_interrupted_start_not_nulled",!1)&&(this.R=null);this.$&&ng(this,this.Xa)};Y.prototype.Lc=function(){this.da=!0};function Pf(a){a.a.getBool("decouple_mpd_update_loop_from_request_loop",!1)||Kf(a,0)}Y.prototype.dc=function(a){this.ka=a};
Y.prototype.setEnableLiveheadCatchup=Y.prototype.dc;Y.prototype.Uc=function(){return this.ka};Y.prototype.isLiveheadCatchupEnabled=Y.prototype.Uc;Y.prototype.Ic=function(){return this.c.video?this.c.video.c.h:null};Y.prototype.getVideoStreamProgressTracker=Y.prototype.Ic;Y.prototype.gb=function(){return this.c.video?this.c.video.gb():null};Y.prototype.getBufferVelocity=Y.prototype.gb;function Z(a,b,c,d,e){d||(d=new F);e||(e=new X);Y.call(this,null,b,d,e);"string"===typeof a?this.Xb=a:this.Db=a;this.a=b;this.F=null;this.qa=c;this.ya=[];this.Dc=[];this.Ec=[];this.Ga=0;this.Y=null}r(Z,Y);q("shaka.player.DashVideoSource",Z);Z.prototype.pd=function(a){this.F=a;this.Cb(!0,!0)};Z.prototype.updateManifest=Z.prototype.pd;Z.prototype.Lb=function(){return this.Db||this.F};Z.prototype.getManifest=Z.prototype.Lb;Z.prototype.Hb=function(){return this.Lb()};Z.prototype.debugGetManifest=Z.prototype.Hb;
Z.prototype.Pc=function(a,b,c){this.ya.push(a);this.Dc.push(b||"");this.Ec.push(c||"")};Z.prototype.addExternalCaptions=Z.prototype.Pc;Z.prototype.Qc=function(a){this.Y=a};Z.prototype.setNetworkCallback=Z.prototype.Qc;Z.prototype.destroy=function(){this.F=this.Y=this.qa=null;Y.prototype.destroy.call(this)};
Z.prototype.mb=function(){var a;this.m&&(a=this.m.getOperationLogger("source_load").start());var b,c=H(this,function(c){this.Ea("MPDFetchDuration",(Date.now()-b)/1E3);this.F=c;for(var d=0;d<this.ya.length;d++)Oc(c,this.ya[d],this.Dc[d],this.Ec[d]);var d=new Ae(this.qa,this.m),e;this.m&&(e=this.m.getOperationLogger("process_manifest").start());this.b=Be(d,c,this.Y);e&&e.log();a&&a.setManifestType(this.b.b?"dynamic":"static");return Y.prototype.mb.call(this).then(function(){a&&a.log()})});if(this.Db)return b=
Date.now(),c(this.Db);var d=[new J(this.Xb)],e;if(this.na){var f=new VideoPushParametersHelper(this.Xb);f.setStreamEndOffset(Math.floor(Lf(this)/1));this.Va&&f.setPushVideoRepresentationID(this.Va);this.la&&f.setPushAudioRepresentationID(this.la);this.ia&&f.setUseLongCacheForManifest(this.ia);e=new kd(null);e.a=f}d=new I(this.Y,d);e=new id(d,this.Ab,e,this.aa);b=Date.now();return jd(e,this.m).then(c)};
Z.prototype.jc=function(){if(this.Ib){var a=this.b;if(a=(a=a&&a.a)&&a[0]){var a=a.a.reduce(function(a,b){return a.concat(b.u)},[]),b=function(a){return null!=a};Promise.all(a.map(function(a){a=a.N;return a.Mc?a.Ha:a.create()})).then(function(a){a=a.filter(b);this.Ea("InitialSegmentIndexes",a)}.bind(this));Promise.all(a.map(function(a){return a.W})).then(function(a){a=a.filter(b);this.Ea("SegmentInitSources",a)}.bind(this))}}};
Z.prototype.lc=function(a,b,c){if(this.video.paused&&this.Ga+1E4>Date.now()&&this.b)return Promise.reject({type:"delay"});var d;if(b&&void 0!=c)d=new kd(b),d.f=c,b=Qf(this),null!=b&&(d.c=b.streamInfoID,d.b=this.la);else for(b=a.c,c=0;c<b.length;c++){var e=new VideoPushParametersHelper(b[c].toString());this.ia&&e.setUseLongCacheForManifest(this.ia);b[c]=new J(e.getURL())}a=new id(a,this.Ab,d,this.aa);var f=Date.now();return jd(a,this.m).then(H(this,function(a){this.Ga=Date.now();this.Ea("MPDFetchDuration",
(this.Ga-f)/1E3);this.a.getBool("treat_live_static_manifest_as_dynamic",!1)&&(a.manifestIsLiveStreaming="dynamic"===(this.F?this.F.type:a.type));this.F=a;var b=new Ae(this.qa,this.m);if(this.m)var c=this.m.getOperationLogger("process_manifest").start();a=Be(b,a,this.Y);c&&c.log();return Promise.resolve(a)}))};Z.prototype.kc=function(){var a=Be(new Ae(this.qa),this.F,this.Y);return Promise.resolve(a)};}.bind(g, global))();

module.exports = g.shaka;


/* wjbFJoeQaq4 */}),null);